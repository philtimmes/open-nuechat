import{bb as Ms,d as ie,bc as ln,bd as Wt,be as jt,bf as Et,bg as Is,bh as un,aL as As,bi as $s,bj as I,bk as i}from"./index-DLvz6K3z.js";import{i as St}from"./value-BqNnmrz1.js";Ms();function Ps(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ce(e,t){if(e=Ps(e),t===void 0&&(t=e.currentTarget),t){var o=t.ownerSVGElement||t;if(o.createSVGPoint){var n=o.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const Ts={passive:!1},We={capture:!0,passive:!1};function Ct(e){e.stopImmediatePropagation()}function $e(e){e.preventDefault(),e.stopImmediatePropagation()}function dn(e){var t=e.document.documentElement,o=ie(e).on("dragstart.drag",$e,We);"onselectstart"in t?o.on("selectstart.drag",$e,We):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function fn(e,t){var o=e.document.documentElement,n=ie(e).on("dragstart.drag",null);t&&(n.on("click.drag",$e,We),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in o?n.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}const ot=e=>()=>e;function Dt(e,{sourceEvent:t,subject:o,target:n,identifier:r,active:s,x:a,y:c,dx:l,dy:u,dispatch:p}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:o,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:p}})}Dt.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function zs(e){return!e.ctrlKey&&!e.button}function Ls(){return this.parentNode}function Ds(e,t){return t??{x:e.x,y:e.y}}function Rs(){return navigator.maxTouchPoints||"ontouchstart"in this}function hn(){var e=zs,t=Ls,o=Ds,n=Rs,r={},s=ln("start","drag","end"),a=0,c,l,u,p,d=0;function h(v){v.on("mousedown.drag",y).filter(n).on("touchstart.drag",b).on("touchmove.drag",m,Ts).on("touchend.drag touchcancel.drag",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(v,M){if(!(p||!e.call(this,v,M))){var E=g(this,t.call(this,v,M),v,M,"mouse");E&&(ie(v.view).on("mousemove.drag",x,We).on("mouseup.drag",w,We),dn(v.view),Ct(v),u=!1,c=v.clientX,l=v.clientY,E("start",v))}}function x(v){if($e(v),!u){var M=v.clientX-c,E=v.clientY-l;u=M*M+E*E>d}r.mouse("drag",v)}function w(v){ie(v.view).on("mousemove.drag mouseup.drag",null),fn(v.view,u),$e(v),r.mouse("end",v)}function b(v,M){if(e.call(this,v,M)){var E=v.changedTouches,_=t.call(this,v,M),T=E.length,z,X;for(z=0;z<T;++z)(X=g(this,_,v,M,E[z].identifier,E[z]))&&(Ct(v),X("start",v,E[z]))}}function m(v){var M=v.changedTouches,E=M.length,_,T;for(_=0;_<E;++_)(T=r[M[_].identifier])&&($e(v),T("drag",v,M[_]))}function N(v){var M=v.changedTouches,E=M.length,_,T;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),_=0;_<E;++_)(T=r[M[_].identifier])&&(Ct(v),T("end",v,M[_]))}function g(v,M,E,_,T,z){var X=s.copy(),$=ce(z||E,M),P,B,f;if((f=o.call(v,new Dt("beforestart",{sourceEvent:E,target:h,identifier:T,active:a,x:$[0],y:$[1],dx:0,dy:0,dispatch:X}),_))!=null)return P=f.x-$[0]||0,B=f.y-$[1]||0,function j(S,A,k){var C=$,V;switch(S){case"start":r[T]=j,V=a++;break;case"end":delete r[T],--a;case"drag":$=ce(k||A,M),V=a;break}X.call(S,v,new Dt(S,{sourceEvent:A,subject:f,target:h,identifier:T,active:V,x:$[0]+P,y:$[1]+B,dx:$[0]-C[0],dy:$[1]-C[1],dispatch:X}),_)}}return h.filter=function(v){return arguments.length?(e=typeof v=="function"?v:ot(!!v),h):e},h.container=function(v){return arguments.length?(t=typeof v=="function"?v:ot(v),h):t},h.subject=function(v){return arguments.length?(o=typeof v=="function"?v:ot(v),h):o},h.touchable=function(v){return arguments.length?(n=typeof v=="function"?v:ot(!!v),h):n},h.on=function(){var v=s.on.apply(s,arguments);return v===s?h:v},h.clickDistance=function(v){return arguments.length?(d=(v=+v)*v,h):Math.sqrt(d)},h}var Vs=1e-12;function lo(e){return((e=Math.exp(e))+1/e)/2}function Hs(e){return((e=Math.exp(e))-1/e)/2}function Bs(e){return((e=Math.exp(2*e))-1)/(e+1)}const ct=(function e(t,o,n){function r(s,a){var c=s[0],l=s[1],u=s[2],p=a[0],d=a[1],h=a[2],y=p-c,x=d-l,w=y*y+x*x,b,m;if(w<Vs)m=Math.log(h/u)/t,b=function(_){return[c+_*y,l+_*x,u*Math.exp(t*_*m)]};else{var N=Math.sqrt(w),g=(h*h-u*u+n*w)/(2*u*o*N),v=(h*h-u*u-n*w)/(2*h*o*N),M=Math.log(Math.sqrt(g*g+1)-g),E=Math.log(Math.sqrt(v*v+1)-v);m=(E-M)/t,b=function(_){var T=_*m,z=lo(M),X=u/(o*N)*(z*Bs(t*T+M)-Hs(M));return[c+X*y,l+X*x,u*z/lo(t*T+M)]}}return b.duration=m*1e3*t/Math.SQRT2,b}return r.rho=function(s){var a=Math.max(.001,+s),c=a*a,l=c*c;return e(a,c,l)},r})(Math.SQRT2,2,4),nt=e=>()=>e;function Os(e,{sourceEvent:t,target:o,transform:n,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:r}})}function kt(e){e.stopImmediatePropagation()}function Oe(e){e.preventDefault(),e.stopImmediatePropagation()}function Fs(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Ws(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function uo(){return this.__zoom||Wt}function Xs(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Ys(){return navigator.maxTouchPoints||"ontouchstart"in this}function Gs(e,t,o){var n=e.invertX(t[0][0])-o[0][0],r=e.invertX(t[1][0])-o[1][0],s=e.invertY(t[0][1])-o[0][1],a=e.invertY(t[1][1])-o[1][1];return e.translate(r>n?(n+r)/2:Math.min(0,n)||Math.max(0,r),a>s?(s+a)/2:Math.min(0,s)||Math.max(0,a))}function gn(){var e=Fs,t=Ws,o=Gs,n=Xs,r=Ys,s=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],c=250,l=ct,u=ln("start","zoom","end"),p,d,h,y=500,x=150,w=0,b=10;function m(f){f.property("__zoom",uo).on("wheel.zoom",T,{passive:!1}).on("mousedown.zoom",z).on("dblclick.zoom",X).filter(r).on("touchstart.zoom",$).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",B).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(f,j,S,A){var k=f.selection?f.selection():f;k.property("__zoom",uo),f!==k?M(f,j,S,A):k.interrupt().each(function(){E(this,arguments).event(A).start().zoom(null,typeof j=="function"?j.apply(this,arguments):j).end()})},m.scaleBy=function(f,j,S,A){m.scaleTo(f,function(){var k=this.__zoom.k,C=typeof j=="function"?j.apply(this,arguments):j;return k*C},S,A)},m.scaleTo=function(f,j,S,A){m.transform(f,function(){var k=t.apply(this,arguments),C=this.__zoom,V=S==null?v(k):typeof S=="function"?S.apply(this,arguments):S,W=C.invert(V),F=typeof j=="function"?j.apply(this,arguments):j;return o(g(N(C,F),V,W),k,a)},S,A)},m.translateBy=function(f,j,S,A){m.transform(f,function(){return o(this.__zoom.translate(typeof j=="function"?j.apply(this,arguments):j,typeof S=="function"?S.apply(this,arguments):S),t.apply(this,arguments),a)},null,A)},m.translateTo=function(f,j,S,A,k){m.transform(f,function(){var C=t.apply(this,arguments),V=this.__zoom,W=A==null?v(C):typeof A=="function"?A.apply(this,arguments):A;return o(Wt.translate(W[0],W[1]).scale(V.k).translate(typeof j=="function"?-j.apply(this,arguments):-j,typeof S=="function"?-S.apply(this,arguments):-S),C,a)},A,k)};function N(f,j){return j=Math.max(s[0],Math.min(s[1],j)),j===f.k?f:new jt(j,f.x,f.y)}function g(f,j,S){var A=j[0]-S[0]*f.k,k=j[1]-S[1]*f.k;return A===f.x&&k===f.y?f:new jt(f.k,A,k)}function v(f){return[(+f[0][0]+ +f[1][0])/2,(+f[0][1]+ +f[1][1])/2]}function M(f,j,S,A){f.on("start.zoom",function(){E(this,arguments).event(A).start()}).on("interrupt.zoom end.zoom",function(){E(this,arguments).event(A).end()}).tween("zoom",function(){var k=this,C=arguments,V=E(k,C).event(A),W=t.apply(k,C),F=S==null?v(W):typeof S=="function"?S.apply(k,C):S,G=Math.max(W[1][0]-W[0][0],W[1][1]-W[0][1]),R=k.__zoom,L=typeof j=="function"?j.apply(k,C):j,D=l(R.invert(F).concat(G/R.k),L.invert(F).concat(G/L.k));return function(O){if(O===1)O=L;else{var H=D(O),Y=G/H[2];O=new jt(Y,F[0]-H[0]*Y,F[1]-H[1]*Y)}V.zoom(null,O)}})}function E(f,j,S){return!S&&f.__zooming||new _(f,j)}function _(f,j){this.that=f,this.args=j,this.active=0,this.sourceEvent=null,this.extent=t.apply(f,j),this.taps=0}_.prototype={event:function(f){return f&&(this.sourceEvent=f),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(f,j){return this.mouse&&f!=="mouse"&&(this.mouse[1]=j.invert(this.mouse[0])),this.touch0&&f!=="touch"&&(this.touch0[1]=j.invert(this.touch0[0])),this.touch1&&f!=="touch"&&(this.touch1[1]=j.invert(this.touch1[0])),this.that.__zoom=j,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(f){var j=ie(this.that).datum();u.call(f,this.that,new Os(f,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:u}),j)}};function T(f,...j){if(!e.apply(this,arguments))return;var S=E(this,j).event(f),A=this.__zoom,k=Math.max(s[0],Math.min(s[1],A.k*Math.pow(2,n.apply(this,arguments)))),C=ce(f);if(S.wheel)(S.mouse[0][0]!==C[0]||S.mouse[0][1]!==C[1])&&(S.mouse[1]=A.invert(S.mouse[0]=C)),clearTimeout(S.wheel);else{if(A.k===k)return;S.mouse=[C,A.invert(C)],Et(this),S.start()}Oe(f),S.wheel=setTimeout(V,x),S.zoom("mouse",o(g(N(A,k),S.mouse[0],S.mouse[1]),S.extent,a));function V(){S.wheel=null,S.end()}}function z(f,...j){if(h||!e.apply(this,arguments))return;var S=f.currentTarget,A=E(this,j,!0).event(f),k=ie(f.view).on("mousemove.zoom",F,!0).on("mouseup.zoom",G,!0),C=ce(f,S),V=f.clientX,W=f.clientY;dn(f.view),kt(f),A.mouse=[C,this.__zoom.invert(C)],Et(this),A.start();function F(R){if(Oe(R),!A.moved){var L=R.clientX-V,D=R.clientY-W;A.moved=L*L+D*D>w}A.event(R).zoom("mouse",o(g(A.that.__zoom,A.mouse[0]=ce(R,S),A.mouse[1]),A.extent,a))}function G(R){k.on("mousemove.zoom mouseup.zoom",null),fn(R.view,A.moved),Oe(R),A.event(R).end()}}function X(f,...j){if(e.apply(this,arguments)){var S=this.__zoom,A=ce(f.changedTouches?f.changedTouches[0]:f,this),k=S.invert(A),C=S.k*(f.shiftKey?.5:2),V=o(g(N(S,C),A,k),t.apply(this,j),a);Oe(f),c>0?ie(this).transition().duration(c).call(M,V,A,f):ie(this).call(m.transform,V,A,f)}}function $(f,...j){if(e.apply(this,arguments)){var S=f.touches,A=S.length,k=E(this,j,f.changedTouches.length===A).event(f),C,V,W,F;for(kt(f),V=0;V<A;++V)W=S[V],F=ce(W,this),F=[F,this.__zoom.invert(F),W.identifier],k.touch0?!k.touch1&&k.touch0[2]!==F[2]&&(k.touch1=F,k.taps=0):(k.touch0=F,C=!0,k.taps=1+!!p);p&&(p=clearTimeout(p)),C&&(k.taps<2&&(d=F[0],p=setTimeout(function(){p=null},y)),Et(this),k.start())}}function P(f,...j){if(this.__zooming){var S=E(this,j).event(f),A=f.changedTouches,k=A.length,C,V,W,F;for(Oe(f),C=0;C<k;++C)V=A[C],W=ce(V,this),S.touch0&&S.touch0[2]===V.identifier?S.touch0[0]=W:S.touch1&&S.touch1[2]===V.identifier&&(S.touch1[0]=W);if(V=S.that.__zoom,S.touch1){var G=S.touch0[0],R=S.touch0[1],L=S.touch1[0],D=S.touch1[1],O=(O=L[0]-G[0])*O+(O=L[1]-G[1])*O,H=(H=D[0]-R[0])*H+(H=D[1]-R[1])*H;V=N(V,Math.sqrt(O/H)),W=[(G[0]+L[0])/2,(G[1]+L[1])/2],F=[(R[0]+D[0])/2,(R[1]+D[1])/2]}else if(S.touch0)W=S.touch0[0],F=S.touch0[1];else return;S.zoom("touch",o(g(V,W,F),S.extent,a))}}function B(f,...j){if(this.__zooming){var S=E(this,j).event(f),A=f.changedTouches,k=A.length,C,V;for(kt(f),h&&clearTimeout(h),h=setTimeout(function(){h=null},y),C=0;C<k;++C)V=A[C],S.touch0&&S.touch0[2]===V.identifier?delete S.touch0:S.touch1&&S.touch1[2]===V.identifier&&delete S.touch1;if(S.touch1&&!S.touch0&&(S.touch0=S.touch1,delete S.touch1),S.touch0)S.touch0[1]=this.__zoom.invert(S.touch0[0]);else if(S.end(),S.taps===2&&(V=ce(V,this),Math.hypot(d[0]-V[0],d[1]-V[1])<b)){var W=ie(this).on("dblclick.zoom");W&&W.apply(this,arguments)}}}return m.wheelDelta=function(f){return arguments.length?(n=typeof f=="function"?f:nt(+f),m):n},m.filter=function(f){return arguments.length?(e=typeof f=="function"?f:nt(!!f),m):e},m.touchable=function(f){return arguments.length?(r=typeof f=="function"?f:nt(!!f),m):r},m.extent=function(f){return arguments.length?(t=typeof f=="function"?f:nt([[+f[0][0],+f[0][1]],[+f[1][0],+f[1][1]]]),m):t},m.scaleExtent=function(f){return arguments.length?(s[0]=+f[0],s[1]=+f[1],m):[s[0],s[1]]},m.translateExtent=function(f){return arguments.length?(a[0][0]=+f[0][0],a[1][0]=+f[1][0],a[0][1]=+f[0][1],a[1][1]=+f[1][1],m):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},m.constrain=function(f){return arguments.length?(o=f,m):o},m.duration=function(f){return arguments.length?(c=+f,m):c},m.interpolate=function(f){return arguments.length?(l=f,m):l},m.on=function(){var f=u.on.apply(u,arguments);return f===u?m:f},m.clickDistance=function(f){return arguments.length?(w=(f=+f)*f,m):Math.sqrt(w)},m.tapDistance=function(f){return arguments.length?(b=+f,m):b},m}function se(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let o=0,n;o<e.length;o++)(n=se(e[o]))!==""&&(t+=(t&&" ")+n);else for(let o in e)e[o]&&(t+=(t&&" ")+o);return t}const de={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:o,targetHandle:n})=>`Couldn't create edge for ${e} handle id: "${e==="source"?o:n}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Xe=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],xn=["Enter"," ","Escape"],pn={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:o})=>`Moved selected node ${e}. New position, x: ${t}, y: ${o}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Pe;(function(e){e.Strict="strict",e.Loose="loose"})(Pe||(Pe={}));var Se;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Se||(Se={}));var Ye;(function(e){e.Partial="partial",e.Full="full"})(Ye||(Ye={}));const mn={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var me;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(me||(me={}));var ye;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(ye||(ye={}));var q;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(q||(q={}));const fo={[q.Left]:q.Right,[q.Right]:q.Left,[q.Top]:q.Bottom,[q.Bottom]:q.Top};function yn(e){return e===null?null:e?"valid":"invalid"}const bn=e=>"id"in e&&"source"in e&&"target"in e,qs=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Xt=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Ue=(e,t=[0,0])=>{const{width:o,height:n}=he(e),r=e.origin??t,s=o*r[0],a=n*r[1];return{x:e.position.x-s,y:e.position.y-a}},Ks=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const o=e.reduce((n,r)=>{const s=typeof r=="string";let a=!t.nodeLookup&&!s?r:void 0;t.nodeLookup&&(a=s?t.nodeLookup.get(r):Xt(r)?r:t.nodeLookup.get(r.id));const c=a?lt(a,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return ft(n,c)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ht(o)},Ze=(e,t={})=>{let o={x:1/0,y:1/0,x2:-1/0,y2:-1/0},n=!1;return e.forEach(r=>{(t.filter===void 0||t.filter(r))&&(o=ft(o,lt(r)),n=!0)}),n?ht(o):{x:0,y:0,width:0,height:0}},Yt=(e,t,[o,n,r]=[0,0,1],s=!1,a=!1)=>{const c={...Je(t,[o,n,r]),width:t.width/r,height:t.height/r},l=[];for(const u of e.values()){const{measured:p,selectable:d=!0,hidden:h=!1}=u;if(a&&!d||h)continue;const y=p.width??u.width??u.initialWidth??null,x=p.height??u.height??u.initialHeight??null,w=Ge(c,ze(u)),b=(y??0)*(x??0),m=s&&w>0;(!u.internals.handleBounds||m||w>=b||u.dragging)&&l.push(u)}return l},Us=(e,t)=>{const o=new Set;return e.forEach(n=>{o.add(n.id)}),t.filter(n=>o.has(n.source)||o.has(n.target))};function Zs(e,t){const o=new Map,n=t!=null&&t.nodes?new Set(t.nodes.map(r=>r.id)):null;return e.forEach(r=>{r.measured.width&&r.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!r.hidden)&&(!n||n.has(r.id))&&o.set(r.id,r)}),o}async function Qs({nodes:e,width:t,height:o,panZoom:n,minZoom:r,maxZoom:s},a){if(e.size===0)return Promise.resolve(!0);const c=Zs(e,a),l=Ze(c),u=Gt(l,t,o,(a==null?void 0:a.minZoom)??r,(a==null?void 0:a.maxZoom)??s,(a==null?void 0:a.padding)??.1);return await n.setViewport(u,{duration:a==null?void 0:a.duration,ease:a==null?void 0:a.ease,interpolate:a==null?void 0:a.interpolate}),Promise.resolve(!0)}function vn({nodeId:e,nextPosition:t,nodeLookup:o,nodeOrigin:n=[0,0],nodeExtent:r,onError:s}){const a=o.get(e),c=a.parentId?o.get(a.parentId):void 0,{x:l,y:u}=c?c.internals.positionAbsolute:{x:0,y:0},p=a.origin??n;let d=a.extent||r;if(a.extent==="parent"&&!a.expandParent)if(!c)s==null||s("005",de.error005());else{const y=c.measured.width,x=c.measured.height;y&&x&&(d=[[l,u],[l+y,u+x]])}else c&&Le(a.extent)&&(d=[[a.extent[0][0]+l,a.extent[0][1]+u],[a.extent[1][0]+l,a.extent[1][1]+u]]);const h=Le(d)?Ce(t,d,a.measured):t;return(a.measured.width===void 0||a.measured.height===void 0)&&(s==null||s("015",de.error015())),{position:{x:h.x-l+(a.measured.width??0)*p[0],y:h.y-u+(a.measured.height??0)*p[1]},positionAbsolute:h}}async function Js({nodesToRemove:e=[],edgesToRemove:t=[],nodes:o,edges:n,onBeforeDelete:r}){const s=new Set(e.map(h=>h.id)),a=[];for(const h of o){if(h.deletable===!1)continue;const y=s.has(h.id),x=!y&&h.parentId&&a.find(w=>w.id===h.parentId);(y||x)&&a.push(h)}const c=new Set(t.map(h=>h.id)),l=n.filter(h=>h.deletable!==!1),p=Us(a,l);for(const h of l)c.has(h.id)&&!p.find(x=>x.id===h.id)&&p.push(h);if(!r)return{edges:p,nodes:a};const d=await r({nodes:a,edges:p});return typeof d=="boolean"?d?{edges:p,nodes:a}:{edges:[],nodes:[]}:d}const Te=(e,t=0,o=1)=>Math.min(Math.max(e,t),o),Ce=(e={x:0,y:0},t,o)=>({x:Te(e.x,t[0][0],t[1][0]-((o==null?void 0:o.width)??0)),y:Te(e.y,t[0][1],t[1][1]-((o==null?void 0:o.height)??0))});function wn(e,t,o){const{width:n,height:r}=he(o),{x:s,y:a}=o.internals.positionAbsolute;return Ce(e,[[s,a],[s+n,a+r]],t)}const ho=(e,t,o)=>e<t?Te(Math.abs(e-t),1,t)/t:e>o?-Te(Math.abs(e-o),1,t)/t:0,Nn=(e,t,o=15,n=40)=>{const r=ho(e.x,n,t.width-n)*o,s=ho(e.y,n,t.height-n)*o;return[r,s]},ft=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Rt=({x:e,y:t,width:o,height:n})=>({x:e,y:t,x2:e+o,y2:t+n}),ht=({x:e,y:t,x2:o,y2:n})=>({x:e,y:t,width:o-e,height:n-t}),ze=(e,t=[0,0])=>{var r,s;const{x:o,y:n}=Xt(e)?e.internals.positionAbsolute:Ue(e,t);return{x:o,y:n,width:((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0,height:((s=e.measured)==null?void 0:s.height)??e.height??e.initialHeight??0}},lt=(e,t=[0,0])=>{var r,s;const{x:o,y:n}=Xt(e)?e.internals.positionAbsolute:Ue(e,t);return{x:o,y:n,x2:o+(((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0),y2:n+(((s=e.measured)==null?void 0:s.height)??e.height??e.initialHeight??0)}},jn=(e,t)=>ht(ft(Rt(e),Rt(t))),Ge=(e,t)=>{const o=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),n=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(o*n)},go=e=>le(e.width)&&le(e.height)&&le(e.x)&&le(e.y),le=e=>!isNaN(e)&&isFinite(e),ea=(e,t)=>{},Qe=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Je=({x:e,y:t},[o,n,r],s=!1,a=[1,1])=>{const c={x:(e-o)/r,y:(t-n)/r};return s?Qe(c,a):c},ut=({x:e,y:t},[o,n,r])=>({x:e*r+o,y:t*r+n});function Me(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const o=parseFloat(e);if(!Number.isNaN(o))return Math.floor(o)}if(typeof e=="string"&&e.endsWith("%")){const o=parseFloat(e);if(!Number.isNaN(o))return Math.floor(t*o*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function ta(e,t,o){if(typeof e=="string"||typeof e=="number"){const n=Me(e,o),r=Me(e,t);return{top:n,right:r,bottom:n,left:r,x:r*2,y:n*2}}if(typeof e=="object"){const n=Me(e.top??e.y??0,o),r=Me(e.bottom??e.y??0,o),s=Me(e.left??e.x??0,t),a=Me(e.right??e.x??0,t);return{top:n,right:a,bottom:r,left:s,x:s+a,y:n+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function oa(e,t,o,n,r,s){const{x:a,y:c}=ut(e,[t,o,n]),{x:l,y:u}=ut({x:e.x+e.width,y:e.y+e.height},[t,o,n]),p=r-l,d=s-u;return{left:Math.floor(a),top:Math.floor(c),right:Math.floor(p),bottom:Math.floor(d)}}const Gt=(e,t,o,n,r,s)=>{const a=ta(s,t,o),c=(t-a.x)/e.width,l=(o-a.y)/e.height,u=Math.min(c,l),p=Te(u,n,r),d=e.x+e.width/2,h=e.y+e.height/2,y=t/2-d*p,x=o/2-h*p,w=oa(e,y,x,p,t,o),b={left:Math.min(w.left-a.left,0),top:Math.min(w.top-a.top,0),right:Math.min(w.right-a.right,0),bottom:Math.min(w.bottom-a.bottom,0)};return{x:y-b.left+b.right,y:x-b.top+b.bottom,zoom:p}},qe=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Le(e){return e!=null&&e!=="parent"}function he(e){var t,o;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((o=e.measured)==null?void 0:o.height)??e.height??e.initialHeight??0}}function En(e){var t,o;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((o=e.measured)==null?void 0:o.height)??e.height??e.initialHeight)!==void 0}function Sn(e,t={width:0,height:0},o,n,r){const s={...e},a=n.get(o);if(a){const c=a.origin||r;s.x+=a.internals.positionAbsolute.x-(t.width??0)*c[0],s.y+=a.internals.positionAbsolute.y-(t.height??0)*c[1]}return s}function xo(e,t){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}function na(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}function ra(e){return{...pn,...e||{}}}function Fe(e,{snapGrid:t=[0,0],snapToGrid:o=!1,transform:n,containerBounds:r}){const{x:s,y:a}=ue(e),c=Je({x:s-((r==null?void 0:r.left)??0),y:a-((r==null?void 0:r.top)??0)},n),{x:l,y:u}=o?Qe(c,t):c;return{xSnapped:l,ySnapped:u,...c}}const qt=e=>({width:e.offsetWidth,height:e.offsetHeight}),Cn=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},sa=["INPUT","SELECT","TEXTAREA"];function kn(e){var n,r;const t=((r=(n=e.composedPath)==null?void 0:n.call(e))==null?void 0:r[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:sa.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const _n=e=>"clientX"in e,ue=(e,t)=>{var s,a;const o=_n(e),n=o?e.clientX:(s=e.touches)==null?void 0:s[0].clientX,r=o?e.clientY:(a=e.touches)==null?void 0:a[0].clientY;return{x:n-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},po=(e,t,o,n,r)=>{const s=t.querySelectorAll(`.${e}`);return!s||!s.length?null:Array.from(s).map(a=>{const c=a.getBoundingClientRect();return{id:a.getAttribute("data-handleid"),type:e,nodeId:r,position:a.getAttribute("data-handlepos"),x:(c.left-o.left)/n,y:(c.top-o.top)/n,...qt(a)}})};function Mn({sourceX:e,sourceY:t,targetX:o,targetY:n,sourceControlX:r,sourceControlY:s,targetControlX:a,targetControlY:c}){const l=e*.125+r*.375+a*.375+o*.125,u=t*.125+s*.375+c*.375+n*.125,p=Math.abs(l-e),d=Math.abs(u-t);return[l,u,p,d]}function rt(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function mo({pos:e,x1:t,y1:o,x2:n,y2:r,c:s}){switch(e){case q.Left:return[t-rt(t-n,s),o];case q.Right:return[t+rt(n-t,s),o];case q.Top:return[t,o-rt(o-r,s)];case q.Bottom:return[t,o+rt(r-o,s)]}}function In({sourceX:e,sourceY:t,sourcePosition:o=q.Bottom,targetX:n,targetY:r,targetPosition:s=q.Top,curvature:a=.25}){const[c,l]=mo({pos:o,x1:e,y1:t,x2:n,y2:r,c:a}),[u,p]=mo({pos:s,x1:n,y1:r,x2:e,y2:t,c:a}),[d,h,y,x]=Mn({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:c,sourceControlY:l,targetControlX:u,targetControlY:p});return[`M${e},${t} C${c},${l} ${u},${p} ${n},${r}`,d,h,y,x]}function An({sourceX:e,sourceY:t,targetX:o,targetY:n}){const r=Math.abs(o-e)/2,s=o<e?o+r:o-r,a=Math.abs(n-t)/2,c=n<t?n+a:n-a;return[s,c,r,a]}function aa({sourceNode:e,targetNode:t,selected:o=!1,zIndex:n=0,elevateOnSelect:r=!1,zIndexMode:s="basic"}){if(s==="manual")return n;const a=r&&o?n+1e3:n,c=Math.max(e.parentId||r&&e.selected?e.internals.z:0,t.parentId||r&&t.selected?t.internals.z:0);return a+c}function ia({sourceNode:e,targetNode:t,width:o,height:n,transform:r}){const s=ft(lt(e),lt(t));s.x===s.x2&&(s.x2+=1),s.y===s.y2&&(s.y2+=1);const a={x:-r[0]/r[2],y:-r[1]/r[2],width:o/r[2],height:n/r[2]};return Ge(a,ht(s))>0}const ca=({source:e,sourceHandle:t,target:o,targetHandle:n})=>`xy-edge__${e}${t||""}-${o}${n||""}`,la=(e,t)=>t.some(o=>o.source===e.source&&o.target===e.target&&(o.sourceHandle===e.sourceHandle||!o.sourceHandle&&!e.sourceHandle)&&(o.targetHandle===e.targetHandle||!o.targetHandle&&!e.targetHandle)),ua=(e,t,o={})=>{if(!e.source||!e.target)return t;const n=o.getEdgeId||ca;let r;return bn(e)?r={...e}:r={...e,id:n(e)},la(r,t)?t:(r.sourceHandle===null&&delete r.sourceHandle,r.targetHandle===null&&delete r.targetHandle,t.concat(r))};function $n({sourceX:e,sourceY:t,targetX:o,targetY:n}){const[r,s,a,c]=An({sourceX:e,sourceY:t,targetX:o,targetY:n});return[`M ${e},${t}L ${o},${n}`,r,s,a,c]}const yo={[q.Left]:{x:-1,y:0},[q.Right]:{x:1,y:0},[q.Top]:{x:0,y:-1},[q.Bottom]:{x:0,y:1}},da=({source:e,sourcePosition:t=q.Bottom,target:o})=>t===q.Left||t===q.Right?e.x<o.x?{x:1,y:0}:{x:-1,y:0}:e.y<o.y?{x:0,y:1}:{x:0,y:-1},bo=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function fa({source:e,sourcePosition:t=q.Bottom,target:o,targetPosition:n=q.Top,center:r,offset:s,stepPosition:a}){const c=yo[t],l=yo[n],u={x:e.x+c.x*s,y:e.y+c.y*s},p={x:o.x+l.x*s,y:o.y+l.y*s},d=da({source:u,sourcePosition:t,target:p}),h=d.x!==0?"x":"y",y=d[h];let x=[],w,b;const m={x:0,y:0},N={x:0,y:0},[,,g,v]=An({sourceX:e.x,sourceY:e.y,targetX:o.x,targetY:o.y});if(c[h]*l[h]===-1){h==="x"?(w=r.x??u.x+(p.x-u.x)*a,b=r.y??(u.y+p.y)/2):(w=r.x??(u.x+p.x)/2,b=r.y??u.y+(p.y-u.y)*a);const E=[{x:w,y:u.y},{x:w,y:p.y}],_=[{x:u.x,y:b},{x:p.x,y:b}];c[h]===y?x=h==="x"?E:_:x=h==="x"?_:E}else{const E=[{x:u.x,y:p.y}],_=[{x:p.x,y:u.y}];if(h==="x"?x=c.x===y?_:E:x=c.y===y?E:_,t===n){const P=Math.abs(e[h]-o[h]);if(P<=s){const B=Math.min(s-1,s-P);c[h]===y?m[h]=(u[h]>e[h]?-1:1)*B:N[h]=(p[h]>o[h]?-1:1)*B}}if(t!==n){const P=h==="x"?"y":"x",B=c[h]===l[P],f=u[P]>p[P],j=u[P]<p[P];(c[h]===1&&(!B&&f||B&&j)||c[h]!==1&&(!B&&j||B&&f))&&(x=h==="x"?E:_)}const T={x:u.x+m.x,y:u.y+m.y},z={x:p.x+N.x,y:p.y+N.y},X=Math.max(Math.abs(T.x-x[0].x),Math.abs(z.x-x[0].x)),$=Math.max(Math.abs(T.y-x[0].y),Math.abs(z.y-x[0].y));X>=$?(w=(T.x+z.x)/2,b=x[0].y):(w=x[0].x,b=(T.y+z.y)/2)}return[[e,{x:u.x+m.x,y:u.y+m.y},...x,{x:p.x+N.x,y:p.y+N.y},o],w,b,g,v]}function ha(e,t,o,n){const r=Math.min(bo(e,t)/2,bo(t,o)/2,n),{x:s,y:a}=t;if(e.x===s&&s===o.x||e.y===a&&a===o.y)return`L${s} ${a}`;if(e.y===a){const u=e.x<o.x?-1:1,p=e.y<o.y?1:-1;return`L ${s+r*u},${a}Q ${s},${a} ${s},${a+r*p}`}const c=e.x<o.x?1:-1,l=e.y<o.y?-1:1;return`L ${s},${a+r*l}Q ${s},${a} ${s+r*c},${a}`}function Vt({sourceX:e,sourceY:t,sourcePosition:o=q.Bottom,targetX:n,targetY:r,targetPosition:s=q.Top,borderRadius:a=5,centerX:c,centerY:l,offset:u=20,stepPosition:p=.5}){const[d,h,y,x,w]=fa({source:{x:e,y:t},sourcePosition:o,target:{x:n,y:r},targetPosition:s,center:{x:c,y:l},offset:u,stepPosition:p});return[d.reduce((m,N,g)=>{let v="";return g>0&&g<d.length-1?v=ha(d[g-1],N,d[g+1],a):v=`${g===0?"M":"L"}${N.x} ${N.y}`,m+=v,m},""),h,y,x,w]}function vo(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function ga(e){var d;const{sourceNode:t,targetNode:o}=e;if(!vo(t)||!vo(o))return null;const n=t.internals.handleBounds||wo(t.handles),r=o.internals.handleBounds||wo(o.handles),s=No((n==null?void 0:n.source)??[],e.sourceHandle),a=No(e.connectionMode===Pe.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),e.targetHandle);if(!s||!a)return(d=e.onError)==null||d.call(e,"008",de.error008(s?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const c=(s==null?void 0:s.position)||q.Bottom,l=(a==null?void 0:a.position)||q.Top,u=ke(t,s,c),p=ke(o,a,l);return{sourceX:u.x,sourceY:u.y,targetX:p.x,targetY:p.y,sourcePosition:c,targetPosition:l}}function wo(e){if(!e)return null;const t=[],o=[];for(const n of e)n.width=n.width??1,n.height=n.height??1,n.type==="source"?t.push(n):n.type==="target"&&o.push(n);return{source:t,target:o}}function ke(e,t,o=q.Left,n=!1){const r=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,s=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:a,height:c}=t??he(e);if(n)return{x:r+a/2,y:s+c/2};switch((t==null?void 0:t.position)??o){case q.Top:return{x:r+a/2,y:s};case q.Right:return{x:r+a,y:s+c/2};case q.Bottom:return{x:r+a/2,y:s+c};case q.Left:return{x:r,y:s+c/2}}}function No(e,t){return e&&(t?e.find(o=>o.id===t):e[0])||null}function Ht(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join("&")}`:""}function xa(e,{id:t,defaultColor:o,defaultMarkerStart:n,defaultMarkerEnd:r}){const s=new Set;return e.reduce((a,c)=>([c.markerStart||n,c.markerEnd||r].forEach(l=>{if(l&&typeof l=="object"){const u=Ht(l,t);s.has(u)||(a.push({id:u,color:l.color||o,...l}),s.add(u))}}),a),[]).sort((a,c)=>a.id.localeCompare(c.id))}const Pn=1e3,pa=10,Kt={nodeOrigin:[0,0],nodeExtent:Xe,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},ma={...Kt,checkEquality:!0};function Ut(e,t){const o={...e};for(const n in t)t[n]!==void 0&&(o[n]=t[n]);return o}function ya(e,t,o){const n=Ut(Kt,o);for(const r of e.values())if(r.parentId)Qt(r,e,t,n);else{const s=Ue(r,n.nodeOrigin),a=Le(r.extent)?r.extent:n.nodeExtent,c=Ce(s,a,he(r));r.internals.positionAbsolute=c}}function ba(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const o=[],n=[];for(const r of e.handles){const s={id:r.id,width:r.width??1,height:r.height??1,nodeId:e.id,x:r.x,y:r.y,position:r.position,type:r.type};r.type==="source"?o.push(s):r.type==="target"&&n.push(s)}return{source:o,target:n}}function Zt(e){return e==="manual"}function Bt(e,t,o,n={}){var u,p;const r=Ut(ma,n),s={i:0},a=new Map(t),c=r!=null&&r.elevateNodesOnSelect&&!Zt(r.zIndexMode)?Pn:0;let l=e.length>0;t.clear(),o.clear();for(const d of e){let h=a.get(d.id);if(r.checkEquality&&d===(h==null?void 0:h.internals.userNode))t.set(d.id,h);else{const y=Ue(d,r.nodeOrigin),x=Le(d.extent)?d.extent:r.nodeExtent,w=Ce(y,x,he(d));h={...r.defaults,...d,measured:{width:(u=d.measured)==null?void 0:u.width,height:(p=d.measured)==null?void 0:p.height},internals:{positionAbsolute:w,handleBounds:ba(d,h),z:Tn(d,c,r.zIndexMode),userNode:d}},t.set(d.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(l=!1),d.parentId&&Qt(h,t,o,n,s)}return l}function va(e,t){if(!e.parentId)return;const o=t.get(e.parentId);o?o.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Qt(e,t,o,n,r){const{elevateNodesOnSelect:s,nodeOrigin:a,nodeExtent:c,zIndexMode:l}=Ut(Kt,n),u=e.parentId,p=t.get(u);if(!p){console.warn(`Parent node ${u} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}va(e,o),r&&!p.parentId&&p.internals.rootParentIndex===void 0&&l==="auto"&&(p.internals.rootParentIndex=++r.i,p.internals.z=p.internals.z+r.i*pa),r&&p.internals.rootParentIndex!==void 0&&(r.i=p.internals.rootParentIndex);const d=s&&!Zt(l)?Pn:0,{x:h,y,z:x}=wa(e,p,a,c,d,l),{positionAbsolute:w}=e.internals,b=h!==w.x||y!==w.y;(b||x!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:b?{x:h,y}:w,z:x}})}function Tn(e,t,o){const n=le(e.zIndex)?e.zIndex:0;return Zt(o)?n:n+(e.selected?t:0)}function wa(e,t,o,n,r,s){const{x:a,y:c}=t.internals.positionAbsolute,l=he(e),u=Ue(e,o),p=Le(e.extent)?Ce(u,e.extent,l):u;let d=Ce({x:a+p.x,y:c+p.y},n,l);e.extent==="parent"&&(d=wn(d,l,t));const h=Tn(e,r,s),y=t.internals.z??0;return{x:d.x,y:d.y,z:y>=h?y+1:h}}function Jt(e,t,o,n=[0,0]){var a;const r=[],s=new Map;for(const c of e){const l=t.get(c.parentId);if(!l)continue;const u=((a=s.get(c.parentId))==null?void 0:a.expandedRect)??ze(l),p=jn(u,c.rect);s.set(c.parentId,{expandedRect:p,parent:l})}return s.size>0&&s.forEach(({expandedRect:c,parent:l},u)=>{var g;const p=l.internals.positionAbsolute,d=he(l),h=l.origin??n,y=c.x<p.x?Math.round(Math.abs(p.x-c.x)):0,x=c.y<p.y?Math.round(Math.abs(p.y-c.y)):0,w=Math.max(d.width,Math.round(c.width)),b=Math.max(d.height,Math.round(c.height)),m=(w-d.width)*h[0],N=(b-d.height)*h[1];(y>0||x>0||m||N)&&(r.push({id:u,type:"position",position:{x:l.position.x-y+m,y:l.position.y-x+N}}),(g=o.get(u))==null||g.forEach(v=>{e.some(M=>M.id===v.id)||r.push({id:v.id,type:"position",position:{x:v.position.x+y,y:v.position.y+x}})})),(d.width<c.width||d.height<c.height||y||x)&&r.push({id:u,type:"dimensions",setAttributes:!0,dimensions:{width:w+(y?h[0]*y-m:0),height:b+(x?h[1]*x-N:0)}})}),r}function Na(e,t,o,n,r,s,a){const c=n==null?void 0:n.querySelector(".xyflow__viewport");let l=!1;if(!c)return{changes:[],updatedInternals:l};const u=[],p=window.getComputedStyle(c),{m22:d}=new window.DOMMatrixReadOnly(p.transform),h=[];for(const y of e.values()){const x=t.get(y.id);if(!x)continue;if(x.hidden){t.set(x.id,{...x,internals:{...x.internals,handleBounds:void 0}}),l=!0;continue}const w=qt(y.nodeElement),b=x.measured.width!==w.width||x.measured.height!==w.height;if(!!(w.width&&w.height&&(b||!x.internals.handleBounds||y.force))){const N=y.nodeElement.getBoundingClientRect(),g=Le(x.extent)?x.extent:s;let{positionAbsolute:v}=x.internals;x.parentId&&x.extent==="parent"?v=wn(v,w,t.get(x.parentId)):g&&(v=Ce(v,g,w));const M={...x,measured:w,internals:{...x.internals,positionAbsolute:v,handleBounds:{source:po("source",y.nodeElement,N,d,x.id),target:po("target",y.nodeElement,N,d,x.id)}}};t.set(x.id,M),x.parentId&&Qt(M,t,o,{nodeOrigin:r,zIndexMode:a}),l=!0,b&&(u.push({id:x.id,type:"dimensions",dimensions:w}),x.expandParent&&x.parentId&&h.push({id:x.id,parentId:x.parentId,rect:ze(M,r)}))}}if(h.length>0){const y=Jt(h,t,o,r);u.push(...y)}return{changes:u,updatedInternals:l}}async function ja({delta:e,panZoom:t,transform:o,translateExtent:n,width:r,height:s}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const a=await t.setViewportConstrained({x:o[0]+e.x,y:o[1]+e.y,zoom:o[2]},[[0,0],[r,s]],n),c=!!a&&(a.x!==o[0]||a.y!==o[1]||a.k!==o[2]);return Promise.resolve(c)}function jo(e,t,o,n,r,s){let a=r;const c=n.get(a)||new Map;n.set(a,c.set(o,t)),a=`${r}-${e}`;const l=n.get(a)||new Map;if(n.set(a,l.set(o,t)),s){a=`${r}-${e}-${s}`;const u=n.get(a)||new Map;n.set(a,u.set(o,t))}}function zn(e,t,o){e.clear(),t.clear();for(const n of o){const{source:r,target:s,sourceHandle:a=null,targetHandle:c=null}=n,l={edgeId:n.id,source:r,target:s,sourceHandle:a,targetHandle:c},u=`${r}-${a}--${s}-${c}`,p=`${s}-${c}--${r}-${a}`;jo("source",l,p,e,r,a),jo("target",l,u,e,s,c),t.set(n.id,n)}}function Ln(e,t){if(!e.parentId)return!1;const o=t.get(e.parentId);return o?o.selected?!0:Ln(o,t):!1}function Eo(e,t,o){var r;let n=e;do{if((r=n==null?void 0:n.matches)!=null&&r.call(n,t))return!0;if(n===o)return!1;n=n==null?void 0:n.parentElement}while(n);return!1}function Ea(e,t,o,n){const r=new Map;for(const[s,a]of e)if((a.selected||a.id===n)&&(!a.parentId||!Ln(a,e))&&(a.draggable||t&&typeof a.draggable>"u")){const c=e.get(s);c&&r.set(s,{id:s,position:c.position||{x:0,y:0},distance:{x:o.x-c.internals.positionAbsolute.x,y:o.y-c.internals.positionAbsolute.y},extent:c.extent,parentId:c.parentId,origin:c.origin,expandParent:c.expandParent,internals:{positionAbsolute:c.internals.positionAbsolute||{x:0,y:0}},measured:{width:c.measured.width??0,height:c.measured.height??0}})}return r}function _t({nodeId:e,dragItems:t,nodeLookup:o,dragging:n=!0}){var a,c,l;const r=[];for(const[u,p]of t){const d=(a=o.get(u))==null?void 0:a.internals.userNode;d&&r.push({...d,position:p.position,dragging:n})}if(!e)return[r[0],r];const s=(c=o.get(e))==null?void 0:c.internals.userNode;return[s?{...s,position:((l=t.get(e))==null?void 0:l.position)||s.position,dragging:n}:r[0],r]}function Sa({dragItems:e,snapGrid:t,x:o,y:n}){const r=e.values().next().value;if(!r)return null;const s={x:o-r.distance.x,y:n-r.distance.y},a=Qe(s,t);return{x:a.x-s.x,y:a.y-s.y}}function Ca({onNodeMouseDown:e,getStoreItems:t,onDragStart:o,onDrag:n,onDragStop:r}){let s={x:null,y:null},a=0,c=new Map,l=!1,u={x:0,y:0},p=null,d=!1,h=null,y=!1,x=!1,w=null;function b({noDragClassName:N,handleSelector:g,domNode:v,isSelectable:M,nodeId:E,nodeClickDistance:_=0}){h=ie(v);function T({x:P,y:B}){const{nodeLookup:f,nodeExtent:j,snapGrid:S,snapToGrid:A,nodeOrigin:k,onNodeDrag:C,onSelectionDrag:V,onError:W,updateNodePositions:F}=t();s={x:P,y:B};let G=!1;const R=c.size>1,L=R&&j?Rt(Ze(c)):null,D=R&&A?Sa({dragItems:c,snapGrid:S,x:P,y:B}):null;for(const[O,H]of c){if(!f.has(O))continue;let Y={x:P-H.distance.x,y:B-H.distance.y};A&&(Y=D?{x:Math.round(Y.x+D.x),y:Math.round(Y.y+D.y)}:Qe(Y,S));let K=null;if(R&&j&&!H.extent&&L){const{positionAbsolute:Z}=H.internals,te=Z.x-L.x+j[0][0],oe=Z.x+H.measured.width-L.x2+j[1][0],ee=Z.y-L.y+j[0][1],ae=Z.y+H.measured.height-L.y2+j[1][1];K=[[te,ee],[oe,ae]]}const{position:U,positionAbsolute:Q}=vn({nodeId:O,nextPosition:Y,nodeLookup:f,nodeExtent:K||j,nodeOrigin:k,onError:W});G=G||H.position.x!==U.x||H.position.y!==U.y,H.position=U,H.internals.positionAbsolute=Q}if(x=x||G,!!G&&(F(c,!0),w&&(n||C||!E&&V))){const[O,H]=_t({nodeId:E,dragItems:c,nodeLookup:f});n==null||n(w,c,O,H),C==null||C(w,O,H),E||V==null||V(w,H)}}async function z(){if(!p)return;const{transform:P,panBy:B,autoPanSpeed:f,autoPanOnNodeDrag:j}=t();if(!j){l=!1,cancelAnimationFrame(a);return}const[S,A]=Nn(u,p,f);(S!==0||A!==0)&&(s.x=(s.x??0)-S/P[2],s.y=(s.y??0)-A/P[2],await B({x:S,y:A})&&T(s)),a=requestAnimationFrame(z)}function X(P){var R;const{nodeLookup:B,multiSelectionActive:f,nodesDraggable:j,transform:S,snapGrid:A,snapToGrid:k,selectNodesOnDrag:C,onNodeDragStart:V,onSelectionDragStart:W,unselectNodesAndEdges:F}=t();d=!0,(!C||!M)&&!f&&E&&((R=B.get(E))!=null&&R.selected||F()),M&&C&&E&&(e==null||e(E));const G=Fe(P.sourceEvent,{transform:S,snapGrid:A,snapToGrid:k,containerBounds:p});if(s=G,c=Ea(B,j,G,E),c.size>0&&(o||V||!E&&W)){const[L,D]=_t({nodeId:E,dragItems:c,nodeLookup:B});o==null||o(P.sourceEvent,c,L,D),V==null||V(P.sourceEvent,L,D),E||W==null||W(P.sourceEvent,D)}}const $=hn().clickDistance(_).on("start",P=>{const{domNode:B,nodeDragThreshold:f,transform:j,snapGrid:S,snapToGrid:A}=t();p=(B==null?void 0:B.getBoundingClientRect())||null,y=!1,x=!1,w=P.sourceEvent,f===0&&X(P),s=Fe(P.sourceEvent,{transform:j,snapGrid:S,snapToGrid:A,containerBounds:p}),u=ue(P.sourceEvent,p)}).on("drag",P=>{const{autoPanOnNodeDrag:B,transform:f,snapGrid:j,snapToGrid:S,nodeDragThreshold:A,nodeLookup:k}=t(),C=Fe(P.sourceEvent,{transform:f,snapGrid:j,snapToGrid:S,containerBounds:p});if(w=P.sourceEvent,(P.sourceEvent.type==="touchmove"&&P.sourceEvent.touches.length>1||E&&!k.has(E))&&(y=!0),!y){if(!l&&B&&d&&(l=!0,z()),!d){const V=ue(P.sourceEvent,p),W=V.x-u.x,F=V.y-u.y;Math.sqrt(W*W+F*F)>A&&X(P)}(s.x!==C.xSnapped||s.y!==C.ySnapped)&&c&&d&&(u=ue(P.sourceEvent,p),T(C))}}).on("end",P=>{if(!(!d||y)&&(l=!1,d=!1,cancelAnimationFrame(a),c.size>0)){const{nodeLookup:B,updateNodePositions:f,onNodeDragStop:j,onSelectionDragStop:S}=t();if(x&&(f(c,!1),x=!1),r||j||!E&&S){const[A,k]=_t({nodeId:E,dragItems:c,nodeLookup:B,dragging:!1});r==null||r(P.sourceEvent,c,A,k),j==null||j(P.sourceEvent,A,k),E||S==null||S(P.sourceEvent,k)}}}).filter(P=>{const B=P.target;return!P.button&&(!N||!Eo(B,`.${N}`,v))&&(!g||Eo(B,g,v))});h.call($)}function m(){h==null||h.on(".drag",null)}return{update:b,destroy:m}}function ka(e,t,o){const n=[],r={x:e.x-o,y:e.y-o,width:o*2,height:o*2};for(const s of t.values())Ge(r,ze(s))>0&&n.push(s);return n}const _a=250;function Ma(e,t,o,n){var c,l;let r=[],s=1/0;const a=ka(e,o,t+_a);for(const u of a){const p=[...((c=u.internals.handleBounds)==null?void 0:c.source)??[],...((l=u.internals.handleBounds)==null?void 0:l.target)??[]];for(const d of p){if(n.nodeId===d.nodeId&&n.type===d.type&&n.id===d.id)continue;const{x:h,y}=ke(u,d,d.position,!0),x=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(y-e.y,2));x>t||(x<s?(r=[{...d,x:h,y}],s=x):x===s&&r.push({...d,x:h,y}))}}if(!r.length)return null;if(r.length>1){const u=n.type==="source"?"target":"source";return r.find(p=>p.type===u)??r[0]}return r[0]}function Dn(e,t,o,n,r,s=!1){var u,p,d;const a=n.get(e);if(!a)return null;const c=r==="strict"?(u=a.internals.handleBounds)==null?void 0:u[t]:[...((p=a.internals.handleBounds)==null?void 0:p.source)??[],...((d=a.internals.handleBounds)==null?void 0:d.target)??[]],l=(o?c==null?void 0:c.find(h=>h.id===o):c==null?void 0:c[0])??null;return l&&s?{...l,...ke(a,l,l.position,!0)}:l}function Rn(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Ia(e,t){let o=null;return t?o=!0:e&&!t&&(o=!1),o}const Vn=()=>!0;function Aa(e,{connectionMode:t,connectionRadius:o,handleId:n,nodeId:r,edgeUpdaterType:s,isTarget:a,domNode:c,nodeLookup:l,lib:u,autoPanOnConnect:p,flowId:d,panBy:h,cancelConnection:y,onConnectStart:x,onConnect:w,onConnectEnd:b,isValidConnection:m=Vn,onReconnectEnd:N,updateConnection:g,getTransform:v,getFromHandle:M,autoPanSpeed:E,dragThreshold:_=1,handleDomNode:T}){const z=Cn(e.target);let X=0,$;const{x:P,y:B}=ue(e),f=Rn(s,T),j=c==null?void 0:c.getBoundingClientRect();let S=!1;if(!j||!f)return;const A=Dn(r,f,n,l,t);if(!A)return;let k=ue(e,j),C=!1,V=null,W=!1,F=null;function G(){if(!p||!j)return;const[U,Q]=Nn(k,j,E);h({x:U,y:Q}),X=requestAnimationFrame(G)}const R={...A,nodeId:r,type:f,position:A.position},L=l.get(r);let O={inProgress:!0,isValid:null,from:ke(L,R,q.Left,!0),fromHandle:R,fromPosition:R.position,fromNode:L,to:k,toHandle:null,toPosition:fo[R.position],toNode:null,pointer:k};function H(){S=!0,g(O),x==null||x(e,{nodeId:r,handleId:n,handleType:f})}_===0&&H();function Y(U){if(!S){const{x:ae,y:ge}=ue(U),fe=ae-P,je=ge-B;if(!(fe*fe+je*je>_*_))return;H()}if(!M()||!R){K(U);return}const Q=v();k=ue(U,j),$=Ma(Je(k,Q,!1,[1,1]),o,l,R),C||(G(),C=!0);const Z=Hn(U,{handle:$,connectionMode:t,fromNodeId:r,fromHandleId:n,fromType:a?"target":"source",isValidConnection:m,doc:z,lib:u,flowId:d,nodeLookup:l});F=Z.handleDomNode,V=Z.connection,W=Ia(!!$,Z.isValid);const te=l.get(r),oe=te?ke(te,R,q.Left,!0):O.from,ee={...O,from:oe,isValid:W,to:Z.toHandle&&W?ut({x:Z.toHandle.x,y:Z.toHandle.y},Q):k,toHandle:Z.toHandle,toPosition:W&&Z.toHandle?Z.toHandle.position:fo[R.position],toNode:Z.toHandle?l.get(Z.toHandle.nodeId):null,pointer:k};g(ee),O=ee}function K(U){if(!("touches"in U&&U.touches.length>0)){if(S){($||F)&&V&&W&&(w==null||w(V));const{inProgress:Q,...Z}=O,te={...Z,toPosition:O.toHandle?O.toPosition:null};b==null||b(U,te),s&&(N==null||N(U,te))}y(),cancelAnimationFrame(X),C=!1,W=!1,V=null,F=null,z.removeEventListener("mousemove",Y),z.removeEventListener("mouseup",K),z.removeEventListener("touchmove",Y),z.removeEventListener("touchend",K)}}z.addEventListener("mousemove",Y),z.addEventListener("mouseup",K),z.addEventListener("touchmove",Y),z.addEventListener("touchend",K)}function Hn(e,{handle:t,connectionMode:o,fromNodeId:n,fromHandleId:r,fromType:s,doc:a,lib:c,flowId:l,isValidConnection:u=Vn,nodeLookup:p}){const d=s==="target",h=t?a.querySelector(`.${c}-flow__handle[data-id="${l}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:y,y:x}=ue(e),w=a.elementFromPoint(y,x),b=w!=null&&w.classList.contains(`${c}-flow__handle`)?w:h,m={handleDomNode:b,isValid:!1,connection:null,toHandle:null};if(b){const N=Rn(void 0,b),g=b.getAttribute("data-nodeid"),v=b.getAttribute("data-handleid"),M=b.classList.contains("connectable"),E=b.classList.contains("connectableend");if(!g||!N)return m;const _={source:d?g:n,sourceHandle:d?v:r,target:d?n:g,targetHandle:d?r:v};m.connection=_;const z=M&&E&&(o===Pe.Strict?d&&N==="source"||!d&&N==="target":g!==n||v!==r);m.isValid=z&&u(_),m.toHandle=Dn(g,N,v,p,o,!0)}return m}const Ot={onPointerDown:Aa,isValid:Hn};function $a({domNode:e,panZoom:t,getTransform:o,getViewScale:n}){const r=ie(e);function s({translateExtent:c,width:l,height:u,zoomStep:p=1,pannable:d=!0,zoomable:h=!0,inversePan:y=!1}){const x=g=>{if(g.sourceEvent.type!=="wheel"||!t)return;const v=o(),M=g.sourceEvent.ctrlKey&&qe()?10:1,E=-g.sourceEvent.deltaY*(g.sourceEvent.deltaMode===1?.05:g.sourceEvent.deltaMode?1:.002)*p,_=v[2]*Math.pow(2,E*M);t.scaleTo(_)};let w=[0,0];const b=g=>{(g.sourceEvent.type==="mousedown"||g.sourceEvent.type==="touchstart")&&(w=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY])},m=g=>{const v=o();if(g.sourceEvent.type!=="mousemove"&&g.sourceEvent.type!=="touchmove"||!t)return;const M=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY],E=[M[0]-w[0],M[1]-w[1]];w=M;const _=n()*Math.max(v[2],Math.log(v[2]))*(y?-1:1),T={x:v[0]-E[0]*_,y:v[1]-E[1]*_},z=[[0,0],[l,u]];t.setViewportConstrained({x:T.x,y:T.y,zoom:v[2]},z,c)},N=gn().on("start",b).on("zoom",d?m:null).on("zoom.wheel",h?x:null);r.call(N,{})}function a(){r.on("zoom",null)}return{update:s,destroy:a,pointer:ce}}const gt=e=>({x:e.x,y:e.y,zoom:e.k}),Mt=({x:e,y:t,zoom:o})=>Wt.translate(e,t).scale(o),Ie=(e,t)=>e.target.closest(`.${t}`),Bn=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Pa=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,It=(e,t=0,o=Pa,n=()=>{})=>{const r=typeof t=="number"&&t>0;return r||n(),r?e.transition().duration(t).ease(o).on("end",n):e},On=e=>{const t=e.ctrlKey&&qe()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Ta({zoomPanValues:e,noWheelClassName:t,d3Selection:o,d3Zoom:n,panOnScrollMode:r,panOnScrollSpeed:s,zoomOnPinch:a,onPanZoomStart:c,onPanZoom:l,onPanZoomEnd:u}){return p=>{if(Ie(p,t))return p.ctrlKey&&p.preventDefault(),!1;p.preventDefault(),p.stopImmediatePropagation();const d=o.property("__zoom").k||1;if(p.ctrlKey&&a){const b=ce(p),m=On(p),N=d*Math.pow(2,m);n.scaleTo(o,N,b,p);return}const h=p.deltaMode===1?20:1;let y=r===Se.Vertical?0:p.deltaX*h,x=r===Se.Horizontal?0:p.deltaY*h;!qe()&&p.shiftKey&&r!==Se.Vertical&&(y=p.deltaY*h,x=0),n.translateBy(o,-(y/d)*s,-(x/d)*s,{internal:!0});const w=gt(o.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(l==null||l(p,w),e.panScrollTimeout=setTimeout(()=>{u==null||u(p,w),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,c==null||c(p,w))}}function za({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:o}){return function(n,r){const s=n.type==="wheel",a=!t&&s&&!n.ctrlKey,c=Ie(n,e);if(n.ctrlKey&&s&&c&&n.preventDefault(),a||c)return null;n.preventDefault(),o.call(this,n,r)}}function La({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:o}){return n=>{var s,a,c;if((s=n.sourceEvent)!=null&&s.internal)return;const r=gt(n.transform);e.mouseButton=((a=n.sourceEvent)==null?void 0:a.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=r,((c=n.sourceEvent)==null?void 0:c.type)==="mousedown"&&t(!0),o&&(o==null||o(n.sourceEvent,r))}}function Da({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:o,onTransformChange:n,onPanZoom:r}){return s=>{var a,c;e.usedRightMouseButton=!!(o&&Bn(t,e.mouseButton??0)),(a=s.sourceEvent)!=null&&a.sync||n([s.transform.x,s.transform.y,s.transform.k]),r&&!((c=s.sourceEvent)!=null&&c.internal)&&(r==null||r(s.sourceEvent,gt(s.transform)))}}function Ra({zoomPanValues:e,panOnDrag:t,panOnScroll:o,onDraggingChange:n,onPanZoomEnd:r,onPaneContextMenu:s}){return a=>{var c;if(!((c=a.sourceEvent)!=null&&c.internal)&&(e.isZoomingOrPanning=!1,s&&Bn(t,e.mouseButton??0)&&!e.usedRightMouseButton&&a.sourceEvent&&s(a.sourceEvent),e.usedRightMouseButton=!1,n(!1),r)){const l=gt(a.transform);e.prevViewport=l,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{r==null||r(a.sourceEvent,l)},o?150:0)}}}function Va({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:o,panOnDrag:n,panOnScroll:r,zoomOnDoubleClick:s,userSelectionActive:a,noWheelClassName:c,noPanClassName:l,lib:u,connectionInProgress:p}){return d=>{var b;const h=e||t,y=o&&d.ctrlKey,x=d.type==="wheel";if(d.button===1&&d.type==="mousedown"&&(Ie(d,`${u}-flow__node`)||Ie(d,`${u}-flow__edge`)))return!0;if(!n&&!h&&!r&&!s&&!o||a||p&&!x||Ie(d,c)&&x||Ie(d,l)&&(!x||r&&x&&!e)||!o&&d.ctrlKey&&x)return!1;if(!o&&d.type==="touchstart"&&((b=d.touches)==null?void 0:b.length)>1)return d.preventDefault(),!1;if(!h&&!r&&!y&&x||!n&&(d.type==="mousedown"||d.type==="touchstart")||Array.isArray(n)&&!n.includes(d.button)&&d.type==="mousedown")return!1;const w=Array.isArray(n)&&n.includes(d.button)||!d.button||d.button<=1;return(!d.ctrlKey||x)&&w}}function Ha({domNode:e,minZoom:t,maxZoom:o,translateExtent:n,viewport:r,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:c,onDraggingChange:l}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},p=e.getBoundingClientRect(),d=gn().scaleExtent([t,o]).translateExtent(n),h=ie(e).call(d);N({x:r.x,y:r.y,zoom:Te(r.zoom,t,o)},[[0,0],[p.width,p.height]],n);const y=h.on("wheel.zoom"),x=h.on("dblclick.zoom");d.wheelDelta(On);function w($,P){return h?new Promise(B=>{d==null||d.interpolate((P==null?void 0:P.interpolate)==="linear"?St:ct).transform(It(h,P==null?void 0:P.duration,P==null?void 0:P.ease,()=>B(!0)),$)}):Promise.resolve(!1)}function b({noWheelClassName:$,noPanClassName:P,onPaneContextMenu:B,userSelectionActive:f,panOnScroll:j,panOnDrag:S,panOnScrollMode:A,panOnScrollSpeed:k,preventScrolling:C,zoomOnPinch:V,zoomOnScroll:W,zoomOnDoubleClick:F,zoomActivationKeyPressed:G,lib:R,onTransformChange:L,connectionInProgress:D,paneClickDistance:O,selectionOnDrag:H}){f&&!u.isZoomingOrPanning&&m();const Y=j&&!G&&!f;d.clickDistance(H?1/0:!le(O)||O<0?0:O);const K=Y?Ta({zoomPanValues:u,noWheelClassName:$,d3Selection:h,d3Zoom:d,panOnScrollMode:A,panOnScrollSpeed:k,zoomOnPinch:V,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:c}):za({noWheelClassName:$,preventScrolling:C,d3ZoomHandler:y});if(h.on("wheel.zoom",K,{passive:!1}),!f){const Q=La({zoomPanValues:u,onDraggingChange:l,onPanZoomStart:a});d.on("start",Q);const Z=Da({zoomPanValues:u,panOnDrag:S,onPaneContextMenu:!!B,onPanZoom:s,onTransformChange:L});d.on("zoom",Z);const te=Ra({zoomPanValues:u,panOnDrag:S,panOnScroll:j,onPaneContextMenu:B,onPanZoomEnd:c,onDraggingChange:l});d.on("end",te)}const U=Va({zoomActivationKeyPressed:G,panOnDrag:S,zoomOnScroll:W,panOnScroll:j,zoomOnDoubleClick:F,zoomOnPinch:V,userSelectionActive:f,noPanClassName:P,noWheelClassName:$,lib:R,connectionInProgress:D});d.filter(U),F?h.on("dblclick.zoom",x):h.on("dblclick.zoom",null)}function m(){d.on("zoom",null)}async function N($,P,B){const f=Mt($),j=d==null?void 0:d.constrain()(f,P,B);return j&&await w(j),new Promise(S=>S(j))}async function g($,P){const B=Mt($);return await w(B,P),new Promise(f=>f(B))}function v($){if(h){const P=Mt($),B=h.property("__zoom");(B.k!==$.zoom||B.x!==$.x||B.y!==$.y)&&(d==null||d.transform(h,P,null,{sync:!0}))}}function M(){const $=h?Is(h.node()):{x:0,y:0,k:1};return{x:$.x,y:$.y,zoom:$.k}}function E($,P){return h?new Promise(B=>{d==null||d.interpolate((P==null?void 0:P.interpolate)==="linear"?St:ct).scaleTo(It(h,P==null?void 0:P.duration,P==null?void 0:P.ease,()=>B(!0)),$)}):Promise.resolve(!1)}function _($,P){return h?new Promise(B=>{d==null||d.interpolate((P==null?void 0:P.interpolate)==="linear"?St:ct).scaleBy(It(h,P==null?void 0:P.duration,P==null?void 0:P.ease,()=>B(!0)),$)}):Promise.resolve(!1)}function T($){d==null||d.scaleExtent($)}function z($){d==null||d.translateExtent($)}function X($){const P=!le($)||$<0?0:$;d==null||d.clickDistance(P)}return{update:b,destroy:m,setViewport:g,setViewportConstrained:N,getViewport:M,scaleTo:E,scaleBy:_,setScaleExtent:T,setTranslateExtent:z,syncViewport:v,setClickDistance:X}}var De;(function(e){e.Line="line",e.Handle="handle"})(De||(De={}));function Ba({width:e,prevWidth:t,height:o,prevHeight:n,affectsX:r,affectsY:s}){const a=e-t,c=o-n,l=[a>0?1:a<0?-1:0,c>0?1:c<0?-1:0];return a&&r&&(l[0]=l[0]*-1),c&&s&&(l[1]=l[1]*-1),l}function So(e){const t=e.includes("right")||e.includes("left"),o=e.includes("bottom")||e.includes("top"),n=e.includes("left"),r=e.includes("top");return{isHorizontal:t,isVertical:o,affectsX:n,affectsY:r}}function xe(e,t){return Math.max(0,t-e)}function pe(e,t){return Math.max(0,e-t)}function st(e,t,o){return Math.max(0,t-e,e-o)}function Co(e,t){return e?!t:t}function Oa(e,t,o,n,r,s,a,c){let{affectsX:l,affectsY:u}=t;const{isHorizontal:p,isVertical:d}=t,h=p&&d,{xSnapped:y,ySnapped:x}=o,{minWidth:w,maxWidth:b,minHeight:m,maxHeight:N}=n,{x:g,y:v,width:M,height:E,aspectRatio:_}=e;let T=Math.floor(p?y-e.pointerX:0),z=Math.floor(d?x-e.pointerY:0);const X=M+(l?-T:T),$=E+(u?-z:z),P=-s[0]*M,B=-s[1]*E;let f=st(X,w,b),j=st($,m,N);if(a){let k=0,C=0;l&&T<0?k=xe(g+T+P,a[0][0]):!l&&T>0&&(k=pe(g+X+P,a[1][0])),u&&z<0?C=xe(v+z+B,a[0][1]):!u&&z>0&&(C=pe(v+$+B,a[1][1])),f=Math.max(f,k),j=Math.max(j,C)}if(c){let k=0,C=0;l&&T>0?k=pe(g+T,c[0][0]):!l&&T<0&&(k=xe(g+X,c[1][0])),u&&z>0?C=pe(v+z,c[0][1]):!u&&z<0&&(C=xe(v+$,c[1][1])),f=Math.max(f,k),j=Math.max(j,C)}if(r){if(p){const k=st(X/_,m,N)*_;if(f=Math.max(f,k),a){let C=0;!l&&!u||l&&!u&&h?C=pe(v+B+X/_,a[1][1])*_:C=xe(v+B+(l?T:-T)/_,a[0][1])*_,f=Math.max(f,C)}if(c){let C=0;!l&&!u||l&&!u&&h?C=xe(v+X/_,c[1][1])*_:C=pe(v+(l?T:-T)/_,c[0][1])*_,f=Math.max(f,C)}}if(d){const k=st($*_,w,b)/_;if(j=Math.max(j,k),a){let C=0;!l&&!u||u&&!l&&h?C=pe(g+$*_+P,a[1][0])/_:C=xe(g+(u?z:-z)*_+P,a[0][0])/_,j=Math.max(j,C)}if(c){let C=0;!l&&!u||u&&!l&&h?C=xe(g+$*_,c[1][0])/_:C=pe(g+(u?z:-z)*_,c[0][0])/_,j=Math.max(j,C)}}}z=z+(z<0?j:-j),T=T+(T<0?f:-f),r&&(h?X>$*_?z=(Co(l,u)?-T:T)/_:T=(Co(l,u)?-z:z)*_:p?(z=T/_,u=l):(T=z*_,l=u));const S=l?g+T:g,A=u?v+z:v;return{width:M+(l?-T:T),height:E+(u?-z:z),x:s[0]*T*(l?-1:1)+S,y:s[1]*z*(u?-1:1)+A}}const Fn={width:0,height:0,x:0,y:0},Fa={...Fn,pointerX:0,pointerY:0,aspectRatio:1};function Wa(e){return[[0,0],[e.measured.width,e.measured.height]]}function Xa(e,t,o){const n=t.position.x+e.position.x,r=t.position.y+e.position.y,s=e.measured.width??0,a=e.measured.height??0,c=o[0]*s,l=o[1]*a;return[[n-c,r-l],[n+s-c,r+a-l]]}function Ya({domNode:e,nodeId:t,getStoreItems:o,onChange:n,onEnd:r}){const s=ie(e);let a={controlDirection:So("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function c({controlPosition:u,boundaries:p,keepAspectRatio:d,resizeDirection:h,onResizeStart:y,onResize:x,onResizeEnd:w,shouldResize:b}){let m={...Fn},N={...Fa};a={boundaries:p,resizeDirection:h,keepAspectRatio:d,controlDirection:So(u)};let g,v=null,M=[],E,_,T,z=!1;const X=hn().on("start",$=>{const{nodeLookup:P,transform:B,snapGrid:f,snapToGrid:j,nodeOrigin:S,paneDomNode:A}=o();if(g=P.get(t),!g)return;v=(A==null?void 0:A.getBoundingClientRect())??null;const{xSnapped:k,ySnapped:C}=Fe($.sourceEvent,{transform:B,snapGrid:f,snapToGrid:j,containerBounds:v});m={width:g.measured.width??0,height:g.measured.height??0,x:g.position.x??0,y:g.position.y??0},N={...m,pointerX:k,pointerY:C,aspectRatio:m.width/m.height},E=void 0,g.parentId&&(g.extent==="parent"||g.expandParent)&&(E=P.get(g.parentId),_=E&&g.extent==="parent"?Wa(E):void 0),M=[],T=void 0;for(const[V,W]of P)if(W.parentId===t&&(M.push({id:V,position:{...W.position},extent:W.extent}),W.extent==="parent"||W.expandParent)){const F=Xa(W,g,W.origin??S);T?T=[[Math.min(F[0][0],T[0][0]),Math.min(F[0][1],T[0][1])],[Math.max(F[1][0],T[1][0]),Math.max(F[1][1],T[1][1])]]:T=F}y==null||y($,{...m})}).on("drag",$=>{const{transform:P,snapGrid:B,snapToGrid:f,nodeOrigin:j}=o(),S=Fe($.sourceEvent,{transform:P,snapGrid:B,snapToGrid:f,containerBounds:v}),A=[];if(!g)return;const{x:k,y:C,width:V,height:W}=m,F={},G=g.origin??j,{width:R,height:L,x:D,y:O}=Oa(N,a.controlDirection,S,a.boundaries,a.keepAspectRatio,G,_,T),H=R!==V,Y=L!==W,K=D!==k&&H,U=O!==C&&Y;if(!K&&!U&&!H&&!Y)return;if((K||U||G[0]===1||G[1]===1)&&(F.x=K?D:m.x,F.y=U?O:m.y,m.x=F.x,m.y=F.y,M.length>0)){const oe=D-k,ee=O-C;for(const ae of M)ae.position={x:ae.position.x-oe+G[0]*(R-V),y:ae.position.y-ee+G[1]*(L-W)},A.push(ae)}if((H||Y)&&(F.width=H&&(!a.resizeDirection||a.resizeDirection==="horizontal")?R:m.width,F.height=Y&&(!a.resizeDirection||a.resizeDirection==="vertical")?L:m.height,m.width=F.width,m.height=F.height),E&&g.expandParent){const oe=G[0]*(F.width??0);F.x&&F.x<oe&&(m.x=oe,N.x=N.x-(F.x-oe));const ee=G[1]*(F.height??0);F.y&&F.y<ee&&(m.y=ee,N.y=N.y-(F.y-ee))}const Q=Ba({width:m.width,prevWidth:V,height:m.height,prevHeight:W,affectsX:a.controlDirection.affectsX,affectsY:a.controlDirection.affectsY}),Z={...m,direction:Q};(b==null?void 0:b($,Z))!==!1&&(z=!0,x==null||x($,Z),n(F,A))}).on("end",$=>{z&&(w==null||w($,{...m}),r==null||r({...m}),z=!1)});s.call(X)}function l(){s.on(".drag",null)}return{update:c,destroy:l}}var At={exports:{}},$t={},Pt={exports:{}},Tt={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ko;function Ga(){if(ko)return Tt;ko=1;var e=un();function t(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var o=typeof Object.is=="function"?Object.is:t,n=e.useState,r=e.useEffect,s=e.useLayoutEffect,a=e.useDebugValue;function c(d,h){var y=h(),x=n({inst:{value:y,getSnapshot:h}}),w=x[0].inst,b=x[1];return s(function(){w.value=y,w.getSnapshot=h,l(w)&&b({inst:w})},[d,y,h]),r(function(){return l(w)&&b({inst:w}),d(function(){l(w)&&b({inst:w})})},[d]),a(y),y}function l(d){var h=d.getSnapshot;d=d.value;try{var y=h();return!o(d,y)}catch{return!0}}function u(d,h){return h()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:c;return Tt.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:p,Tt}var _o;function qa(){return _o||(_o=1,Pt.exports=Ga()),Pt.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mo;function Ka(){if(Mo)return $t;Mo=1;var e=un(),t=qa();function o(u,p){return u===p&&(u!==0||1/u===1/p)||u!==u&&p!==p}var n=typeof Object.is=="function"?Object.is:o,r=t.useSyncExternalStore,s=e.useRef,a=e.useEffect,c=e.useMemo,l=e.useDebugValue;return $t.useSyncExternalStoreWithSelector=function(u,p,d,h,y){var x=s(null);if(x.current===null){var w={hasValue:!1,value:null};x.current=w}else w=x.current;x=c(function(){function m(E){if(!N){if(N=!0,g=E,E=h(E),y!==void 0&&w.hasValue){var _=w.value;if(y(_,E))return v=_}return v=E}if(_=v,n(g,E))return _;var T=h(E);return y!==void 0&&y(_,T)?(g=E,_):(g=E,v=T)}var N=!1,g,v,M=d===void 0?null:d;return[function(){return m(p())},M===null?void 0:function(){return m(M())}]},[p,d,h,y]);var b=r(u,x[0],x[1]);return a(function(){w.hasValue=!0,w.value=b},[b]),l(b),b},$t}var Io;function Ua(){return Io||(Io=1,At.exports=Ka()),At.exports}var Za=Ua();const Qa=As(Za),Ja={},Ao=e=>{let t;const o=new Set,n=(p,d)=>{const h=typeof p=="function"?p(t):p;if(!Object.is(h,t)){const y=t;t=d??(typeof h!="object"||h===null)?h:Object.assign({},t,h),o.forEach(x=>x(t,y))}},r=()=>t,l={setState:n,getState:r,getInitialState:()=>u,subscribe:p=>(o.add(p),()=>o.delete(p)),destroy:()=>{(Ja?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},u=t=e(n,r,l);return l},ei=e=>e?Ao(e):Ao,{useDebugValue:ti}=$s,{useSyncExternalStoreWithSelector:oi}=Qa,ni=e=>e;function Wn(e,t=ni,o){const n=oi(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,o);return ti(n),n}const $o=(e,t)=>{const o=ei(e),n=(r,s=t)=>Wn(o,r,s);return Object.assign(n,o),n},ri=(e,t)=>e?$o(e,t):$o;function ne(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,r]of e)if(!Object.is(r,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const o=Object.keys(e);if(o.length!==Object.keys(t).length)return!1;for(const n of o)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0}const xt=I.createContext(null),si=xt.Provider,Xn=de.error001();function J(e,t){const o=I.useContext(xt);if(o===null)throw new Error(Xn);return Wn(o,e,t)}function re(){const e=I.useContext(xt);if(e===null)throw new Error(Xn);return I.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Po={display:"none"},ai={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Yn="react-flow__node-desc",Gn="react-flow__edge-desc",ii="react-flow__aria-live",ci=e=>e.ariaLiveMessage,li=e=>e.ariaLabelConfig;function ui({rfId:e}){const t=J(ci);return i.jsx("div",{id:`${ii}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:ai,children:t})}function di({rfId:e,disableKeyboardA11y:t}){const o=J(li);return i.jsxs(i.Fragment,{children:[i.jsx("div",{id:`${Yn}-${e}`,style:Po,children:t?o["node.a11yDescription.default"]:o["node.a11yDescription.keyboardDisabled"]}),i.jsx("div",{id:`${Gn}-${e}`,style:Po,children:o["edge.a11yDescription.default"]}),!t&&i.jsx(ui,{rfId:e})]})}const pt=I.forwardRef(({position:e="top-left",children:t,className:o,style:n,...r},s)=>{const a=`${e}`.split("-");return i.jsx("div",{className:se(["react-flow__panel",o,...a]),style:n,ref:s,...r,children:t})});pt.displayName="Panel";function fi({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:i.jsx(pt,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:i.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const hi=e=>{const t=[],o=[];for(const[,n]of e.nodeLookup)n.selected&&t.push(n.internals.userNode);for(const[,n]of e.edgeLookup)n.selected&&o.push(n);return{selectedNodes:t,selectedEdges:o}},at=e=>e.id;function gi(e,t){return ne(e.selectedNodes.map(at),t.selectedNodes.map(at))&&ne(e.selectedEdges.map(at),t.selectedEdges.map(at))}function xi({onSelectionChange:e}){const t=re(),{selectedNodes:o,selectedEdges:n}=J(hi,gi);return I.useEffect(()=>{const r={nodes:o,edges:n};e==null||e(r),t.getState().onSelectionChangeHandlers.forEach(s=>s(r))},[o,n,e]),null}const pi=e=>!!e.onSelectionChangeHandlers;function mi({onSelectionChange:e}){const t=J(pi);return e||t?i.jsx(xi,{onSelectionChange:e}):null}const qn=[0,0],yi={x:0,y:0,zoom:1},bi=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],To=[...bi,"rfId"],vi=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),zo={translateExtent:Xe,nodeOrigin:qn,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function wi(e){const{setNodes:t,setEdges:o,setMinZoom:n,setMaxZoom:r,setTranslateExtent:s,setNodeExtent:a,reset:c,setDefaultNodesAndEdges:l}=J(vi,ne),u=re();I.useEffect(()=>(l(e.defaultNodes,e.defaultEdges),()=>{p.current=zo,c()}),[]);const p=I.useRef(zo);return I.useEffect(()=>{for(const d of To){const h=e[d],y=p.current[d];h!==y&&(typeof e[d]>"u"||(d==="nodes"?t(h):d==="edges"?o(h):d==="minZoom"?n(h):d==="maxZoom"?r(h):d==="translateExtent"?s(h):d==="nodeExtent"?a(h):d==="ariaLabelConfig"?u.setState({ariaLabelConfig:ra(h)}):d==="fitView"?u.setState({fitViewQueued:h}):d==="fitViewOptions"?u.setState({fitViewOptions:h}):u.setState({[d]:h})))}p.current=e},To.map(d=>e[d])),null}function Lo(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function Ni(e){var n;const[t,o]=I.useState(e==="system"?null:e);return I.useEffect(()=>{if(e!=="system"){o(e);return}const r=Lo(),s=()=>o(r!=null&&r.matches?"dark":"light");return s(),r==null||r.addEventListener("change",s),()=>{r==null||r.removeEventListener("change",s)}},[e]),t!==null?t:(n=Lo())!=null&&n.matches?"dark":"light"}const Do=typeof document<"u"?document:null;function Ke(e=null,t={target:Do,actInsideInputWithModifier:!0}){const[o,n]=I.useState(!1),r=I.useRef(!1),s=I.useRef(new Set([])),[a,c]=I.useMemo(()=>{if(e!==null){const u=(Array.isArray(e)?e:[e]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),p=u.reduce((d,h)=>d.concat(...h),[]);return[u,p]}return[[],[]]},[e]);return I.useEffect(()=>{const l=(t==null?void 0:t.target)??Do,u=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const p=y=>{var b,m;if(r.current=y.ctrlKey||y.metaKey||y.shiftKey||y.altKey,(!r.current||r.current&&!u)&&kn(y))return!1;const w=Vo(y.code,c);if(s.current.add(y[w]),Ro(a,s.current,!1)){const N=((m=(b=y.composedPath)==null?void 0:b.call(y))==null?void 0:m[0])||y.target,g=(N==null?void 0:N.nodeName)==="BUTTON"||(N==null?void 0:N.nodeName)==="A";t.preventDefault!==!1&&(r.current||!g)&&y.preventDefault(),n(!0)}},d=y=>{const x=Vo(y.code,c);Ro(a,s.current,!0)?(n(!1),s.current.clear()):s.current.delete(y[x]),y.key==="Meta"&&s.current.clear(),r.current=!1},h=()=>{s.current.clear(),n(!1)};return l==null||l.addEventListener("keydown",p),l==null||l.addEventListener("keyup",d),window.addEventListener("blur",h),window.addEventListener("contextmenu",h),()=>{l==null||l.removeEventListener("keydown",p),l==null||l.removeEventListener("keyup",d),window.removeEventListener("blur",h),window.removeEventListener("contextmenu",h)}}},[e,n]),o}function Ro(e,t,o){return e.filter(n=>o||n.length===t.size).some(n=>n.every(r=>t.has(r)))}function Vo(e,t){return t.includes(e)?"code":"key"}const ji=()=>{const e=re();return I.useMemo(()=>({zoomIn:t=>{const{panZoom:o}=e.getState();return o?o.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:o}=e.getState();return o?o.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,o)=>{const{panZoom:n}=e.getState();return n?n.scaleTo(t,{duration:o==null?void 0:o.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,o)=>{const{transform:[n,r,s],panZoom:a}=e.getState();return a?(await a.setViewport({x:t.x??n,y:t.y??r,zoom:t.zoom??s},o),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,o,n]=e.getState().transform;return{x:t,y:o,zoom:n}},setCenter:async(t,o,n)=>e.getState().setCenter(t,o,n),fitBounds:async(t,o)=>{const{width:n,height:r,minZoom:s,maxZoom:a,panZoom:c}=e.getState(),l=Gt(t,n,r,s,a,(o==null?void 0:o.padding)??.1);return c?(await c.setViewport(l,{duration:o==null?void 0:o.duration,ease:o==null?void 0:o.ease,interpolate:o==null?void 0:o.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,o={})=>{const{transform:n,snapGrid:r,snapToGrid:s,domNode:a}=e.getState();if(!a)return t;const{x:c,y:l}=a.getBoundingClientRect(),u={x:t.x-c,y:t.y-l},p=o.snapGrid??r,d=o.snapToGrid??s;return Je(u,n,d,p)},flowToScreenPosition:t=>{const{transform:o,domNode:n}=e.getState();if(!n)return t;const{x:r,y:s}=n.getBoundingClientRect(),a=ut(t,o);return{x:a.x+r,y:a.y+s}}}),[])};function Kn(e,t){const o=[],n=new Map,r=[];for(const s of e)if(s.type==="add"){r.push(s);continue}else if(s.type==="remove"||s.type==="replace")n.set(s.id,[s]);else{const a=n.get(s.id);a?a.push(s):n.set(s.id,[s])}for(const s of t){const a=n.get(s.id);if(!a){o.push(s);continue}if(a[0].type==="remove")continue;if(a[0].type==="replace"){o.push({...a[0].item});continue}const c={...s};for(const l of a)Ei(l,c);o.push(c)}return r.length&&r.forEach(s=>{s.index!==void 0?o.splice(s.index,0,{...s.item}):o.push({...s.item})}),o}function Ei(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Un(e,t){return Kn(e,t)}function Zn(e,t){return Kn(e,t)}function Ee(e,t){return{id:e,type:"select",selected:t}}function Ae(e,t=new Set,o=!1){const n=[];for(const[r,s]of e){const a=t.has(r);!(s.selected===void 0&&!a)&&s.selected!==a&&(o&&(s.selected=a),n.push(Ee(s.id,a)))}return n}function Ho({items:e=[],lookup:t}){var r;const o=[],n=new Map(e.map(s=>[s.id,s]));for(const[s,a]of e.entries()){const c=t.get(a.id),l=((r=c==null?void 0:c.internals)==null?void 0:r.userNode)??c;l!==void 0&&l!==a&&o.push({id:a.id,item:a,type:"replace"}),l===void 0&&o.push({item:a,type:"add",index:s})}for(const[s]of t)n.get(s)===void 0&&o.push({id:s,type:"remove"});return o}function Bo(e){return{id:e.id,type:"remove"}}const Oo=e=>qs(e),Si=e=>bn(e);function Qn(e){return I.forwardRef(e)}const Ci=typeof window<"u"?I.useLayoutEffect:I.useEffect;function Fo(e){const[t,o]=I.useState(BigInt(0)),[n]=I.useState(()=>ki(()=>o(r=>r+BigInt(1))));return Ci(()=>{const r=n.get();r.length&&(e(r),n.reset())},[t]),n}function ki(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:o=>{t.push(o),e()}}}const Jn=I.createContext(null);function _i({children:e}){const t=re(),o=I.useCallback(c=>{const{nodes:l=[],setNodes:u,hasDefaultNodes:p,onNodesChange:d,nodeLookup:h,fitViewQueued:y,onNodesChangeMiddlewareMap:x}=t.getState();let w=l;for(const m of c)w=typeof m=="function"?m(w):m;let b=Ho({items:w,lookup:h});for(const m of x.values())b=m(b);p&&u(w),b.length>0?d==null||d(b):y&&window.requestAnimationFrame(()=>{const{fitViewQueued:m,nodes:N,setNodes:g}=t.getState();m&&g(N)})},[]),n=Fo(o),r=I.useCallback(c=>{const{edges:l=[],setEdges:u,hasDefaultEdges:p,onEdgesChange:d,edgeLookup:h}=t.getState();let y=l;for(const x of c)y=typeof x=="function"?x(y):x;p?u(y):d&&d(Ho({items:y,lookup:h}))},[]),s=Fo(r),a=I.useMemo(()=>({nodeQueue:n,edgeQueue:s}),[]);return i.jsx(Jn.Provider,{value:a,children:e})}function Mi(){const e=I.useContext(Jn);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Ii=e=>!!e.panZoom;function mt(){const e=ji(),t=re(),o=Mi(),n=J(Ii),r=I.useMemo(()=>{const s=d=>t.getState().nodeLookup.get(d),a=d=>{o.nodeQueue.push(d)},c=d=>{o.edgeQueue.push(d)},l=d=>{var m,N;const{nodeLookup:h,nodeOrigin:y}=t.getState(),x=Oo(d)?d:h.get(d.id),w=x.parentId?Sn(x.position,x.measured,x.parentId,h,y):x.position,b={...x,position:w,width:((m=x.measured)==null?void 0:m.width)??x.width,height:((N=x.measured)==null?void 0:N.height)??x.height};return ze(b)},u=(d,h,y={replace:!1})=>{a(x=>x.map(w=>{if(w.id===d){const b=typeof h=="function"?h(w):h;return y.replace&&Oo(b)?b:{...w,...b}}return w}))},p=(d,h,y={replace:!1})=>{c(x=>x.map(w=>{if(w.id===d){const b=typeof h=="function"?h(w):h;return y.replace&&Si(b)?b:{...w,...b}}return w}))};return{getNodes:()=>t.getState().nodes.map(d=>({...d})),getNode:d=>{var h;return(h=s(d))==null?void 0:h.internals.userNode},getInternalNode:s,getEdges:()=>{const{edges:d=[]}=t.getState();return d.map(h=>({...h}))},getEdge:d=>t.getState().edgeLookup.get(d),setNodes:a,setEdges:c,addNodes:d=>{const h=Array.isArray(d)?d:[d];o.nodeQueue.push(y=>[...y,...h])},addEdges:d=>{const h=Array.isArray(d)?d:[d];o.edgeQueue.push(y=>[...y,...h])},toObject:()=>{const{nodes:d=[],edges:h=[],transform:y}=t.getState(),[x,w,b]=y;return{nodes:d.map(m=>({...m})),edges:h.map(m=>({...m})),viewport:{x,y:w,zoom:b}}},deleteElements:async({nodes:d=[],edges:h=[]})=>{const{nodes:y,edges:x,onNodesDelete:w,onEdgesDelete:b,triggerNodeChanges:m,triggerEdgeChanges:N,onDelete:g,onBeforeDelete:v}=t.getState(),{nodes:M,edges:E}=await Js({nodesToRemove:d,edgesToRemove:h,nodes:y,edges:x,onBeforeDelete:v}),_=E.length>0,T=M.length>0;if(_){const z=E.map(Bo);b==null||b(E),N(z)}if(T){const z=M.map(Bo);w==null||w(M),m(z)}return(T||_)&&(g==null||g({nodes:M,edges:E})),{deletedNodes:M,deletedEdges:E}},getIntersectingNodes:(d,h=!0,y)=>{const x=go(d),w=x?d:l(d),b=y!==void 0;return w?(y||t.getState().nodes).filter(m=>{const N=t.getState().nodeLookup.get(m.id);if(N&&!x&&(m.id===d.id||!N.internals.positionAbsolute))return!1;const g=ze(b?m:N),v=Ge(g,w);return h&&v>0||v>=g.width*g.height||v>=w.width*w.height}):[]},isNodeIntersecting:(d,h,y=!0)=>{const w=go(d)?d:l(d);if(!w)return!1;const b=Ge(w,h);return y&&b>0||b>=h.width*h.height||b>=w.width*w.height},updateNode:u,updateNodeData:(d,h,y={replace:!1})=>{u(d,x=>{const w=typeof h=="function"?h(x):h;return y.replace?{...x,data:w}:{...x,data:{...x.data,...w}}},y)},updateEdge:p,updateEdgeData:(d,h,y={replace:!1})=>{p(d,x=>{const w=typeof h=="function"?h(x):h;return y.replace?{...x,data:w}:{...x,data:{...x.data,...w}}},y)},getNodesBounds:d=>{const{nodeLookup:h,nodeOrigin:y}=t.getState();return Ks(d,{nodeLookup:h,nodeOrigin:y})},getHandleConnections:({type:d,id:h,nodeId:y})=>{var x;return Array.from(((x=t.getState().connectionLookup.get(`${y}-${d}${h?`-${h}`:""}`))==null?void 0:x.values())??[])},getNodeConnections:({type:d,handleId:h,nodeId:y})=>{var x;return Array.from(((x=t.getState().connectionLookup.get(`${y}${d?h?`-${d}-${h}`:`-${d}`:""}`))==null?void 0:x.values())??[])},fitView:async d=>{const h=t.getState().fitViewResolver??na();return t.setState({fitViewQueued:!0,fitViewOptions:d,fitViewResolver:h}),o.nodeQueue.push(y=>[...y]),h.promise}}},[]);return I.useMemo(()=>({...r,...e,viewportInitialized:n}),[n])}const Wo=e=>e.selected,Ai=typeof window<"u"?window:void 0;function $i({deleteKeyCode:e,multiSelectionKeyCode:t}){const o=re(),{deleteElements:n}=mt(),r=Ke(e,{actInsideInputWithModifier:!1}),s=Ke(t,{target:Ai});I.useEffect(()=>{if(r){const{edges:a,nodes:c}=o.getState();n({nodes:c.filter(Wo),edges:a.filter(Wo)}),o.setState({nodesSelectionActive:!1})}},[r]),I.useEffect(()=>{o.setState({multiSelectionActive:s})},[s])}function Pi(e){const t=re();I.useEffect(()=>{const o=()=>{var r,s,a,c;if(!e.current||!(((s=(r=e.current).checkVisibility)==null?void 0:s.call(r))??!0))return!1;const n=qt(e.current);(n.height===0||n.width===0)&&((c=(a=t.getState()).onError)==null||c.call(a,"004",de.error004())),t.setState({width:n.width||500,height:n.height||500})};if(e.current){o(),window.addEventListener("resize",o);const n=new ResizeObserver(()=>o());return n.observe(e.current),()=>{window.removeEventListener("resize",o),n&&e.current&&n.unobserve(e.current)}}},[])}const yt={position:"absolute",width:"100%",height:"100%",top:0,left:0},Ti=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function zi({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:o=!0,panOnScroll:n=!1,panOnScrollSpeed:r=.5,panOnScrollMode:s=Se.Free,zoomOnDoubleClick:a=!0,panOnDrag:c=!0,defaultViewport:l,translateExtent:u,minZoom:p,maxZoom:d,zoomActivationKeyCode:h,preventScrolling:y=!0,children:x,noWheelClassName:w,noPanClassName:b,onViewportChange:m,isControlledViewport:N,paneClickDistance:g,selectionOnDrag:v}){const M=re(),E=I.useRef(null),{userSelectionActive:_,lib:T,connectionInProgress:z}=J(Ti,ne),X=Ke(h),$=I.useRef();Pi(E);const P=I.useCallback(B=>{m==null||m({x:B[0],y:B[1],zoom:B[2]}),N||M.setState({transform:B})},[m,N]);return I.useEffect(()=>{if(E.current){$.current=Ha({domNode:E.current,minZoom:p,maxZoom:d,translateExtent:u,viewport:l,onDraggingChange:S=>M.setState({paneDragging:S}),onPanZoomStart:(S,A)=>{const{onViewportChangeStart:k,onMoveStart:C}=M.getState();C==null||C(S,A),k==null||k(A)},onPanZoom:(S,A)=>{const{onViewportChange:k,onMove:C}=M.getState();C==null||C(S,A),k==null||k(A)},onPanZoomEnd:(S,A)=>{const{onViewportChangeEnd:k,onMoveEnd:C}=M.getState();C==null||C(S,A),k==null||k(A)}});const{x:B,y:f,zoom:j}=$.current.getViewport();return M.setState({panZoom:$.current,transform:[B,f,j],domNode:E.current.closest(".react-flow")}),()=>{var S;(S=$.current)==null||S.destroy()}}},[]),I.useEffect(()=>{var B;(B=$.current)==null||B.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:o,panOnScroll:n,panOnScrollSpeed:r,panOnScrollMode:s,zoomOnDoubleClick:a,panOnDrag:c,zoomActivationKeyPressed:X,preventScrolling:y,noPanClassName:b,userSelectionActive:_,noWheelClassName:w,lib:T,onTransformChange:P,connectionInProgress:z,selectionOnDrag:v,paneClickDistance:g})},[e,t,o,n,r,s,a,c,X,y,b,_,w,T,P,z,v,g]),i.jsx("div",{className:"react-flow__renderer",ref:E,style:yt,children:x})}const Li=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Di(){const{userSelectionActive:e,userSelectionRect:t}=J(Li,ne);return e&&t?i.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const zt=(e,t)=>o=>{o.target===t.current&&(e==null||e(o))},Ri=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function Vi({isSelecting:e,selectionKeyPressed:t,selectionMode:o=Ye.Full,panOnDrag:n,paneClickDistance:r,selectionOnDrag:s,onSelectionStart:a,onSelectionEnd:c,onPaneClick:l,onPaneContextMenu:u,onPaneScroll:p,onPaneMouseEnter:d,onPaneMouseMove:h,onPaneMouseLeave:y,children:x}){const w=re(),{userSelectionActive:b,elementsSelectable:m,dragging:N,connectionInProgress:g}=J(Ri,ne),v=m&&(e||b),M=I.useRef(null),E=I.useRef(),_=I.useRef(new Set),T=I.useRef(new Set),z=I.useRef(!1),X=k=>{if(z.current||g){z.current=!1;return}l==null||l(k),w.getState().resetSelectedElements(),w.setState({nodesSelectionActive:!1})},$=k=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){k.preventDefault();return}u==null||u(k)},P=p?k=>p(k):void 0,B=k=>{z.current&&(k.stopPropagation(),z.current=!1)},f=k=>{var L,D;const{domNode:C}=w.getState();if(E.current=C==null?void 0:C.getBoundingClientRect(),!E.current)return;const V=k.target===M.current;if(!V&&!!k.target.closest(".nokey")||!e||!(s&&V||t)||k.button!==0||!k.isPrimary)return;(D=(L=k.target)==null?void 0:L.setPointerCapture)==null||D.call(L,k.pointerId),z.current=!1;const{x:G,y:R}=ue(k.nativeEvent,E.current);w.setState({userSelectionRect:{width:0,height:0,startX:G,startY:R,x:G,y:R}}),V||(k.stopPropagation(),k.preventDefault())},j=k=>{const{userSelectionRect:C,transform:V,nodeLookup:W,edgeLookup:F,connectionLookup:G,triggerNodeChanges:R,triggerEdgeChanges:L,defaultEdgeOptions:D,resetSelectedElements:O}=w.getState();if(!E.current||!C)return;const{x:H,y:Y}=ue(k.nativeEvent,E.current),{startX:K,startY:U}=C;if(!z.current){const ee=t?0:r;if(Math.hypot(H-K,Y-U)<=ee)return;O(),a==null||a(k)}z.current=!0;const Q={startX:K,startY:U,x:H<K?H:K,y:Y<U?Y:U,width:Math.abs(H-K),height:Math.abs(Y-U)},Z=_.current,te=T.current;_.current=new Set(Yt(W,Q,V,o===Ye.Partial,!0).map(ee=>ee.id)),T.current=new Set;const oe=(D==null?void 0:D.selectable)??!0;for(const ee of _.current){const ae=G.get(ee);if(ae)for(const{edgeId:ge}of ae.values()){const fe=F.get(ge);fe&&(fe.selectable??oe)&&T.current.add(ge)}}if(!xo(Z,_.current)){const ee=Ae(W,_.current,!0);R(ee)}if(!xo(te,T.current)){const ee=Ae(F,T.current);L(ee)}w.setState({userSelectionRect:Q,userSelectionActive:!0,nodesSelectionActive:!1})},S=k=>{var C,V;k.button===0&&((V=(C=k.target)==null?void 0:C.releasePointerCapture)==null||V.call(C,k.pointerId),!b&&k.target===M.current&&w.getState().userSelectionRect&&(X==null||X(k)),w.setState({userSelectionActive:!1,userSelectionRect:null}),z.current&&(c==null||c(k),w.setState({nodesSelectionActive:_.current.size>0})))},A=n===!0||Array.isArray(n)&&n.includes(0);return i.jsxs("div",{className:se(["react-flow__pane",{draggable:A,dragging:N,selection:e}]),onClick:v?void 0:zt(X,M),onContextMenu:zt($,M),onWheel:zt(P,M),onPointerEnter:v?void 0:d,onPointerMove:v?j:h,onPointerUp:v?S:void 0,onPointerDownCapture:v?f:void 0,onClickCapture:v?B:void 0,onPointerLeave:y,ref:M,style:yt,children:[x,i.jsx(Di,{})]})}function Ft({id:e,store:t,unselect:o=!1,nodeRef:n}){const{addSelectedNodes:r,unselectNodesAndEdges:s,multiSelectionActive:a,nodeLookup:c,onError:l}=t.getState(),u=c.get(e);if(!u){l==null||l("012",de.error012(e));return}t.setState({nodesSelectionActive:!1}),u.selected?(o||u.selected&&a)&&(s({nodes:[u],edges:[]}),requestAnimationFrame(()=>{var p;return(p=n==null?void 0:n.current)==null?void 0:p.blur()})):r([e])}function er({nodeRef:e,disabled:t=!1,noDragClassName:o,handleSelector:n,nodeId:r,isSelectable:s,nodeClickDistance:a}){const c=re(),[l,u]=I.useState(!1),p=I.useRef();return I.useEffect(()=>{p.current=Ca({getStoreItems:()=>c.getState(),onNodeMouseDown:d=>{Ft({id:d,store:c,nodeRef:e})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),I.useEffect(()=>{var d,h;if(t)(d=p.current)==null||d.destroy();else if(e.current)return(h=p.current)==null||h.update({noDragClassName:o,handleSelector:n,domNode:e.current,isSelectable:s,nodeId:r,nodeClickDistance:a}),()=>{var y;(y=p.current)==null||y.destroy()}},[o,n,t,s,e,r]),l}const Hi=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function tr(){const e=re();return I.useCallback(o=>{const{nodeExtent:n,snapToGrid:r,snapGrid:s,nodesDraggable:a,onError:c,updateNodePositions:l,nodeLookup:u,nodeOrigin:p}=e.getState(),d=new Map,h=Hi(a),y=r?s[0]:5,x=r?s[1]:5,w=o.direction.x*y*o.factor,b=o.direction.y*x*o.factor;for(const[,m]of u){if(!h(m))continue;let N={x:m.internals.positionAbsolute.x+w,y:m.internals.positionAbsolute.y+b};r&&(N=Qe(N,s));const{position:g,positionAbsolute:v}=vn({nodeId:m.id,nextPosition:N,nodeLookup:u,nodeExtent:n,nodeOrigin:p,onError:c});m.position=g,m.internals.positionAbsolute=v,d.set(m.id,m)}l(d)},[])}const eo=I.createContext(null),Bi=eo.Provider;eo.Consumer;const or=()=>I.useContext(eo),Oi=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),Fi=(e,t,o)=>n=>{const{connectionClickStartHandle:r,connectionMode:s,connection:a}=n,{fromHandle:c,toHandle:l,isValid:u}=a,p=(l==null?void 0:l.nodeId)===e&&(l==null?void 0:l.id)===t&&(l==null?void 0:l.type)===o;return{connectingFrom:(c==null?void 0:c.nodeId)===e&&(c==null?void 0:c.id)===t&&(c==null?void 0:c.type)===o,connectingTo:p,clickConnecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.id)===t&&(r==null?void 0:r.type)===o,isPossibleEndHandle:s===Pe.Strict?(c==null?void 0:c.type)!==o:e!==(c==null?void 0:c.nodeId)||t!==(c==null?void 0:c.id),connectionInProcess:!!c,clickConnectionInProcess:!!r,valid:p&&u}};function Wi({type:e="source",position:t=q.Top,isValidConnection:o,isConnectable:n=!0,isConnectableStart:r=!0,isConnectableEnd:s=!0,id:a,onConnect:c,children:l,className:u,onMouseDown:p,onTouchStart:d,...h},y){var j,S;const x=a||null,w=e==="target",b=re(),m=or(),{connectOnClick:N,noPanClassName:g,rfId:v}=J(Oi,ne),{connectingFrom:M,connectingTo:E,clickConnecting:_,isPossibleEndHandle:T,connectionInProcess:z,clickConnectionInProcess:X,valid:$}=J(Fi(m,x,e),ne);m||(S=(j=b.getState()).onError)==null||S.call(j,"010",de.error010());const P=A=>{const{defaultEdgeOptions:k,onConnect:C,hasDefaultEdges:V}=b.getState(),W={...k,...A};if(V){const{edges:F,setEdges:G}=b.getState();G(ua(W,F))}C==null||C(W),c==null||c(W)},B=A=>{if(!m)return;const k=_n(A.nativeEvent);if(r&&(k&&A.button===0||!k)){const C=b.getState();Ot.onPointerDown(A.nativeEvent,{handleDomNode:A.currentTarget,autoPanOnConnect:C.autoPanOnConnect,connectionMode:C.connectionMode,connectionRadius:C.connectionRadius,domNode:C.domNode,nodeLookup:C.nodeLookup,lib:C.lib,isTarget:w,handleId:x,nodeId:m,flowId:C.rfId,panBy:C.panBy,cancelConnection:C.cancelConnection,onConnectStart:C.onConnectStart,onConnectEnd:C.onConnectEnd,updateConnection:C.updateConnection,onConnect:P,isValidConnection:o||C.isValidConnection,getTransform:()=>b.getState().transform,getFromHandle:()=>b.getState().connection.fromHandle,autoPanSpeed:C.autoPanSpeed,dragThreshold:C.connectionDragThreshold})}k?p==null||p(A):d==null||d(A)},f=A=>{const{onClickConnectStart:k,onClickConnectEnd:C,connectionClickStartHandle:V,connectionMode:W,isValidConnection:F,lib:G,rfId:R,nodeLookup:L,connection:D}=b.getState();if(!m||!V&&!r)return;if(!V){k==null||k(A.nativeEvent,{nodeId:m,handleId:x,handleType:e}),b.setState({connectionClickStartHandle:{nodeId:m,type:e,id:x}});return}const O=Cn(A.target),H=o||F,{connection:Y,isValid:K}=Ot.isValid(A.nativeEvent,{handle:{nodeId:m,id:x,type:e},connectionMode:W,fromNodeId:V.nodeId,fromHandleId:V.id||null,fromType:V.type,isValidConnection:H,flowId:R,doc:O,lib:G,nodeLookup:L});K&&Y&&P(Y);const U=structuredClone(D);delete U.inProgress,U.toPosition=U.toHandle?U.toHandle.position:null,C==null||C(A,U),b.setState({connectionClickStartHandle:null})};return i.jsx("div",{"data-handleid":x,"data-nodeid":m,"data-handlepos":t,"data-id":`${v}-${m}-${x}-${e}`,className:se(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",g,u,{source:!w,target:w,connectable:n,connectablestart:r,connectableend:s,clickconnecting:_,connectingfrom:M,connectingto:E,valid:$,connectionindicator:n&&(!z||T)&&(z||X?s:r)}]),onMouseDown:B,onTouchStart:B,onClick:N?f:void 0,ref:y,...h,children:l})}const we=I.memo(Qn(Wi));function Xi({data:e,isConnectable:t,sourcePosition:o=q.Bottom}){return i.jsxs(i.Fragment,{children:[e==null?void 0:e.label,i.jsx(we,{type:"source",position:o,isConnectable:t})]})}function Yi({data:e,isConnectable:t,targetPosition:o=q.Top,sourcePosition:n=q.Bottom}){return i.jsxs(i.Fragment,{children:[i.jsx(we,{type:"target",position:o,isConnectable:t}),e==null?void 0:e.label,i.jsx(we,{type:"source",position:n,isConnectable:t})]})}function Gi(){return null}function qi({data:e,isConnectable:t,targetPosition:o=q.Top}){return i.jsxs(i.Fragment,{children:[i.jsx(we,{type:"target",position:o,isConnectable:t}),e==null?void 0:e.label]})}const dt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Xo={input:Xi,default:Yi,output:qi,group:Gi};function Ki(e){var t,o,n,r;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((o=e.style)==null?void 0:o.height)}:{width:e.width??((n=e.style)==null?void 0:n.width),height:e.height??((r=e.style)==null?void 0:r.height)}}const Ui=e=>{const{width:t,height:o,x:n,y:r}=Ze(e.nodeLookup,{filter:s=>!!s.selected});return{width:le(t)?t:null,height:le(o)?o:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${n}px,${r}px)`}};function Zi({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:o}){const n=re(),{width:r,height:s,transformString:a,userSelectionActive:c}=J(Ui,ne),l=tr(),u=I.useRef(null);if(I.useEffect(()=>{var h;o||(h=u.current)==null||h.focus({preventScroll:!0})},[o]),er({nodeRef:u}),c||!r||!s)return null;const p=e?h=>{const y=n.getState().nodes.filter(x=>x.selected);e(h,y)}:void 0,d=h=>{Object.prototype.hasOwnProperty.call(dt,h.key)&&(h.preventDefault(),l({direction:dt[h.key],factor:h.shiftKey?4:1}))};return i.jsx("div",{className:se(["react-flow__nodesselection","react-flow__container",t]),style:{transform:a},children:i.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:p,tabIndex:o?void 0:-1,onKeyDown:o?void 0:d,style:{width:r,height:s}})})}const Yo=typeof window<"u"?window:void 0,Qi=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function nr({children:e,onPaneClick:t,onPaneMouseEnter:o,onPaneMouseMove:n,onPaneMouseLeave:r,onPaneContextMenu:s,onPaneScroll:a,paneClickDistance:c,deleteKeyCode:l,selectionKeyCode:u,selectionOnDrag:p,selectionMode:d,onSelectionStart:h,onSelectionEnd:y,multiSelectionKeyCode:x,panActivationKeyCode:w,zoomActivationKeyCode:b,elementsSelectable:m,zoomOnScroll:N,zoomOnPinch:g,panOnScroll:v,panOnScrollSpeed:M,panOnScrollMode:E,zoomOnDoubleClick:_,panOnDrag:T,defaultViewport:z,translateExtent:X,minZoom:$,maxZoom:P,preventScrolling:B,onSelectionContextMenu:f,noWheelClassName:j,noPanClassName:S,disableKeyboardA11y:A,onViewportChange:k,isControlledViewport:C}){const{nodesSelectionActive:V,userSelectionActive:W}=J(Qi,ne),F=Ke(u,{target:Yo}),G=Ke(w,{target:Yo}),R=G||T,L=G||v,D=p&&R!==!0,O=F||W||D;return $i({deleteKeyCode:l,multiSelectionKeyCode:x}),i.jsx(zi,{onPaneContextMenu:s,elementsSelectable:m,zoomOnScroll:N,zoomOnPinch:g,panOnScroll:L,panOnScrollSpeed:M,panOnScrollMode:E,zoomOnDoubleClick:_,panOnDrag:!F&&R,defaultViewport:z,translateExtent:X,minZoom:$,maxZoom:P,zoomActivationKeyCode:b,preventScrolling:B,noWheelClassName:j,noPanClassName:S,onViewportChange:k,isControlledViewport:C,paneClickDistance:c,selectionOnDrag:D,children:i.jsxs(Vi,{onSelectionStart:h,onSelectionEnd:y,onPaneClick:t,onPaneMouseEnter:o,onPaneMouseMove:n,onPaneMouseLeave:r,onPaneContextMenu:s,onPaneScroll:a,panOnDrag:R,isSelecting:!!O,selectionMode:d,selectionKeyPressed:F,paneClickDistance:c,selectionOnDrag:D,children:[e,V&&i.jsx(Zi,{onSelectionContextMenu:f,noPanClassName:S,disableKeyboardA11y:A})]})})}nr.displayName="FlowRenderer";const Ji=I.memo(nr),ec=e=>t=>e?Yt(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(o=>o.id):Array.from(t.nodeLookup.keys());function tc(e){return J(I.useCallback(ec(e),[e]),ne)}const oc=e=>e.updateNodeInternals;function nc(){const e=J(oc),[t]=I.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(o=>{const n=new Map;o.forEach(r=>{const s=r.target.getAttribute("data-id");n.set(s,{id:s,nodeElement:r.target,force:!0})}),e(n)}));return I.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function rc({node:e,nodeType:t,hasDimensions:o,resizeObserver:n}){const r=re(),s=I.useRef(null),a=I.useRef(null),c=I.useRef(e.sourcePosition),l=I.useRef(e.targetPosition),u=I.useRef(t),p=o&&!!e.internals.handleBounds;return I.useEffect(()=>{s.current&&!e.hidden&&(!p||a.current!==s.current)&&(a.current&&(n==null||n.unobserve(a.current)),n==null||n.observe(s.current),a.current=s.current)},[p,e.hidden]),I.useEffect(()=>()=>{a.current&&(n==null||n.unobserve(a.current),a.current=null)},[]),I.useEffect(()=>{if(s.current){const d=u.current!==t,h=c.current!==e.sourcePosition,y=l.current!==e.targetPosition;(d||h||y)&&(u.current=t,c.current=e.sourcePosition,l.current=e.targetPosition,r.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:s.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),s}function sc({id:e,onClick:t,onMouseEnter:o,onMouseMove:n,onMouseLeave:r,onContextMenu:s,onDoubleClick:a,nodesDraggable:c,elementsSelectable:l,nodesConnectable:u,nodesFocusable:p,resizeObserver:d,noDragClassName:h,noPanClassName:y,disableKeyboardA11y:x,rfId:w,nodeTypes:b,nodeClickDistance:m,onError:N}){const{node:g,internals:v,isParent:M}=J(H=>{const Y=H.nodeLookup.get(e),K=H.parentLookup.has(e);return{node:Y,internals:Y.internals,isParent:K}},ne);let E=g.type||"default",_=(b==null?void 0:b[E])||Xo[E];_===void 0&&(N==null||N("003",de.error003(E)),E="default",_=(b==null?void 0:b.default)||Xo.default);const T=!!(g.draggable||c&&typeof g.draggable>"u"),z=!!(g.selectable||l&&typeof g.selectable>"u"),X=!!(g.connectable||u&&typeof g.connectable>"u"),$=!!(g.focusable||p&&typeof g.focusable>"u"),P=re(),B=En(g),f=rc({node:g,nodeType:E,hasDimensions:B,resizeObserver:d}),j=er({nodeRef:f,disabled:g.hidden||!T,noDragClassName:h,handleSelector:g.dragHandle,nodeId:e,isSelectable:z,nodeClickDistance:m}),S=tr();if(g.hidden)return null;const A=he(g),k=Ki(g),C=z||T||t||o||n||r,V=o?H=>o(H,{...v.userNode}):void 0,W=n?H=>n(H,{...v.userNode}):void 0,F=r?H=>r(H,{...v.userNode}):void 0,G=s?H=>s(H,{...v.userNode}):void 0,R=a?H=>a(H,{...v.userNode}):void 0,L=H=>{const{selectNodesOnDrag:Y,nodeDragThreshold:K}=P.getState();z&&(!Y||!T||K>0)&&Ft({id:e,store:P,nodeRef:f}),t&&t(H,{...v.userNode})},D=H=>{if(!(kn(H.nativeEvent)||x)){if(xn.includes(H.key)&&z){const Y=H.key==="Escape";Ft({id:e,store:P,unselect:Y,nodeRef:f})}else if(T&&g.selected&&Object.prototype.hasOwnProperty.call(dt,H.key)){H.preventDefault();const{ariaLabelConfig:Y}=P.getState();P.setState({ariaLiveMessage:Y["node.a11yDescription.ariaLiveMessage"]({direction:H.key.replace("Arrow","").toLowerCase(),x:~~v.positionAbsolute.x,y:~~v.positionAbsolute.y})}),S({direction:dt[H.key],factor:H.shiftKey?4:1})}}},O=()=>{var te;if(x||!((te=f.current)!=null&&te.matches(":focus-visible")))return;const{transform:H,width:Y,height:K,autoPanOnNodeFocus:U,setCenter:Q}=P.getState();if(!U)return;Yt(new Map([[e,g]]),{x:0,y:0,width:Y,height:K},H,!0).length>0||Q(g.position.x+A.width/2,g.position.y+A.height/2,{zoom:H[2]})};return i.jsx("div",{className:se(["react-flow__node",`react-flow__node-${E}`,{[y]:T},g.className,{selected:g.selected,selectable:z,parent:M,draggable:T,dragging:j}]),ref:f,style:{zIndex:v.z,transform:`translate(${v.positionAbsolute.x}px,${v.positionAbsolute.y}px)`,pointerEvents:C?"all":"none",visibility:B?"visible":"hidden",...g.style,...k},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:V,onMouseMove:W,onMouseLeave:F,onContextMenu:G,onClick:L,onDoubleClick:R,onKeyDown:$?D:void 0,tabIndex:$?0:void 0,onFocus:$?O:void 0,role:g.ariaRole??($?"group":void 0),"aria-roledescription":"node","aria-describedby":x?void 0:`${Yn}-${w}`,"aria-label":g.ariaLabel,...g.domAttributes,children:i.jsx(Bi,{value:e,children:i.jsx(_,{id:e,data:g.data,type:E,positionAbsoluteX:v.positionAbsolute.x,positionAbsoluteY:v.positionAbsolute.y,selected:g.selected??!1,selectable:z,draggable:T,deletable:g.deletable??!0,isConnectable:X,sourcePosition:g.sourcePosition,targetPosition:g.targetPosition,dragging:j,dragHandle:g.dragHandle,zIndex:v.z,parentId:g.parentId,...A})})})}var ac=I.memo(sc);const ic=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function rr(e){const{nodesDraggable:t,nodesConnectable:o,nodesFocusable:n,elementsSelectable:r,onError:s}=J(ic,ne),a=tc(e.onlyRenderVisibleElements),c=nc();return i.jsx("div",{className:"react-flow__nodes",style:yt,children:a.map(l=>i.jsx(ac,{id:l,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:c,nodesDraggable:t,nodesConnectable:o,nodesFocusable:n,elementsSelectable:r,nodeClickDistance:e.nodeClickDistance,onError:s},l))})}rr.displayName="NodeRenderer";const cc=I.memo(rr);function lc(e){return J(I.useCallback(o=>{if(!e)return o.edges.map(r=>r.id);const n=[];if(o.width&&o.height)for(const r of o.edges){const s=o.nodeLookup.get(r.source),a=o.nodeLookup.get(r.target);s&&a&&ia({sourceNode:s,targetNode:a,width:o.width,height:o.height,transform:o.transform})&&n.push(r.id)}return n},[e]),ne)}const uc=({color:e="none",strokeWidth:t=1})=>{const o={strokeWidth:t,...e&&{stroke:e}};return i.jsx("polyline",{className:"arrow",style:o,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},dc=({color:e="none",strokeWidth:t=1})=>{const o={strokeWidth:t,...e&&{stroke:e,fill:e}};return i.jsx("polyline",{className:"arrowclosed",style:o,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Go={[ye.Arrow]:uc,[ye.ArrowClosed]:dc};function fc(e){const t=re();return I.useMemo(()=>{var r,s;return Object.prototype.hasOwnProperty.call(Go,e)?Go[e]:((s=(r=t.getState()).onError)==null||s.call(r,"009",de.error009(e)),null)},[e])}const hc=({id:e,type:t,color:o,width:n=12.5,height:r=12.5,markerUnits:s="strokeWidth",strokeWidth:a,orient:c="auto-start-reverse"})=>{const l=fc(t);return l?i.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${n}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:c,refX:"0",refY:"0",children:i.jsx(l,{color:o,strokeWidth:a})}):null},sr=({defaultColor:e,rfId:t})=>{const o=J(s=>s.edges),n=J(s=>s.defaultEdgeOptions),r=I.useMemo(()=>xa(o,{id:t,defaultColor:e,defaultMarkerStart:n==null?void 0:n.markerStart,defaultMarkerEnd:n==null?void 0:n.markerEnd}),[o,n,t,e]);return r.length?i.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:i.jsx("defs",{children:r.map(s=>i.jsx(hc,{id:s.id,type:s.type,color:s.color,width:s.width,height:s.height,markerUnits:s.markerUnits,strokeWidth:s.strokeWidth,orient:s.orient},s.id))})}):null};sr.displayName="MarkerDefinitions";var gc=I.memo(sr);function ar({x:e,y:t,label:o,labelStyle:n,labelShowBg:r=!0,labelBgStyle:s,labelBgPadding:a=[2,4],labelBgBorderRadius:c=2,children:l,className:u,...p}){const[d,h]=I.useState({x:1,y:0,width:0,height:0}),y=se(["react-flow__edge-textwrapper",u]),x=I.useRef(null);return I.useEffect(()=>{if(x.current){const w=x.current.getBBox();h({x:w.x,y:w.y,width:w.width,height:w.height})}},[o]),o?i.jsxs("g",{transform:`translate(${e-d.width/2} ${t-d.height/2})`,className:y,visibility:d.width?"visible":"hidden",...p,children:[r&&i.jsx("rect",{width:d.width+2*a[0],x:-a[0],y:-a[1],height:d.height+2*a[1],className:"react-flow__edge-textbg",style:s,rx:c,ry:c}),i.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:x,style:n,children:o}),l]}):null}ar.displayName="EdgeText";const xc=I.memo(ar);function bt({path:e,labelX:t,labelY:o,label:n,labelStyle:r,labelShowBg:s,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,interactionWidth:u=20,...p}){return i.jsxs(i.Fragment,{children:[i.jsx("path",{...p,d:e,fill:"none",className:se(["react-flow__edge-path",p.className])}),u?i.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}):null,n&&le(t)&&le(o)?i.jsx(xc,{x:t,y:o,label:n,labelStyle:r,labelShowBg:s,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l}):null]})}function qo({pos:e,x1:t,y1:o,x2:n,y2:r}){return e===q.Left||e===q.Right?[.5*(t+n),o]:[t,.5*(o+r)]}function ir({sourceX:e,sourceY:t,sourcePosition:o=q.Bottom,targetX:n,targetY:r,targetPosition:s=q.Top}){const[a,c]=qo({pos:o,x1:e,y1:t,x2:n,y2:r}),[l,u]=qo({pos:s,x1:n,y1:r,x2:e,y2:t}),[p,d,h,y]=Mn({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:a,sourceControlY:c,targetControlX:l,targetControlY:u});return[`M${e},${t} C${a},${c} ${l},${u} ${n},${r}`,p,d,h,y]}function cr(e){return I.memo(({id:t,sourceX:o,sourceY:n,targetX:r,targetY:s,sourcePosition:a,targetPosition:c,label:l,labelStyle:u,labelShowBg:p,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:y,style:x,markerEnd:w,markerStart:b,interactionWidth:m})=>{const[N,g,v]=ir({sourceX:o,sourceY:n,sourcePosition:a,targetX:r,targetY:s,targetPosition:c}),M=e.isInternal?void 0:t;return i.jsx(bt,{id:M,path:N,labelX:g,labelY:v,label:l,labelStyle:u,labelShowBg:p,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:y,style:x,markerEnd:w,markerStart:b,interactionWidth:m})})}const pc=cr({isInternal:!1}),lr=cr({isInternal:!0});pc.displayName="SimpleBezierEdge";lr.displayName="SimpleBezierEdgeInternal";function ur(e){return I.memo(({id:t,sourceX:o,sourceY:n,targetX:r,targetY:s,label:a,labelStyle:c,labelShowBg:l,labelBgStyle:u,labelBgPadding:p,labelBgBorderRadius:d,style:h,sourcePosition:y=q.Bottom,targetPosition:x=q.Top,markerEnd:w,markerStart:b,pathOptions:m,interactionWidth:N})=>{const[g,v,M]=Vt({sourceX:o,sourceY:n,sourcePosition:y,targetX:r,targetY:s,targetPosition:x,borderRadius:m==null?void 0:m.borderRadius,offset:m==null?void 0:m.offset,stepPosition:m==null?void 0:m.stepPosition}),E=e.isInternal?void 0:t;return i.jsx(bt,{id:E,path:g,labelX:v,labelY:M,label:a,labelStyle:c,labelShowBg:l,labelBgStyle:u,labelBgPadding:p,labelBgBorderRadius:d,style:h,markerEnd:w,markerStart:b,interactionWidth:N})})}const dr=ur({isInternal:!1}),fr=ur({isInternal:!0});dr.displayName="SmoothStepEdge";fr.displayName="SmoothStepEdgeInternal";function hr(e){return I.memo(({id:t,...o})=>{var r;const n=e.isInternal?void 0:t;return i.jsx(dr,{...o,id:n,pathOptions:I.useMemo(()=>{var s;return{borderRadius:0,offset:(s=o.pathOptions)==null?void 0:s.offset}},[(r=o.pathOptions)==null?void 0:r.offset])})})}const mc=hr({isInternal:!1}),gr=hr({isInternal:!0});mc.displayName="StepEdge";gr.displayName="StepEdgeInternal";function xr(e){return I.memo(({id:t,sourceX:o,sourceY:n,targetX:r,targetY:s,label:a,labelStyle:c,labelShowBg:l,labelBgStyle:u,labelBgPadding:p,labelBgBorderRadius:d,style:h,markerEnd:y,markerStart:x,interactionWidth:w})=>{const[b,m,N]=$n({sourceX:o,sourceY:n,targetX:r,targetY:s}),g=e.isInternal?void 0:t;return i.jsx(bt,{id:g,path:b,labelX:m,labelY:N,label:a,labelStyle:c,labelShowBg:l,labelBgStyle:u,labelBgPadding:p,labelBgBorderRadius:d,style:h,markerEnd:y,markerStart:x,interactionWidth:w})})}const yc=xr({isInternal:!1}),pr=xr({isInternal:!0});yc.displayName="StraightEdge";pr.displayName="StraightEdgeInternal";function mr(e){return I.memo(({id:t,sourceX:o,sourceY:n,targetX:r,targetY:s,sourcePosition:a=q.Bottom,targetPosition:c=q.Top,label:l,labelStyle:u,labelShowBg:p,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:y,style:x,markerEnd:w,markerStart:b,pathOptions:m,interactionWidth:N})=>{const[g,v,M]=In({sourceX:o,sourceY:n,sourcePosition:a,targetX:r,targetY:s,targetPosition:c,curvature:m==null?void 0:m.curvature}),E=e.isInternal?void 0:t;return i.jsx(bt,{id:E,path:g,labelX:v,labelY:M,label:l,labelStyle:u,labelShowBg:p,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:y,style:x,markerEnd:w,markerStart:b,interactionWidth:N})})}const bc=mr({isInternal:!1}),yr=mr({isInternal:!0});bc.displayName="BezierEdge";yr.displayName="BezierEdgeInternal";const Ko={default:yr,straight:pr,step:gr,smoothstep:fr,simplebezier:lr},Uo={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},vc=(e,t,o)=>o===q.Left?e-t:o===q.Right?e+t:e,wc=(e,t,o)=>o===q.Top?e-t:o===q.Bottom?e+t:e,Zo="react-flow__edgeupdater";function Qo({position:e,centerX:t,centerY:o,radius:n=10,onMouseDown:r,onMouseEnter:s,onMouseOut:a,type:c}){return i.jsx("circle",{onMouseDown:r,onMouseEnter:s,onMouseOut:a,className:se([Zo,`${Zo}-${c}`]),cx:vc(t,n,e),cy:wc(o,n,e),r:n,stroke:"transparent",fill:"transparent"})}function Nc({isReconnectable:e,reconnectRadius:t,edge:o,sourceX:n,sourceY:r,targetX:s,targetY:a,sourcePosition:c,targetPosition:l,onReconnect:u,onReconnectStart:p,onReconnectEnd:d,setReconnecting:h,setUpdateHover:y}){const x=re(),w=(v,M)=>{if(v.button!==0)return;const{autoPanOnConnect:E,domNode:_,isValidConnection:T,connectionMode:z,connectionRadius:X,lib:$,onConnectStart:P,onConnectEnd:B,cancelConnection:f,nodeLookup:j,rfId:S,panBy:A,updateConnection:k}=x.getState(),C=M.type==="target",V=(G,R)=>{h(!1),d==null||d(G,o,M.type,R)},W=G=>u==null?void 0:u(o,G),F=(G,R)=>{h(!0),p==null||p(v,o,M.type),P==null||P(G,R)};Ot.onPointerDown(v.nativeEvent,{autoPanOnConnect:E,connectionMode:z,connectionRadius:X,domNode:_,handleId:M.id,nodeId:M.nodeId,nodeLookup:j,isTarget:C,edgeUpdaterType:M.type,lib:$,flowId:S,cancelConnection:f,panBy:A,isValidConnection:T,onConnect:W,onConnectStart:F,onConnectEnd:B,onReconnectEnd:V,updateConnection:k,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,dragThreshold:x.getState().connectionDragThreshold,handleDomNode:v.currentTarget})},b=v=>w(v,{nodeId:o.target,id:o.targetHandle??null,type:"target"}),m=v=>w(v,{nodeId:o.source,id:o.sourceHandle??null,type:"source"}),N=()=>y(!0),g=()=>y(!1);return i.jsxs(i.Fragment,{children:[(e===!0||e==="source")&&i.jsx(Qo,{position:c,centerX:n,centerY:r,radius:t,onMouseDown:b,onMouseEnter:N,onMouseOut:g,type:"source"}),(e===!0||e==="target")&&i.jsx(Qo,{position:l,centerX:s,centerY:a,radius:t,onMouseDown:m,onMouseEnter:N,onMouseOut:g,type:"target"})]})}function jc({id:e,edgesFocusable:t,edgesReconnectable:o,elementsSelectable:n,onClick:r,onDoubleClick:s,onContextMenu:a,onMouseEnter:c,onMouseMove:l,onMouseLeave:u,reconnectRadius:p,onReconnect:d,onReconnectStart:h,onReconnectEnd:y,rfId:x,edgeTypes:w,noPanClassName:b,onError:m,disableKeyboardA11y:N}){let g=J(Q=>Q.edgeLookup.get(e));const v=J(Q=>Q.defaultEdgeOptions);g=v?{...v,...g}:g;let M=g.type||"default",E=(w==null?void 0:w[M])||Ko[M];E===void 0&&(m==null||m("011",de.error011(M)),M="default",E=(w==null?void 0:w.default)||Ko.default);const _=!!(g.focusable||t&&typeof g.focusable>"u"),T=typeof d<"u"&&(g.reconnectable||o&&typeof g.reconnectable>"u"),z=!!(g.selectable||n&&typeof g.selectable>"u"),X=I.useRef(null),[$,P]=I.useState(!1),[B,f]=I.useState(!1),j=re(),{zIndex:S,sourceX:A,sourceY:k,targetX:C,targetY:V,sourcePosition:W,targetPosition:F}=J(I.useCallback(Q=>{const Z=Q.nodeLookup.get(g.source),te=Q.nodeLookup.get(g.target);if(!Z||!te)return{zIndex:g.zIndex,...Uo};const oe=ga({id:e,sourceNode:Z,targetNode:te,sourceHandle:g.sourceHandle||null,targetHandle:g.targetHandle||null,connectionMode:Q.connectionMode,onError:m});return{zIndex:aa({selected:g.selected,zIndex:g.zIndex,sourceNode:Z,targetNode:te,elevateOnSelect:Q.elevateEdgesOnSelect,zIndexMode:Q.zIndexMode}),...oe||Uo}},[g.source,g.target,g.sourceHandle,g.targetHandle,g.selected,g.zIndex]),ne),G=I.useMemo(()=>g.markerStart?`url('#${Ht(g.markerStart,x)}')`:void 0,[g.markerStart,x]),R=I.useMemo(()=>g.markerEnd?`url('#${Ht(g.markerEnd,x)}')`:void 0,[g.markerEnd,x]);if(g.hidden||A===null||k===null||C===null||V===null)return null;const L=Q=>{var ee;const{addSelectedEdges:Z,unselectNodesAndEdges:te,multiSelectionActive:oe}=j.getState();z&&(j.setState({nodesSelectionActive:!1}),g.selected&&oe?(te({nodes:[],edges:[g]}),(ee=X.current)==null||ee.blur()):Z([e])),r&&r(Q,g)},D=s?Q=>{s(Q,{...g})}:void 0,O=a?Q=>{a(Q,{...g})}:void 0,H=c?Q=>{c(Q,{...g})}:void 0,Y=l?Q=>{l(Q,{...g})}:void 0,K=u?Q=>{u(Q,{...g})}:void 0,U=Q=>{var Z;if(!N&&xn.includes(Q.key)&&z){const{unselectNodesAndEdges:te,addSelectedEdges:oe}=j.getState();Q.key==="Escape"?((Z=X.current)==null||Z.blur(),te({edges:[g]})):oe([e])}};return i.jsx("svg",{style:{zIndex:S},children:i.jsxs("g",{className:se(["react-flow__edge",`react-flow__edge-${M}`,g.className,b,{selected:g.selected,animated:g.animated,inactive:!z&&!r,updating:$,selectable:z}]),onClick:L,onDoubleClick:D,onContextMenu:O,onMouseEnter:H,onMouseMove:Y,onMouseLeave:K,onKeyDown:_?U:void 0,tabIndex:_?0:void 0,role:g.ariaRole??(_?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":g.ariaLabel===null?void 0:g.ariaLabel||`Edge from ${g.source} to ${g.target}`,"aria-describedby":_?`${Gn}-${x}`:void 0,ref:X,...g.domAttributes,children:[!B&&i.jsx(E,{id:e,source:g.source,target:g.target,type:g.type,selected:g.selected,animated:g.animated,selectable:z,deletable:g.deletable??!0,label:g.label,labelStyle:g.labelStyle,labelShowBg:g.labelShowBg,labelBgStyle:g.labelBgStyle,labelBgPadding:g.labelBgPadding,labelBgBorderRadius:g.labelBgBorderRadius,sourceX:A,sourceY:k,targetX:C,targetY:V,sourcePosition:W,targetPosition:F,data:g.data,style:g.style,sourceHandleId:g.sourceHandle,targetHandleId:g.targetHandle,markerStart:G,markerEnd:R,pathOptions:"pathOptions"in g?g.pathOptions:void 0,interactionWidth:g.interactionWidth}),T&&i.jsx(Nc,{edge:g,isReconnectable:T,reconnectRadius:p,onReconnect:d,onReconnectStart:h,onReconnectEnd:y,sourceX:A,sourceY:k,targetX:C,targetY:V,sourcePosition:W,targetPosition:F,setUpdateHover:P,setReconnecting:f})]})})}var Ec=I.memo(jc);const Sc=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function br({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:o,edgeTypes:n,noPanClassName:r,onReconnect:s,onEdgeContextMenu:a,onEdgeMouseEnter:c,onEdgeMouseMove:l,onEdgeMouseLeave:u,onEdgeClick:p,reconnectRadius:d,onEdgeDoubleClick:h,onReconnectStart:y,onReconnectEnd:x,disableKeyboardA11y:w}){const{edgesFocusable:b,edgesReconnectable:m,elementsSelectable:N,onError:g}=J(Sc,ne),v=lc(t);return i.jsxs("div",{className:"react-flow__edges",children:[i.jsx(gc,{defaultColor:e,rfId:o}),v.map(M=>i.jsx(Ec,{id:M,edgesFocusable:b,edgesReconnectable:m,elementsSelectable:N,noPanClassName:r,onReconnect:s,onContextMenu:a,onMouseEnter:c,onMouseMove:l,onMouseLeave:u,onClick:p,reconnectRadius:d,onDoubleClick:h,onReconnectStart:y,onReconnectEnd:x,rfId:o,onError:g,edgeTypes:n,disableKeyboardA11y:w},M))]})}br.displayName="EdgeRenderer";const Cc=I.memo(br),kc=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function _c({children:e}){const t=J(kc);return i.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Mc(e){const t=mt(),o=I.useRef(!1);I.useEffect(()=>{!o.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),o.current=!0)},[e,t.viewportInitialized])}const Ic=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function Ac(e){const t=J(Ic),o=re();return I.useEffect(()=>{e&&(t==null||t(e),o.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function $c(e){return e.connection.inProgress?{...e.connection,to:Je(e.connection.to,e.transform)}:{...e.connection}}function Pc(e){return $c}function Tc(e){const t=Pc();return J(t,ne)}const zc=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Lc({containerStyle:e,style:t,type:o,component:n}){const{nodesConnectable:r,width:s,height:a,isValid:c,inProgress:l}=J(zc,ne);return!(s&&r&&l)?null:i.jsx("svg",{style:e,width:s,height:a,className:"react-flow__connectionline react-flow__container",children:i.jsx("g",{className:se(["react-flow__connection",yn(c)]),children:i.jsx(vr,{style:t,type:o,CustomComponent:n,isValid:c})})})}const vr=({style:e,type:t=me.Bezier,CustomComponent:o,isValid:n})=>{const{inProgress:r,from:s,fromNode:a,fromHandle:c,fromPosition:l,to:u,toNode:p,toHandle:d,toPosition:h,pointer:y}=Tc();if(!r)return;if(o)return i.jsx(o,{connectionLineType:t,connectionLineStyle:e,fromNode:a,fromHandle:c,fromX:s.x,fromY:s.y,toX:u.x,toY:u.y,fromPosition:l,toPosition:h,connectionStatus:yn(n),toNode:p,toHandle:d,pointer:y});let x="";const w={sourceX:s.x,sourceY:s.y,sourcePosition:l,targetX:u.x,targetY:u.y,targetPosition:h};switch(t){case me.Bezier:[x]=In(w);break;case me.SimpleBezier:[x]=ir(w);break;case me.Step:[x]=Vt({...w,borderRadius:0});break;case me.SmoothStep:[x]=Vt(w);break;default:[x]=$n(w)}return i.jsx("path",{d:x,fill:"none",className:"react-flow__connection-path",style:e})};vr.displayName="ConnectionLine";const Dc={};function Jo(e=Dc){I.useRef(e),re(),I.useEffect(()=>{},[e])}function Rc(){re(),I.useRef(!1),I.useEffect(()=>{},[])}function wr({nodeTypes:e,edgeTypes:t,onInit:o,onNodeClick:n,onEdgeClick:r,onNodeDoubleClick:s,onEdgeDoubleClick:a,onNodeMouseEnter:c,onNodeMouseMove:l,onNodeMouseLeave:u,onNodeContextMenu:p,onSelectionContextMenu:d,onSelectionStart:h,onSelectionEnd:y,connectionLineType:x,connectionLineStyle:w,connectionLineComponent:b,connectionLineContainerStyle:m,selectionKeyCode:N,selectionOnDrag:g,selectionMode:v,multiSelectionKeyCode:M,panActivationKeyCode:E,zoomActivationKeyCode:_,deleteKeyCode:T,onlyRenderVisibleElements:z,elementsSelectable:X,defaultViewport:$,translateExtent:P,minZoom:B,maxZoom:f,preventScrolling:j,defaultMarkerColor:S,zoomOnScroll:A,zoomOnPinch:k,panOnScroll:C,panOnScrollSpeed:V,panOnScrollMode:W,zoomOnDoubleClick:F,panOnDrag:G,onPaneClick:R,onPaneMouseEnter:L,onPaneMouseMove:D,onPaneMouseLeave:O,onPaneScroll:H,onPaneContextMenu:Y,paneClickDistance:K,nodeClickDistance:U,onEdgeContextMenu:Q,onEdgeMouseEnter:Z,onEdgeMouseMove:te,onEdgeMouseLeave:oe,reconnectRadius:ee,onReconnect:ae,onReconnectStart:ge,onReconnectEnd:fe,noDragClassName:je,noWheelClassName:Re,noPanClassName:Ve,disableKeyboardA11y:He,nodeExtent:vt,rfId:et,viewport:_e,onViewportChange:Be}){return Jo(e),Jo(t),Rc(),Mc(o),Ac(_e),i.jsx(Ji,{onPaneClick:R,onPaneMouseEnter:L,onPaneMouseMove:D,onPaneMouseLeave:O,onPaneContextMenu:Y,onPaneScroll:H,paneClickDistance:K,deleteKeyCode:T,selectionKeyCode:N,selectionOnDrag:g,selectionMode:v,onSelectionStart:h,onSelectionEnd:y,multiSelectionKeyCode:M,panActivationKeyCode:E,zoomActivationKeyCode:_,elementsSelectable:X,zoomOnScroll:A,zoomOnPinch:k,zoomOnDoubleClick:F,panOnScroll:C,panOnScrollSpeed:V,panOnScrollMode:W,panOnDrag:G,defaultViewport:$,translateExtent:P,minZoom:B,maxZoom:f,onSelectionContextMenu:d,preventScrolling:j,noDragClassName:je,noWheelClassName:Re,noPanClassName:Ve,disableKeyboardA11y:He,onViewportChange:Be,isControlledViewport:!!_e,children:i.jsxs(_c,{children:[i.jsx(Cc,{edgeTypes:t,onEdgeClick:r,onEdgeDoubleClick:a,onReconnect:ae,onReconnectStart:ge,onReconnectEnd:fe,onlyRenderVisibleElements:z,onEdgeContextMenu:Q,onEdgeMouseEnter:Z,onEdgeMouseMove:te,onEdgeMouseLeave:oe,reconnectRadius:ee,defaultMarkerColor:S,noPanClassName:Ve,disableKeyboardA11y:He,rfId:et}),i.jsx(Lc,{style:w,type:x,component:b,containerStyle:m}),i.jsx("div",{className:"react-flow__edgelabel-renderer"}),i.jsx(cc,{nodeTypes:e,onNodeClick:n,onNodeDoubleClick:s,onNodeMouseEnter:c,onNodeMouseMove:l,onNodeMouseLeave:u,onNodeContextMenu:p,nodeClickDistance:U,onlyRenderVisibleElements:z,noPanClassName:Ve,noDragClassName:je,disableKeyboardA11y:He,nodeExtent:vt,rfId:et}),i.jsx("div",{className:"react-flow__viewport-portal"})]})})}wr.displayName="GraphView";const Vc=I.memo(wr),en=({nodes:e,edges:t,defaultNodes:o,defaultEdges:n,width:r,height:s,fitView:a,fitViewOptions:c,minZoom:l=.5,maxZoom:u=2,nodeOrigin:p,nodeExtent:d,zIndexMode:h="basic"}={})=>{const y=new Map,x=new Map,w=new Map,b=new Map,m=n??t??[],N=o??e??[],g=p??[0,0],v=d??Xe;zn(w,b,m);const M=Bt(N,y,x,{nodeOrigin:g,nodeExtent:v,zIndexMode:h});let E=[0,0,1];if(a&&r&&s){const _=Ze(y,{filter:$=>!!(($.width||$.initialWidth)&&($.height||$.initialHeight))}),{x:T,y:z,zoom:X}=Gt(_,r,s,l,u,(c==null?void 0:c.padding)??.1);E=[T,z,X]}return{rfId:"1",width:r??0,height:s??0,transform:E,nodes:N,nodesInitialized:M,nodeLookup:y,parentLookup:x,edges:m,edgeLookup:b,connectionLookup:w,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:o!==void 0,hasDefaultEdges:n!==void 0,panZoom:null,minZoom:l,maxZoom:u,translateExtent:Xe,nodeExtent:v,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Pe.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:g,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:a??!1,fitViewOptions:c,fitViewResolver:null,connection:{...mn},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:ea,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:pn,zIndexMode:h,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},Hc=({nodes:e,edges:t,defaultNodes:o,defaultEdges:n,width:r,height:s,fitView:a,fitViewOptions:c,minZoom:l,maxZoom:u,nodeOrigin:p,nodeExtent:d,zIndexMode:h})=>ri((y,x)=>{async function w(){const{nodeLookup:b,panZoom:m,fitViewOptions:N,fitViewResolver:g,width:v,height:M,minZoom:E,maxZoom:_}=x();m&&(await Qs({nodes:b,width:v,height:M,panZoom:m,minZoom:E,maxZoom:_},N),g==null||g.resolve(!0),y({fitViewResolver:null}))}return{...en({nodes:e,edges:t,width:r,height:s,fitView:a,fitViewOptions:c,minZoom:l,maxZoom:u,nodeOrigin:p,nodeExtent:d,defaultNodes:o,defaultEdges:n,zIndexMode:h}),setNodes:b=>{const{nodeLookup:m,parentLookup:N,nodeOrigin:g,elevateNodesOnSelect:v,fitViewQueued:M,zIndexMode:E}=x(),_=Bt(b,m,N,{nodeOrigin:g,nodeExtent:d,elevateNodesOnSelect:v,checkEquality:!0,zIndexMode:E});M&&_?(w(),y({nodes:b,nodesInitialized:_,fitViewQueued:!1,fitViewOptions:void 0})):y({nodes:b,nodesInitialized:_})},setEdges:b=>{const{connectionLookup:m,edgeLookup:N}=x();zn(m,N,b),y({edges:b})},setDefaultNodesAndEdges:(b,m)=>{if(b){const{setNodes:N}=x();N(b),y({hasDefaultNodes:!0})}if(m){const{setEdges:N}=x();N(m),y({hasDefaultEdges:!0})}},updateNodeInternals:b=>{const{triggerNodeChanges:m,nodeLookup:N,parentLookup:g,domNode:v,nodeOrigin:M,nodeExtent:E,debug:_,fitViewQueued:T,zIndexMode:z}=x(),{changes:X,updatedInternals:$}=Na(b,N,g,v,M,E,z);$&&(ya(N,g,{nodeOrigin:M,nodeExtent:E,zIndexMode:z}),T?(w(),y({fitViewQueued:!1,fitViewOptions:void 0})):y({}),(X==null?void 0:X.length)>0&&(_&&console.log("React Flow: trigger node changes",X),m==null||m(X)))},updateNodePositions:(b,m=!1)=>{const N=[];let g=[];const{nodeLookup:v,triggerNodeChanges:M,connection:E,updateConnection:_,onNodesChangeMiddlewareMap:T}=x();for(const[z,X]of b){const $=v.get(z),P=!!($!=null&&$.expandParent&&($!=null&&$.parentId)&&(X!=null&&X.position)),B={id:z,type:"position",position:P?{x:Math.max(0,X.position.x),y:Math.max(0,X.position.y)}:X.position,dragging:m};if($&&E.inProgress&&E.fromNode.id===$.id){const f=ke($,E.fromHandle,q.Left,!0);_({...E,from:f})}P&&$.parentId&&N.push({id:z,parentId:$.parentId,rect:{...X.internals.positionAbsolute,width:X.measured.width??0,height:X.measured.height??0}}),g.push(B)}if(N.length>0){const{parentLookup:z,nodeOrigin:X}=x(),$=Jt(N,v,z,X);g.push(...$)}for(const z of T.values())g=z(g);M(g)},triggerNodeChanges:b=>{const{onNodesChange:m,setNodes:N,nodes:g,hasDefaultNodes:v,debug:M}=x();if(b!=null&&b.length){if(v){const E=Un(b,g);N(E)}M&&console.log("React Flow: trigger node changes",b),m==null||m(b)}},triggerEdgeChanges:b=>{const{onEdgesChange:m,setEdges:N,edges:g,hasDefaultEdges:v,debug:M}=x();if(b!=null&&b.length){if(v){const E=Zn(b,g);N(E)}M&&console.log("React Flow: trigger edge changes",b),m==null||m(b)}},addSelectedNodes:b=>{const{multiSelectionActive:m,edgeLookup:N,nodeLookup:g,triggerNodeChanges:v,triggerEdgeChanges:M}=x();if(m){const E=b.map(_=>Ee(_,!0));v(E);return}v(Ae(g,new Set([...b]),!0)),M(Ae(N))},addSelectedEdges:b=>{const{multiSelectionActive:m,edgeLookup:N,nodeLookup:g,triggerNodeChanges:v,triggerEdgeChanges:M}=x();if(m){const E=b.map(_=>Ee(_,!0));M(E);return}M(Ae(N,new Set([...b]))),v(Ae(g,new Set,!0))},unselectNodesAndEdges:({nodes:b,edges:m}={})=>{const{edges:N,nodes:g,nodeLookup:v,triggerNodeChanges:M,triggerEdgeChanges:E}=x(),_=b||g,T=m||N,z=_.map($=>{const P=v.get($.id);return P&&(P.selected=!1),Ee($.id,!1)}),X=T.map($=>Ee($.id,!1));M(z),E(X)},setMinZoom:b=>{const{panZoom:m,maxZoom:N}=x();m==null||m.setScaleExtent([b,N]),y({minZoom:b})},setMaxZoom:b=>{const{panZoom:m,minZoom:N}=x();m==null||m.setScaleExtent([N,b]),y({maxZoom:b})},setTranslateExtent:b=>{var m;(m=x().panZoom)==null||m.setTranslateExtent(b),y({translateExtent:b})},resetSelectedElements:()=>{const{edges:b,nodes:m,triggerNodeChanges:N,triggerEdgeChanges:g,elementsSelectable:v}=x();if(!v)return;const M=m.reduce((_,T)=>T.selected?[..._,Ee(T.id,!1)]:_,[]),E=b.reduce((_,T)=>T.selected?[..._,Ee(T.id,!1)]:_,[]);N(M),g(E)},setNodeExtent:b=>{const{nodes:m,nodeLookup:N,parentLookup:g,nodeOrigin:v,elevateNodesOnSelect:M,nodeExtent:E,zIndexMode:_}=x();b[0][0]===E[0][0]&&b[0][1]===E[0][1]&&b[1][0]===E[1][0]&&b[1][1]===E[1][1]||(Bt(m,N,g,{nodeOrigin:v,nodeExtent:b,elevateNodesOnSelect:M,checkEquality:!1,zIndexMode:_}),y({nodeExtent:b}))},panBy:b=>{const{transform:m,width:N,height:g,panZoom:v,translateExtent:M}=x();return ja({delta:b,panZoom:v,transform:m,translateExtent:M,width:N,height:g})},setCenter:async(b,m,N)=>{const{width:g,height:v,maxZoom:M,panZoom:E}=x();if(!E)return Promise.resolve(!1);const _=typeof(N==null?void 0:N.zoom)<"u"?N.zoom:M;return await E.setViewport({x:g/2-b*_,y:v/2-m*_,zoom:_},{duration:N==null?void 0:N.duration,ease:N==null?void 0:N.ease,interpolate:N==null?void 0:N.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{y({connection:{...mn}})},updateConnection:b=>{y({connection:b})},reset:()=>y({...en()})}},Object.is);function Nr({initialNodes:e,initialEdges:t,defaultNodes:o,defaultEdges:n,initialWidth:r,initialHeight:s,initialMinZoom:a,initialMaxZoom:c,initialFitViewOptions:l,fitView:u,nodeOrigin:p,nodeExtent:d,zIndexMode:h,children:y}){const[x]=I.useState(()=>Hc({nodes:e,edges:t,defaultNodes:o,defaultEdges:n,width:r,height:s,fitView:u,minZoom:a,maxZoom:c,fitViewOptions:l,nodeOrigin:p,nodeExtent:d,zIndexMode:h}));return i.jsx(si,{value:x,children:i.jsx(_i,{children:y})})}function Bc({children:e,nodes:t,edges:o,defaultNodes:n,defaultEdges:r,width:s,height:a,fitView:c,fitViewOptions:l,minZoom:u,maxZoom:p,nodeOrigin:d,nodeExtent:h,zIndexMode:y}){return I.useContext(xt)?i.jsx(i.Fragment,{children:e}):i.jsx(Nr,{initialNodes:t,initialEdges:o,defaultNodes:n,defaultEdges:r,initialWidth:s,initialHeight:a,fitView:c,initialFitViewOptions:l,initialMinZoom:u,initialMaxZoom:p,nodeOrigin:d,nodeExtent:h,zIndexMode:y,children:e})}const Oc={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Fc({nodes:e,edges:t,defaultNodes:o,defaultEdges:n,className:r,nodeTypes:s,edgeTypes:a,onNodeClick:c,onEdgeClick:l,onInit:u,onMove:p,onMoveStart:d,onMoveEnd:h,onConnect:y,onConnectStart:x,onConnectEnd:w,onClickConnectStart:b,onClickConnectEnd:m,onNodeMouseEnter:N,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:M,onNodeDoubleClick:E,onNodeDragStart:_,onNodeDrag:T,onNodeDragStop:z,onNodesDelete:X,onEdgesDelete:$,onDelete:P,onSelectionChange:B,onSelectionDragStart:f,onSelectionDrag:j,onSelectionDragStop:S,onSelectionContextMenu:A,onSelectionStart:k,onSelectionEnd:C,onBeforeDelete:V,connectionMode:W,connectionLineType:F=me.Bezier,connectionLineStyle:G,connectionLineComponent:R,connectionLineContainerStyle:L,deleteKeyCode:D="Backspace",selectionKeyCode:O="Shift",selectionOnDrag:H=!1,selectionMode:Y=Ye.Full,panActivationKeyCode:K="Space",multiSelectionKeyCode:U=qe()?"Meta":"Control",zoomActivationKeyCode:Q=qe()?"Meta":"Control",snapToGrid:Z,snapGrid:te,onlyRenderVisibleElements:oe=!1,selectNodesOnDrag:ee,nodesDraggable:ae,autoPanOnNodeFocus:ge,nodesConnectable:fe,nodesFocusable:je,nodeOrigin:Re=qn,edgesFocusable:Ve,edgesReconnectable:He,elementsSelectable:vt=!0,defaultViewport:et=yi,minZoom:_e=.5,maxZoom:Be=2,translateExtent:to=Xe,preventScrolling:Cr=!0,nodeExtent:wt,defaultMarkerColor:kr="#b1b1b7",zoomOnScroll:_r=!0,zoomOnPinch:Mr=!0,panOnScroll:Ir=!1,panOnScrollSpeed:Ar=.5,panOnScrollMode:$r=Se.Free,zoomOnDoubleClick:Pr=!0,panOnDrag:Tr=!0,onPaneClick:zr,onPaneMouseEnter:Lr,onPaneMouseMove:Dr,onPaneMouseLeave:Rr,onPaneScroll:Vr,onPaneContextMenu:Hr,paneClickDistance:Br=1,nodeClickDistance:Or=0,children:Fr,onReconnect:Wr,onReconnectStart:Xr,onReconnectEnd:Yr,onEdgeContextMenu:Gr,onEdgeDoubleClick:qr,onEdgeMouseEnter:Kr,onEdgeMouseMove:Ur,onEdgeMouseLeave:Zr,reconnectRadius:Qr=10,onNodesChange:Jr,onEdgesChange:es,noDragClassName:ts="nodrag",noWheelClassName:os="nowheel",noPanClassName:oo="nopan",fitView:no,fitViewOptions:ro,connectOnClick:ns,attributionPosition:rs,proOptions:ss,defaultEdgeOptions:as,elevateNodesOnSelect:is=!0,elevateEdgesOnSelect:cs=!1,disableKeyboardA11y:so=!1,autoPanOnConnect:ls,autoPanOnNodeDrag:us,autoPanSpeed:ds,connectionRadius:fs,isValidConnection:hs,onError:gs,style:xs,id:ao,nodeDragThreshold:ps,connectionDragThreshold:ms,viewport:ys,onViewportChange:bs,width:vs,height:ws,colorMode:Ns="light",debug:js,onScroll:tt,ariaLabelConfig:Es,zIndexMode:io="basic",...Ss},Cs){const Nt=ao||"1",ks=Ni(Ns),_s=I.useCallback(co=>{co.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),tt==null||tt(co)},[tt]);return i.jsx("div",{"data-testid":"rf__wrapper",...Ss,onScroll:_s,style:{...xs,...Oc},ref:Cs,className:se(["react-flow",r,ks]),id:ao,role:"application",children:i.jsxs(Bc,{nodes:e,edges:t,width:vs,height:ws,fitView:no,fitViewOptions:ro,minZoom:_e,maxZoom:Be,nodeOrigin:Re,nodeExtent:wt,zIndexMode:io,children:[i.jsx(Vc,{onInit:u,onNodeClick:c,onEdgeClick:l,onNodeMouseEnter:N,onNodeMouseMove:g,onNodeMouseLeave:v,onNodeContextMenu:M,onNodeDoubleClick:E,nodeTypes:s,edgeTypes:a,connectionLineType:F,connectionLineStyle:G,connectionLineComponent:R,connectionLineContainerStyle:L,selectionKeyCode:O,selectionOnDrag:H,selectionMode:Y,deleteKeyCode:D,multiSelectionKeyCode:U,panActivationKeyCode:K,zoomActivationKeyCode:Q,onlyRenderVisibleElements:oe,defaultViewport:et,translateExtent:to,minZoom:_e,maxZoom:Be,preventScrolling:Cr,zoomOnScroll:_r,zoomOnPinch:Mr,zoomOnDoubleClick:Pr,panOnScroll:Ir,panOnScrollSpeed:Ar,panOnScrollMode:$r,panOnDrag:Tr,onPaneClick:zr,onPaneMouseEnter:Lr,onPaneMouseMove:Dr,onPaneMouseLeave:Rr,onPaneScroll:Vr,onPaneContextMenu:Hr,paneClickDistance:Br,nodeClickDistance:Or,onSelectionContextMenu:A,onSelectionStart:k,onSelectionEnd:C,onReconnect:Wr,onReconnectStart:Xr,onReconnectEnd:Yr,onEdgeContextMenu:Gr,onEdgeDoubleClick:qr,onEdgeMouseEnter:Kr,onEdgeMouseMove:Ur,onEdgeMouseLeave:Zr,reconnectRadius:Qr,defaultMarkerColor:kr,noDragClassName:ts,noWheelClassName:os,noPanClassName:oo,rfId:Nt,disableKeyboardA11y:so,nodeExtent:wt,viewport:ys,onViewportChange:bs}),i.jsx(wi,{nodes:e,edges:t,defaultNodes:o,defaultEdges:n,onConnect:y,onConnectStart:x,onConnectEnd:w,onClickConnectStart:b,onClickConnectEnd:m,nodesDraggable:ae,autoPanOnNodeFocus:ge,nodesConnectable:fe,nodesFocusable:je,edgesFocusable:Ve,edgesReconnectable:He,elementsSelectable:vt,elevateNodesOnSelect:is,elevateEdgesOnSelect:cs,minZoom:_e,maxZoom:Be,nodeExtent:wt,onNodesChange:Jr,onEdgesChange:es,snapToGrid:Z,snapGrid:te,connectionMode:W,translateExtent:to,connectOnClick:ns,defaultEdgeOptions:as,fitView:no,fitViewOptions:ro,onNodesDelete:X,onEdgesDelete:$,onDelete:P,onNodeDragStart:_,onNodeDrag:T,onNodeDragStop:z,onSelectionDrag:j,onSelectionDragStart:f,onSelectionDragStop:S,onMove:p,onMoveStart:d,onMoveEnd:h,noPanClassName:oo,nodeOrigin:Re,rfId:Nt,autoPanOnConnect:ls,autoPanOnNodeDrag:us,autoPanSpeed:ds,onError:gs,connectionRadius:fs,isValidConnection:hs,selectNodesOnDrag:ee,nodeDragThreshold:ps,connectionDragThreshold:ms,onBeforeDelete:V,debug:js,ariaLabelConfig:Es,zIndexMode:io}),i.jsx(mi,{onSelectionChange:B}),Fr,i.jsx(fi,{proOptions:ss,position:rs}),i.jsx(di,{rfId:Nt,disableKeyboardA11y:so})]})})}var Wc=Qn(Fc);function Xc(e){const[t,o]=I.useState(e),n=I.useCallback(r=>o(s=>Un(r,s)),[]);return[t,o,n]}function Yc(e){const[t,o]=I.useState(e),n=I.useCallback(r=>o(s=>Zn(r,s)),[]);return[t,o,n]}function Gc({dimensions:e,lineWidth:t,variant:o,className:n}){return i.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:se(["react-flow__background-pattern",o,n])})}function qc({radius:e,className:t}){return i.jsx("circle",{cx:e,cy:e,r:e,className:se(["react-flow__background-pattern","dots",t])})}var Ne;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ne||(Ne={}));const Kc={[Ne.Dots]:1,[Ne.Lines]:1,[Ne.Cross]:6},Uc=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function jr({id:e,variant:t=Ne.Dots,gap:o=20,size:n,lineWidth:r=1,offset:s=0,color:a,bgColor:c,style:l,className:u,patternClassName:p}){const d=I.useRef(null),{transform:h,patternId:y}=J(Uc,ne),x=n||Kc[t],w=t===Ne.Dots,b=t===Ne.Cross,m=Array.isArray(o)?o:[o,o],N=[m[0]*h[2]||1,m[1]*h[2]||1],g=x*h[2],v=Array.isArray(s)?s:[s,s],M=b?[g,g]:N,E=[v[0]*h[2]||1+M[0]/2,v[1]*h[2]||1+M[1]/2],_=`${y}${e||""}`;return i.jsxs("svg",{className:se(["react-flow__background",u]),style:{...l,...yt,"--xy-background-color-props":c,"--xy-background-pattern-color-props":a},ref:d,"data-testid":"rf__background",children:[i.jsx("pattern",{id:_,x:h[0]%N[0],y:h[1]%N[1],width:N[0],height:N[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`,children:w?i.jsx(qc,{radius:g/2,className:p}):i.jsx(Gc,{dimensions:M,lineWidth:r,variant:t,className:p})}),i.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${_})`})]})}jr.displayName="Background";const Zc=I.memo(jr);function Qc(){return i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:i.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Jc(){return i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:i.jsx("path",{d:"M0 0h32v4.2H0z"})})}function el(){return i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:i.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function tl(){return i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:i.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function ol(){return i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:i.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function it({children:e,className:t,...o}){return i.jsx("button",{type:"button",className:se(["react-flow__controls-button",t]),...o,children:e})}const nl=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function Er({style:e,showZoom:t=!0,showFitView:o=!0,showInteractive:n=!0,fitViewOptions:r,onZoomIn:s,onZoomOut:a,onFitView:c,onInteractiveChange:l,className:u,children:p,position:d="bottom-left",orientation:h="vertical","aria-label":y}){const x=re(),{isInteractive:w,minZoomReached:b,maxZoomReached:m,ariaLabelConfig:N}=J(nl,ne),{zoomIn:g,zoomOut:v,fitView:M}=mt(),E=()=>{g(),s==null||s()},_=()=>{v(),a==null||a()},T=()=>{M(r),c==null||c()},z=()=>{x.setState({nodesDraggable:!w,nodesConnectable:!w,elementsSelectable:!w}),l==null||l(!w)},X=h==="horizontal"?"horizontal":"vertical";return i.jsxs(pt,{className:se(["react-flow__controls",X,u]),position:d,style:e,"data-testid":"rf__controls","aria-label":y??N["controls.ariaLabel"],children:[t&&i.jsxs(i.Fragment,{children:[i.jsx(it,{onClick:E,className:"react-flow__controls-zoomin",title:N["controls.zoomIn.ariaLabel"],"aria-label":N["controls.zoomIn.ariaLabel"],disabled:m,children:i.jsx(Qc,{})}),i.jsx(it,{onClick:_,className:"react-flow__controls-zoomout",title:N["controls.zoomOut.ariaLabel"],"aria-label":N["controls.zoomOut.ariaLabel"],disabled:b,children:i.jsx(Jc,{})})]}),o&&i.jsx(it,{className:"react-flow__controls-fitview",onClick:T,title:N["controls.fitView.ariaLabel"],"aria-label":N["controls.fitView.ariaLabel"],children:i.jsx(el,{})}),n&&i.jsx(it,{className:"react-flow__controls-interactive",onClick:z,title:N["controls.interactive.ariaLabel"],"aria-label":N["controls.interactive.ariaLabel"],children:w?i.jsx(ol,{}):i.jsx(tl,{})}),p]})}Er.displayName="Controls";const rl=I.memo(Er);function sl({id:e,x:t,y:o,width:n,height:r,style:s,color:a,strokeColor:c,strokeWidth:l,className:u,borderRadius:p,shapeRendering:d,selected:h,onClick:y}){const{background:x,backgroundColor:w}=s||{},b=a||x||w;return i.jsx("rect",{className:se(["react-flow__minimap-node",{selected:h},u]),x:t,y:o,rx:p,ry:p,width:n,height:r,style:{fill:b,stroke:c,strokeWidth:l},shapeRendering:d,onClick:y?m=>y(m,e):void 0})}const al=I.memo(sl),il=e=>e.nodes.map(t=>t.id),Lt=e=>e instanceof Function?e:()=>e;function cl({nodeStrokeColor:e,nodeColor:t,nodeClassName:o="",nodeBorderRadius:n=5,nodeStrokeWidth:r,nodeComponent:s=al,onClick:a}){const c=J(il,ne),l=Lt(t),u=Lt(e),p=Lt(o),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return i.jsx(i.Fragment,{children:c.map(h=>i.jsx(ul,{id:h,nodeColorFunc:l,nodeStrokeColorFunc:u,nodeClassNameFunc:p,nodeBorderRadius:n,nodeStrokeWidth:r,NodeComponent:s,onClick:a,shapeRendering:d},h))})}function ll({id:e,nodeColorFunc:t,nodeStrokeColorFunc:o,nodeClassNameFunc:n,nodeBorderRadius:r,nodeStrokeWidth:s,shapeRendering:a,NodeComponent:c,onClick:l}){const{node:u,x:p,y:d,width:h,height:y}=J(x=>{const{internals:w}=x.nodeLookup.get(e),b=w.userNode,{x:m,y:N}=w.positionAbsolute,{width:g,height:v}=he(b);return{node:b,x:m,y:N,width:g,height:v}},ne);return!u||u.hidden||!En(u)?null:i.jsx(c,{x:p,y:d,width:h,height:y,style:u.style,selected:!!u.selected,className:n(u),color:t(u),borderRadius:r,strokeColor:o(u),strokeWidth:s,shapeRendering:a,onClick:l,id:u.id})}const ul=I.memo(ll);var dl=I.memo(cl);const fl=200,hl=150,gl=e=>!e.hidden,xl=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?jn(Ze(e.nodeLookup,{filter:gl}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},pl="react-flow__minimap-desc";function Sr({style:e,className:t,nodeStrokeColor:o,nodeColor:n,nodeClassName:r="",nodeBorderRadius:s=5,nodeStrokeWidth:a,nodeComponent:c,bgColor:l,maskColor:u,maskStrokeColor:p,maskStrokeWidth:d,position:h="bottom-right",onClick:y,onNodeClick:x,pannable:w=!1,zoomable:b=!1,ariaLabel:m,inversePan:N,zoomStep:g=1,offsetScale:v=5}){const M=re(),E=I.useRef(null),{boundingRect:_,viewBB:T,rfId:z,panZoom:X,translateExtent:$,flowWidth:P,flowHeight:B,ariaLabelConfig:f}=J(xl,ne),j=(e==null?void 0:e.width)??fl,S=(e==null?void 0:e.height)??hl,A=_.width/j,k=_.height/S,C=Math.max(A,k),V=C*j,W=C*S,F=v*C,G=_.x-(V-_.width)/2-F,R=_.y-(W-_.height)/2-F,L=V+F*2,D=W+F*2,O=`${pl}-${z}`,H=I.useRef(0),Y=I.useRef();H.current=C,I.useEffect(()=>{if(E.current&&X)return Y.current=$a({domNode:E.current,panZoom:X,getTransform:()=>M.getState().transform,getViewScale:()=>H.current}),()=>{var Z;(Z=Y.current)==null||Z.destroy()}},[X]),I.useEffect(()=>{var Z;(Z=Y.current)==null||Z.update({translateExtent:$,width:P,height:B,inversePan:N,pannable:w,zoomStep:g,zoomable:b})},[w,b,N,g,$,P,B]);const K=y?Z=>{var ee;const[te,oe]=((ee=Y.current)==null?void 0:ee.pointer(Z))||[0,0];y(Z,{x:te,y:oe})}:void 0,U=x?I.useCallback((Z,te)=>{const oe=M.getState().nodeLookup.get(te).internals.userNode;x(Z,oe)},[]):void 0,Q=m??f["minimap.ariaLabel"];return i.jsx(pt,{position:h,style:{...e,"--xy-minimap-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof p=="string"?p:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*C:void 0,"--xy-minimap-node-background-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-color-props":typeof o=="string"?o:void 0,"--xy-minimap-node-stroke-width-props":typeof a=="number"?a:void 0},className:se(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:i.jsxs("svg",{width:j,height:S,viewBox:`${G} ${R} ${L} ${D}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":O,ref:E,onClick:K,children:[Q&&i.jsx("title",{id:O,children:Q}),i.jsx(dl,{onClick:U,nodeColor:n,nodeStrokeColor:o,nodeBorderRadius:s,nodeClassName:r,nodeStrokeWidth:a,nodeComponent:c}),i.jsx("path",{className:"react-flow__minimap-mask",d:`M${G-F},${R-F}h${L+F*2}v${D+F*2}h${-L-F*2}z
        M${T.x},${T.y}h${T.width}v${T.height}h${-T.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}Sr.displayName="MiniMap";const ml=I.memo(Sr),yl=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,bl={[De.Line]:"right",[De.Handle]:"bottom-right"};function vl({nodeId:e,position:t,variant:o=De.Handle,className:n,style:r=void 0,children:s,color:a,minWidth:c=10,minHeight:l=10,maxWidth:u=Number.MAX_VALUE,maxHeight:p=Number.MAX_VALUE,keepAspectRatio:d=!1,resizeDirection:h,autoScale:y=!0,shouldResize:x,onResizeStart:w,onResize:b,onResizeEnd:m}){const N=or(),g=typeof e=="string"?e:N,v=re(),M=I.useRef(null),E=o===De.Handle,_=J(I.useCallback(yl(E&&y),[E,y]),ne),T=I.useRef(null),z=t??bl[o];I.useEffect(()=>{if(!(!M.current||!g))return T.current||(T.current=Ya({domNode:M.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:$,transform:P,snapGrid:B,snapToGrid:f,nodeOrigin:j,domNode:S}=v.getState();return{nodeLookup:$,transform:P,snapGrid:B,snapToGrid:f,nodeOrigin:j,paneDomNode:S}},onChange:($,P)=>{const{triggerNodeChanges:B,nodeLookup:f,parentLookup:j,nodeOrigin:S}=v.getState(),A=[],k={x:$.x,y:$.y},C=f.get(g);if(C&&C.expandParent&&C.parentId){const V=C.origin??S,W=$.width??C.measured.width??0,F=$.height??C.measured.height??0,G={id:C.id,parentId:C.parentId,rect:{width:W,height:F,...Sn({x:$.x??C.position.x,y:$.y??C.position.y},{width:W,height:F},C.parentId,f,V)}},R=Jt([G],f,j,S);A.push(...R),k.x=$.x?Math.max(V[0]*W,$.x):void 0,k.y=$.y?Math.max(V[1]*F,$.y):void 0}if(k.x!==void 0&&k.y!==void 0){const V={id:g,type:"position",position:{...k}};A.push(V)}if($.width!==void 0&&$.height!==void 0){const W={id:g,type:"dimensions",resizing:!0,setAttributes:h?h==="horizontal"?"width":"height":!0,dimensions:{width:$.width,height:$.height}};A.push(W)}for(const V of P){const W={...V,type:"position"};A.push(W)}B(A)},onEnd:({width:$,height:P})=>{const B={id:g,type:"dimensions",resizing:!1,dimensions:{width:$,height:P}};v.getState().triggerNodeChanges([B])}})),T.current.update({controlPosition:z,boundaries:{minWidth:c,minHeight:l,maxWidth:u,maxHeight:p},keepAspectRatio:d,resizeDirection:h,onResizeStart:w,onResize:b,onResizeEnd:m,shouldResize:x}),()=>{var $;($=T.current)==null||$.destroy()}},[z,c,l,u,p,d,w,b,m,x]);const X=z.split("-");return i.jsx("div",{className:se(["react-flow__resize-control","nodrag",...X,o,n]),ref:M,style:{...r,scale:_,...a&&{[E?"backgroundColor":"borderColor"]:a}},children:s})}I.memo(vl);const be={to_llm:{icon:"",label:"Ask AI",color:"#8B5CF6",category:"AI"},query:{icon:"",label:"Generate Query",color:"#8B5CF6",category:"AI"},to_tool:{icon:"",label:"Run Tool",color:"#F59E0B",category:"Tools"},keyword_check:{icon:"",label:"Keyword Check",color:"#10B981",category:"Flow"},go_to_llm:{icon:"",label:"Send to Main AI",color:"#10B981",category:"Flow"},filter_complete:{icon:"",label:"Complete",color:"#10B981",category:"Flow"},stop:{icon:"",label:"Stop",color:"#EF4444",category:"Flow"},block:{icon:"",label:"Block",color:"#EF4444",category:"Flow"},set_var:{icon:"",label:"Set Variable",color:"#3B82F6",category:"Data"},set_array:{icon:"",label:"Set Array",color:"#3B82F6",category:"Data"},context_insert:{icon:"",label:"Add Context",color:"#3B82F6",category:"Data"},modify:{icon:"",label:"Modify",color:"#3B82F6",category:"Data"},compare:{icon:"",label:"Compare",color:"#EC4899",category:"Logic"},call_chain:{icon:"",label:"Call Chain",color:"#EC4899",category:"Logic"},branch:{icon:"",label:"Branch",color:"#06B6D4",category:"Logic"},local_rag:{icon:"",label:"Local RAG",color:"#14B8A6",category:"RAG"},kb_rag:{icon:"",label:"KB RAG",color:"#14B8A6",category:"RAG"},global_kb:{icon:"",label:"Global KB",color:"#14B8A6",category:"RAG"},user_chats_kb:{icon:"",label:"User Chats KB",color:"#14B8A6",category:"RAG"},export_tool:{icon:"",label:"Export Tool",color:"#F97316",category:"Dynamic"},user_hint:{icon:"",label:"User Hint",color:"#F97316",category:"Dynamic"},user_action:{icon:"",label:"User Action",color:"#F97316",category:"Dynamic"},set_title:{icon:"",label:"Set Title",color:"#6366F1",category:"Chat"}},tn=[{value:"eq",label:"= equals"},{value:"ne",label:" not equals"},{value:"contains",label:"contains"},{value:"not_contains",label:"not contains"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"gt",label:"> greater than"},{value:"lt",label:"< less than"},{value:"gte",label:">= greater or equal"},{value:"lte",label:"<= less or equal"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"},{value:"matches",label:"matches regex"}],on=768,nn=180,rn=400,wl=176,Nl=320;function jl(){const[e,t]=I.useState(typeof window<"u"?window.innerWidth<on:!1);return I.useEffect(()=>{const o=()=>{t(window.innerWidth<on)};return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),e}function sn({onResize:e,position:t}){const o=I.useRef(!1),n=I.useRef(0),r=I.useCallback(a=>{o.current=!0,n.current=a.clientX,document.body.style.cursor="col-resize",document.body.style.userSelect="none";const c=u=>{if(!o.current)return;const p=t==="right"?u.clientX-n.current:n.current-u.clientX;n.current=u.clientX,e(p)},l=()=>{o.current=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",l)},[e,t]),s=I.useCallback(a=>{o.current=!0,n.current=a.touches[0].clientX;const c=u=>{if(!o.current)return;const p=t==="right"?u.touches[0].clientX-n.current:n.current-u.touches[0].clientX;n.current=u.touches[0].clientX,e(p)},l=()=>{o.current=!1,document.removeEventListener("touchmove",c),document.removeEventListener("touchend",l)};document.addEventListener("touchmove",c),document.addEventListener("touchend",l)},[e,t]);return i.jsx("div",{className:`absolute top-0 ${t==="left"?"left-0":"right-0"} w-1 h-full cursor-col-resize hover:bg-[var(--color-primary)] active:bg-[var(--color-primary)] transition-colors z-10 group`,onMouseDown:r,onTouchStart:s,children:i.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 w-1 h-8 rounded-full bg-[var(--color-border)] group-hover:bg-[var(--color-primary)] transition-colors"})})}function an({isOpen:e,onClick:t,icon:o,label:n,position:r}){return i.jsx("button",{onClick:t,className:`fixed ${r==="left"?"left-2":"right-2"} top-1/2 -translate-y-1/2 z-50 p-2 rounded-full bg-[var(--color-surface)] border border-[var(--color-border)] shadow-lg hover:bg-[var(--color-background)] transition-all`,title:n,children:i.jsx("span",{className:"text-lg",children:o})})}const ve=["#22C55E","#EF4444","#F59E0B","#8B5CF6","#06B6D4","#EC4899"];function El({data:e}){var l,u,p,d,h;const{step:t,stepIndex:o,selected:n,onSelect:r}=e,s=be[t.type]||{icon:"",label:t.type,color:"#6B7280"},a=((l=t.config)==null?void 0:l.output_var)||((u=t.config)==null?void 0:u.var_name),c=t.type==="branch"&&Array.isArray((p=t.config)==null?void 0:p.outputs)?t.config.outputs:null;return i.jsxs("div",{className:`relative min-w-[200px] rounded-lg shadow-lg border-2 transition-all cursor-pointer ${n?"border-blue-500 ring-2 ring-blue-500/30":"border-transparent hover:border-gray-500"} ${t.enabled===!1?"opacity-50":""}`,style:{backgroundColor:"var(--color-surface)"},onClick:()=>r(t.id),children:[i.jsx(we,{type:"target",position:q.Top,className:"!w-3 !h-3 !bg-gray-400 !border-2 !border-gray-600"}),i.jsx("div",{className:"absolute -top-2 -left-2 w-5 h-5 rounded-full bg-gray-700 text-white text-[10px] font-bold flex items-center justify-center border border-gray-500",title:`Execution order: ${o+1}`,children:o+1}),i.jsxs("div",{className:"px-3 py-2 rounded-t-lg flex items-center gap-2",style:{backgroundColor:s.color},children:[i.jsx("span",{className:"text-lg",children:s.icon}),i.jsx("div",{className:"flex-1 min-w-0",children:i.jsx("span",{className:"font-medium text-white text-sm",children:s.label})}),t.enabled===!1&&i.jsx("span",{className:"text-white/70 text-xs",children:"OFF"})]}),i.jsxs("div",{className:"px-3 py-2 text-xs",style:{color:"var(--color-text-secondary)"},children:[t.name&&t.name!=="Ask LLM"&&t.name!==s.label&&i.jsx("div",{className:"font-medium truncate",style:{color:"var(--color-text)"},children:t.name}),typeof a=="string"&&a?i.jsxs("div",{className:"truncate",children:[" $",String(a)]}):null,t.type==="to_tool"&&typeof((d=t.config)==null?void 0:d.tool_name)=="string"&&t.config.tool_name?i.jsx("div",{className:"truncate",children:String(t.config.tool_name)}):null,(t.type==="to_llm"||t.type==="query")&&typeof((h=t.config)==null?void 0:h.prompt)=="string"&&t.config.prompt?i.jsxs("div",{className:"truncate",children:[String(t.config.prompt).slice(0,40),"..."]}):null,c&&c.length>0&&i.jsx("div",{className:"mt-1 space-y-0.5",children:c.map((y,x)=>i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:ve[x%ve.length]}}),i.jsx("span",{className:"truncate",children:y.label||`Output ${x+1}`})]},y.id))})]}),c&&c.length>0?i.jsx("div",{className:"relative h-4",children:c.map((y,x)=>i.jsx(we,{type:"source",position:q.Bottom,id:y.id,className:"!w-3 !h-3 !border-2",style:{left:`${(x+1)/(c.length+1)*100}%`,backgroundColor:ve[x%ve.length],borderColor:"#374151"}},y.id))}):i.jsx(we,{type:"source",position:q.Bottom,className:"!w-3 !h-3 !bg-gray-400 !border-2 !border-gray-600"})]})}function Sl(){return i.jsxs("div",{className:"px-4 py-2 rounded-full bg-green-600 text-white font-medium shadow-lg",children:[i.jsx("span",{className:"mr-2",children:""})," Start",i.jsx(we,{type:"source",position:q.Bottom,className:"!w-3 !h-3 !bg-green-400 !border-2 !border-green-700"})]})}function Cl({onAddNode:e}){const[t,o]=I.useState(""),n=I.useMemo(()=>{const s={};return Object.entries(be).forEach(([a,c])=>{s[c.category]||(s[c.category]=[]),s[c.category].push({type:a,...c})}),s},[]),r=I.useMemo(()=>{if(!t.trim())return n;const s=t.toLowerCase(),a={};return Object.entries(n).forEach(([c,l])=>{const u=l.filter(p=>p.label.toLowerCase().includes(s)||p.type.toLowerCase().includes(s)||c.toLowerCase().includes(s));u.length>0&&(a[c]=u)}),a},[n,t]);return i.jsxs("div",{className:"w-full",children:[i.jsx("div",{className:"text-xs font-medium text-[var(--color-text)] mb-2",children:"Add Node"}),i.jsx("input",{type:"text",placeholder:"Search nodes...",value:t,onChange:s=>o(s.target.value),className:"w-full px-2 py-1 mb-2 text-xs rounded bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)] placeholder-[var(--color-text-secondary)]"}),i.jsxs("div",{className:"max-h-[50vh] overflow-y-auto",children:[Object.entries(r).map(([s,a])=>i.jsxs("div",{className:"mb-2",children:[i.jsx("div",{className:"text-[10px] text-[var(--color-text-secondary)] mb-1 uppercase sticky top-0 bg-[var(--color-surface)] py-0.5",children:s}),i.jsx("div",{className:"space-y-0.5",children:a.map(c=>i.jsxs("button",{onClick:()=>e(c.type),className:"w-full px-2 py-1.5 rounded text-left text-xs flex items-center gap-1.5 hover:bg-[var(--color-background)] active:bg-[var(--color-primary)]/20 transition-colors touch-manipulation",style:{color:"var(--color-text)"},children:[i.jsx("span",{className:"w-5 h-5 rounded flex items-center justify-center text-white text-[10px] flex-shrink-0",style:{backgroundColor:c.color},children:c.icon}),i.jsx("span",{className:"truncate",children:c.label})]},c.type))})]},s)),Object.keys(r).length===0&&i.jsxs("div",{className:"text-xs text-[var(--color-text-secondary)] italic py-2",children:['No nodes match "',t,'"']})]}),i.jsxs("div",{className:"border-t border-[var(--color-border)] mt-2 pt-2 text-[10px] text-[var(--color-text-secondary)]",children:[i.jsx("div",{className:"font-medium mb-1",children:" Tips:"}),i.jsxs("ul",{className:"space-y-0.5 list-disc list-inside",children:[i.jsx("li",{children:"Drag handles to connect nodes"}),i.jsx("li",{children:"Click wire to delete it"}),i.jsx("li",{children:"Drag panel edges to resize"})]})]})]})}function cn({steps:e,currentStepIndex:t}){const[o,n]=I.useState(!0),r=I.useMemo(()=>{const s=[{name:"$Query",source:"Input",stepIndex:-1,type:"string"},{name:"$PreviousResult",source:"Previous Step",stepIndex:-1,type:"any"}];return e.slice(0,t).forEach((a,c)=>{var u,p;const l=((u=a.config)==null?void 0:u.output_var)||((p=a.config)==null?void 0:p.var_name);if(l&&typeof l=="string"){const d=be[a.type];let h="any";(a.type==="to_llm"||a.type==="query")&&(h="string"),a.type==="to_tool"&&(h="object"),a.type==="set_array"&&(h="array"),a.type==="compare"&&(h="boolean"),["local_rag","kb_rag","global_kb"].includes(a.type)&&(h="array"),a.type==="user_chats_kb"&&(h="string"),s.push({name:`$Var[${l}]`,source:(d==null?void 0:d.label)||a.type,stepIndex:c,type:h})}}),s},[e,t]);return i.jsxs("div",{className:"border-t border-[var(--color-border)] mt-4 pt-4",children:[i.jsxs("button",{onClick:()=>n(!o),className:"flex items-center gap-2 text-sm font-medium text-[var(--color-text)] w-full",children:[i.jsx("span",{children:o?"":""}),i.jsx("span",{children:" Available Variables"}),i.jsxs("span",{className:"text-xs text-[var(--color-text-secondary)]",children:["(",r.length,")"]})]}),o&&i.jsxs("div",{className:"mt-2 space-y-1 max-h-48 overflow-y-auto",children:[r.map((s,a)=>i.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5 rounded bg-[var(--color-background)] text-xs",children:[i.jsx("code",{className:"text-blue-400 font-mono",children:s.name}),i.jsxs("span",{className:"text-[var(--color-text-secondary)]",children:[i.jsx("span",{className:"px-1 py-0.5 rounded bg-[var(--color-surface)] mr-1",children:s.type}),s.source]})]},a)),t<0&&i.jsx("div",{className:"text-xs text-[var(--color-text-secondary)] italic p-2",children:"Select a step to see available variables"})]})]})}function kl({step:e,stepIndex:t,allSteps:o,onUpdate:n,onDelete:r,availableTools:s,filterChains:a}){var d,h,y,x,w,b,m,N,g,v,M,E,_,T,z,X,$,P,B;if(!e)return i.jsxs("div",{className:"h-full flex flex-col",children:[i.jsx("div",{className:"flex-1 flex items-center justify-center text-[var(--color-text-secondary)] text-sm",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-4xl mb-2",children:""}),i.jsx("div",{children:"Select a node to configure"}),i.jsx("div",{className:"text-xs mt-2 opacity-70",children:"or drag from palette to add"})]})}),i.jsx("div",{className:"p-3 border-t border-[var(--color-border)]",children:i.jsx(cn,{steps:o,currentStepIndex:-1})})]});const c=be[e.type]||{icon:"",label:e.type,color:"#6B7280"},l=(f,j="")=>{var k;const A={tool:["tool","tool_name"],system:["system","system_prompt"]}[f]||[f];for(const C of A){const V=(k=e.config)==null?void 0:k[C];if(typeof V=="string"&&V)return V}return j},u=(f,j)=>{n({config:{...e.config,[f]:j}})},p=I.useMemo(()=>{const f=[{value:"$Query",label:"User Message"},{value:"$PreviousResult",label:"Previous Result"}];return o.slice(0,t).forEach((j,S)=>{var k,C;const A=((k=j.config)==null?void 0:k.output_var)||((C=j.config)==null?void 0:C.var_name);A&&typeof A=="string"&&f.push({value:`$Var[${A}]`,label:`Step ${S+1}: ${A}`})}),f},[o,t]);return i.jsxs("div",{className:"h-full flex flex-col",children:[i.jsxs("div",{className:"p-3 border-b border-[var(--color-border)] flex items-center gap-2",style:{backgroundColor:c.color},children:[i.jsx("span",{className:"text-xl",children:c.icon}),i.jsx("span",{className:"font-medium text-white flex-1",children:c.label}),i.jsxs("span",{className:"text-white/70 text-xs",children:["Step ",t+1]})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-4",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Custom Label"}),i.jsx("input",{type:"text",value:e.name==="Ask LLM"?"":e.name||"",onChange:f=>n({name:f.target.value||void 0}),placeholder:c.label,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"})]}),i.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:e.enabled!==!1,onChange:f=>n({enabled:f.target.checked}),className:"rounded"}),i.jsx("span",{className:"text-sm text-[var(--color-text)]",children:"Enabled"})]})]}),(e.type==="to_llm"||e.type==="query")&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:e.type==="query"?"Query Prompt":"AI Prompt"}),i.jsx("div",{className:"flex flex-wrap gap-1 mb-1",children:p.map(f=>i.jsx("button",{onClick:()=>u("prompt",l("prompt")+`{${f.value}}`),className:"px-1.5 py-0.5 text-[10px] rounded bg-blue-500/20 text-blue-400 hover:bg-blue-500/30",children:f.label},f.value))}),i.jsx("textarea",{value:l("prompt"),onChange:f=>u("prompt",f.target.value),rows:4,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)] resize-none",placeholder:"Enter prompt..."})]}),e.type==="to_llm"&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"System Prompt"}),i.jsx("textarea",{value:l("system"),onChange:f=>u("system",f.target.value),rows:2,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)] resize-none",placeholder:"Optional system prompt..."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Save Result As"}),i.jsx("input",{type:"text",value:l("output_var"),onChange:f=>u("output_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., AIResponse"})]})]}),e.type==="to_tool"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Tool"}),i.jsxs("select",{value:l("tool")||l("tool_name"),onChange:f=>u("tool_name",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"",children:"Select a tool..."}),s==null?void 0:s.map(f=>i.jsx("option",{value:f.value,children:f.label},f.value))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Input Variable"}),i.jsx("input",{type:"text",value:l("input_var","$Query"),onChange:f=>u("input_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Save Result As"}),i.jsx("input",{type:"text",value:l("output_var"),onChange:f=>u("output_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., ToolResult"})]})]}),e.type==="set_var"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Variable Name"}),i.jsx("input",{type:"text",value:l("var_name"),onChange:f=>u("var_name",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., MyVar"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Value"}),i.jsx("input",{type:"text",value:l("value"),onChange:f=>u("value",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"Value or {$Variable}"})]})]}),e.type==="set_array"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Array Name"}),i.jsx("input",{type:"text",value:l("var_name")||l("output_var"),onChange:f=>{u("var_name",f.target.value),u("output_var",f.target.value)},className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., urls"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Values (JSON array or expressions)"}),i.jsx("textarea",{value:Array.isArray((d=e.config)==null?void 0:d.values)?JSON.stringify(e.config.values,null,2):"[]",onChange:f=>{try{u("values",JSON.parse(f.target.value))}catch{}},rows:4,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)] font-mono resize-none",placeholder:'["value1", "value2"]'})]})]}),e.type==="compare"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Left Value"}),i.jsx("input",{type:"text",value:l("left"),onChange:f=>u("left",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"$Query or value"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Operator"}),i.jsx("select",{value:l("operator","eq"),onChange:f=>u("operator",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:tn.map(f=>i.jsx("option",{value:f.value,children:f.label},f.value))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Right Value"}),i.jsx("input",{type:"text",value:l("right"),onChange:f=>u("right",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"Value to compare"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Save Result As"}),i.jsx("input",{type:"text",value:l("output_var"),onChange:f=>u("output_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., CompareResult"})]})]}),e.type==="modify"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Target"}),i.jsxs("select",{value:l("target","query"),onChange:f=>u("target",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"query",children:"User Message"}),i.jsx("option",{value:"response",children:"AI Response"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"New Value"}),i.jsx("input",{type:"text",value:l("transform"),onChange:f=>u("transform",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"New value (can use {$Variables})"})]})]}),e.type==="context_insert"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Label"}),i.jsx("input",{type:"text",value:l("label")||l("context_label"),onChange:f=>u("context_label",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., Search Results"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Content Variable"}),i.jsx("input",{type:"text",value:l("content_var")||l("source_var","$PreviousResult"),onChange:f=>u("source_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"})]})]}),e.type==="call_chain"&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Chain to Call"}),i.jsxs("select",{value:l("chain_name"),onChange:f=>u("chain_name",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"",children:"Select a chain..."}),a==null?void 0:a.map(f=>i.jsx("option",{value:f.name,children:f.name},f.id))]})]}),e.type==="branch"&&i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"text-xs text-[var(--color-text-secondary)] p-2 bg-[var(--color-background)] rounded",children:"Configure conditional outputs. First matching condition wins. Connect each output to its target step."}),(Array.isArray((h=e.config)==null?void 0:h.outputs)?e.config.outputs:[]).map((f,j)=>{var S,A,k,C,V,W,F,G,R;return i.jsxs("div",{className:"p-2 rounded border border-[var(--color-border)] space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:ve[j%ve.length]}}),i.jsx("input",{type:"text",value:f.label||"",onChange:L=>{var O;const D=[...((O=e.config)==null?void 0:O.outputs)||[]];D[j]={...D[j],label:L.target.value},u("outputs",D)},placeholder:j===((A=(S=e.config)==null?void 0:S.outputs)==null?void 0:A.length)-1?"Else (default)":`Output ${j+1}`,className:"flex-1 px-2 py-1 rounded text-xs bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"}),((C=(k=e.config)==null?void 0:k.outputs)==null?void 0:C.length)>2&&i.jsx("button",{onClick:()=>{var D;const L=[...((D=e.config)==null?void 0:D.outputs)||[]];L.splice(j,1),u("outputs",L)},className:"text-red-400 hover:text-red-300 text-xs",children:""})]}),j<((W=(V=e.config)==null?void 0:V.outputs)==null?void 0:W.length)-1&&i.jsxs("div",{className:"space-y-1 pl-5",children:[i.jsx("div",{className:"text-[10px] text-[var(--color-text-secondary)]",children:"If:"}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("input",{type:"text",value:((F=f.condition)==null?void 0:F.var)||"",onChange:L=>{var O,H,Y;const D=[...((O=e.config)==null?void 0:O.outputs)||[]];D[j]={...D[j],condition:{...D[j].condition,var:L.target.value,operator:((H=D[j].condition)==null?void 0:H.operator)||"contains",value:((Y=D[j].condition)==null?void 0:Y.value)||""}},u("outputs",D)},placeholder:"$Var[name]",className:"flex-1 px-1.5 py-0.5 rounded text-[10px] bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"}),i.jsx("select",{value:((G=f.condition)==null?void 0:G.operator)||"contains",onChange:L=>{var O,H,Y;const D=[...((O=e.config)==null?void 0:O.outputs)||[]];D[j]={...D[j],condition:{...D[j].condition,operator:L.target.value,var:((H=D[j].condition)==null?void 0:H.var)||"",value:((Y=D[j].condition)==null?void 0:Y.value)||""}},u("outputs",D)},className:"w-24 px-1 py-0.5 rounded text-[10px] bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:tn.map(L=>i.jsx("option",{value:L.value,children:L.label},L.value))}),i.jsx("input",{type:"text",value:((R=f.condition)==null?void 0:R.value)||"",onChange:L=>{var O,H,Y;const D=[...((O=e.config)==null?void 0:O.outputs)||[]];D[j]={...D[j],condition:{...D[j].condition,value:L.target.value,var:((H=D[j].condition)==null?void 0:H.var)||"",operator:((Y=D[j].condition)==null?void 0:Y.operator)||"contains"}},u("outputs",D)},placeholder:"value",className:"flex-1 px-1.5 py-0.5 rounded text-[10px] bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"})]})]}),i.jsx("div",{className:"pl-5",children:i.jsxs("select",{value:f.jump_to||"",onChange:L=>{var O;const D=[...((O=e.config)==null?void 0:O.outputs)||[]];D[j]={...D[j],jump_to:L.target.value||void 0},u("outputs",D)},className:"w-full px-1.5 py-0.5 rounded text-[10px] bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"",children:"Then: Continue to next step"}),o.filter(L=>L.id!==e.id).map(L=>{const D=be[L.type];return i.jsxs("option",{value:L.id,children:["Then: ",(D==null?void 0:D.label)||L.type," (Step ",o.indexOf(L)+1,")"]},L.id)})]})})]},f.id)}),i.jsxs("button",{onClick:()=>{var S;const f=[...((S=e.config)==null?void 0:S.outputs)||[]],j={id:`output_${Date.now()}`,label:"",condition:{var:"",operator:"contains",value:""}};f.splice(f.length-1,0,j),u("outputs",f)},className:"w-full px-2 py-1.5 rounded text-xs bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 flex items-center justify-center gap-1",children:[i.jsx("span",{children:"+"})," Add Output"]})]}),e.type==="keyword_check"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Keywords (one per line)"}),i.jsx("textarea",{value:Array.isArray((y=e.config)==null?void 0:y.keywords)?e.config.keywords.join(`
`):"",onChange:f=>u("keywords",f.target.value.split(`
`).filter(j=>j.trim())),rows:4,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)] font-mono",placeholder:"Enter keywords, one per line"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Match Mode"}),i.jsxs("select",{value:l("mode","any"),onChange:f=>u("mode",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"any",children:"Any keyword"}),i.jsx("option",{value:"all",children:"All keywords"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Match Type"}),i.jsxs("select",{value:l("match_type","contains"),onChange:f=>u("match_type",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"contains",children:"Contains"}),i.jsx("option",{value:"word",children:"Whole word"}),i.jsx("option",{value:"exact",children:"Exact match"}),i.jsx("option",{value:"starts_with",children:"Starts with"}),i.jsx("option",{value:"ends_with",children:"Ends with"}),i.jsx("option",{value:"regex",children:"Regex"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"On No Match"}),i.jsxs("select",{value:l("on_no_match","skip_chain"),onChange:f=>u("on_no_match",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"skip_chain",children:"Skip entire chain (quick exit)"}),i.jsx("option",{value:"go_to_llm",children:"Go to main AI"}),i.jsx("option",{value:"continue",children:"Continue to next step"})]}),i.jsx("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1",children:`"Skip chain" is fastest - exits immediately if keywords don't match`})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",id:`case-sensitive-${e.id}`,checked:!!((x=e.config)!=null&&x.case_sensitive),onChange:f=>u("case_sensitive",f.target.checked),className:"rounded"}),i.jsx("label",{htmlFor:`case-sensitive-${e.id}`,className:"text-xs text-[var(--color-text)]",children:"Case sensitive"})]})]}),["local_rag","kb_rag","global_kb","user_chats_kb"].includes(e.type)&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Query Variable"}),i.jsx("input",{type:"text",value:l("query_var","$Query"),onChange:f=>u("query_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"$Query"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Output Variable"}),i.jsx("input",{type:"text",value:l("output_var",e.type==="user_chats_kb"?"UserChatsKBResults":e.type==="local_rag"?"LocalRAGResults":e.type==="kb_rag"?"KBRAGResults":"GlobalKBResults"),onChange:f=>u("output_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Top K Results"}),i.jsx("input",{type:"number",value:Number((w=e.config)==null?void 0:w.top_k)||5,onChange:f=>u("top_k",parseInt(f.target.value)||5),min:1,max:20,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Min Score"}),i.jsx("input",{type:"number",value:Number((b=e.config)==null?void 0:b.threshold)||.4,onChange:f=>u("threshold",parseFloat(f.target.value)||.4),min:0,max:1,step:.1,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"})]})]}),i.jsxs("p",{className:"text-[10px] text-[var(--color-text-secondary)]",children:[e.type==="local_rag"&&"Searches documents uploaded to the current chat.",e.type==="kb_rag"&&"Searches the current assistant's knowledge base.",e.type==="global_kb"&&"Searches global knowledge bases.",e.type==="user_chats_kb"&&"Searches user's indexed chat history."]})]}),e.type==="export_tool"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Tool Name"}),i.jsx("input",{type:"text",value:l("name",""),onChange:f=>u("name",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., WebSearch"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Trigger Pattern (Regex)"}),i.jsx("input",{type:"text",value:l("trigger_pattern",""),onChange:f=>u("trigger_pattern",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)] font-mono",placeholder:'e.g., \\$WebSearch="([^"]+)"'})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Advertise Text"}),i.jsx("textarea",{value:l("advertise_text",""),onChange:f=>u("advertise_text",f.target.value),rows:2,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"Text to add to system prompt"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:((m=e.config)==null?void 0:m.advertise)!==!1,onChange:f=>u("advertise",f.target.checked),className:"rounded"}),i.jsx("span",{className:"text-xs text-[var(--color-text)]",children:"Advertise to LLM"})]}),i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:((N=e.config)==null?void 0:N.erase_from_display)!==!1,onChange:f=>u("erase_from_display",f.target.checked),className:"rounded"}),i.jsx("span",{className:"text-xs text-[var(--color-text)]",children:"Hide trigger from UI"})]})]})]}),e.type==="user_hint"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Label"}),i.jsx("input",{type:"text",value:l("label",""),onChange:f=>u("label",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., Explain"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Location"}),i.jsxs("select",{value:l("location","response"),onChange:f=>u("location",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"response",children:"Response only"}),i.jsx("option",{value:"query",children:"Query only"}),i.jsx("option",{value:"both",children:"Both"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Prompt Template"}),i.jsx("textarea",{value:l("prompt",""),onChange:f=>u("prompt",f.target.value),rows:3,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"Use {$Selected} for selected text"})]}),i.jsx("p",{className:"text-[10px] text-[var(--color-text-secondary)]",children:"Shows in popup when user selects text in messages."})]}),e.type==="user_action"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Label"}),i.jsx("input",{type:"text",value:l("label",""),onChange:f=>u("label",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"e.g., Search Web"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Position"}),i.jsxs("select",{value:l("position","response"),onChange:f=>u("position",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"response",children:"Below responses"}),i.jsx("option",{value:"query",children:"Below queries"}),i.jsx("option",{value:"input",children:"In input area"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Prompt Template"}),i.jsx("textarea",{value:l("prompt",""),onChange:f=>u("prompt",f.target.value),rows:3,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"Use {$MessageContent} for message"})]}),i.jsx("p",{className:"text-[10px] text-[var(--color-text-secondary)]",children:"Shows as a button below messages."})]}),e.type==="go_to_llm"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Input Variable"}),i.jsx("input",{type:"text",value:l("input_var","$Query"),onChange:f=>u("input_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"Variable to send to main AI"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:["Include Variables",i.jsx("span",{className:"ml-1 text-[var(--color-text-secondary)] font-normal",children:"(pass to LLM)"})]}),i.jsxs("div",{className:"space-y-1",children:[(Array.isArray((g=e.config)==null?void 0:g.include_vars)?e.config.include_vars:[]).map((f,j)=>i.jsxs("div",{className:"flex gap-1",children:[i.jsx("input",{type:"text",value:f,onChange:S=>{var k;const A=[...((k=e.config)==null?void 0:k.include_vars)||[]];A[j]=S.target.value,u("include_vars",A)},className:"flex-1 px-2 py-1 rounded text-xs bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"$Var[name] or name"}),i.jsx("button",{onClick:()=>{var A;const S=[...((A=e.config)==null?void 0:A.include_vars)||[]];S.splice(j,1),u("include_vars",S)},className:"px-2 text-red-400 hover:text-red-300 text-xs",children:""})]},j)),i.jsx("button",{onClick:()=>{var j;const f=[...((j=e.config)==null?void 0:j.include_vars)||[],""];u("include_vars",f)},className:"text-xs text-[var(--color-primary)] hover:text-[var(--color-primary-hover)]",children:"+ Add Variable"})]})]}),i.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:((v=e.config)==null?void 0:v.include_context)!==!1,onChange:f=>u("include_context",f.target.checked),className:"w-4 h-4 rounded border-[var(--color-border)] bg-[var(--color-background)] text-[var(--color-primary)]"}),i.jsx("span",{className:"text-xs text-[var(--color-text)]",children:"Include accumulated context"})]})]}),(e.type==="filter_complete"||e.type==="stop"||e.type==="block")&&i.jsxs("div",{className:"text-xs text-[var(--color-text-secondary)] italic p-2 bg-[var(--color-background)] rounded",children:[e.type==="filter_complete"&&"Ends the filter chain and proceeds to main AI",e.type==="stop"&&"Stops all processing, no AI response",e.type==="block"&&"Blocks the message with an error response"]}),e.type==="set_title"&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Title Mode"}),i.jsxs("select",{value:(M=e.config)!=null&&M.generate?"generate":(E=e.config)!=null&&E.title_var?"variable":"static",onChange:f=>{const j=f.target.value;j==="generate"?(u("generate",!0),u("title",""),u("title_var","")):j==="variable"?(u("generate",!1),u("title","")):(u("generate",!1),u("title_var",""))},className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"static",children:"Static Title"}),i.jsx("option",{value:"variable",children:"From Variable"}),i.jsx("option",{value:"generate",children:"AI Generated"})]})]}),!((_=e.config)!=null&&_.generate)&&!((T=e.config)!=null&&T.title_var)&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Title"}),i.jsx("input",{type:"text",value:l("title",""),onChange:f=>u("title",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"Chat title (supports $Var[name])"})]}),((z=e.config)==null?void 0:z.title_var)!==void 0&&!((X=e.config)!=null&&X.generate)&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Title Variable"}),i.jsx("input",{type:"text",value:l("title_var",""),onChange:f=>u("title_var",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:"$Var[GeneratedTitle]"})]}),!!(($=e.config)!=null&&$.generate)&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Generation Prompt (optional)"}),i.jsx("textarea",{value:l("generate_prompt",""),onChange:f=>u("generate_prompt",f.target.value),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)] min-h-[60px]",placeholder:"Custom prompt for title generation..."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:"Max Length"}),i.jsx("input",{type:"number",value:((P=e.config)==null?void 0:P.max_length)??100,onChange:f=>u("max_length",parseInt(f.target.value)||100),min:10,max:255,className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]"})]}),i.jsx("p",{className:"text-[10px] text-[var(--color-text-secondary)]",children:"Updates the chat title. Result stored in $Var[ChatTitle]."})]}),!["go_to_llm","filter_complete","stop","block","branch","context_insert"].includes(e.type)&&i.jsxs("div",{className:"p-2 bg-[var(--color-background)] rounded border border-[var(--color-border)] space-y-2",children:[i.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:e.add_to_context||!1,onChange:f=>n({add_to_context:f.target.checked}),className:"w-4 h-4 rounded border-[var(--color-border)] bg-[var(--color-background)] text-[var(--color-primary)]"}),i.jsx("span",{className:"text-xs text-[var(--color-text)]",children:"Add output to context"})]}),e.add_to_context&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-[10px] text-[var(--color-text-secondary)] mb-1",children:"Context Label"}),i.jsx("input",{type:"text",value:e.context_label||"",onChange:f=>n({context_label:f.target.value||void 0}),className:"w-full px-2 py-1 rounded text-xs bg-[var(--color-surface)] border border-[var(--color-border)] text-[var(--color-text)]",placeholder:e.name||((B=be[e.type])==null?void 0:B.label)||e.type}),i.jsx("p",{className:"text-[9px] text-[var(--color-text-secondary)] mt-1",children:"Output will be passed to main AI as context"})]})]}),e.type!=="branch"&&i.jsxs("div",{children:[i.jsxs("label",{className:"block text-xs text-[var(--color-text-secondary)] mb-1",children:["Connect To",!e.jump_to_step&&i.jsx("span",{className:"ml-1 text-yellow-500",children:"(no connection)"})]}),i.jsxs("select",{value:e.jump_to_step||"",onChange:f=>n({jump_to_step:f.target.value||void 0}),className:"w-full px-2 py-1.5 rounded text-sm bg-[var(--color-background)] border border-[var(--color-border)] text-[var(--color-text)]",children:[i.jsx("option",{value:"",children:" No connection "}),o.filter(f=>f.id!==e.id).map(f=>{const j=be[f.type];return i.jsxs("option",{value:f.id,children:[" ",(j==null?void 0:j.label)||f.type," (Step ",o.indexOf(f)+1,")"]},f.id)})]}),i.jsx("p",{className:"text-[10px] text-[var(--color-text-secondary)] mt-1",children:"Drag from output handle or select target step"})]}),i.jsx(cn,{steps:o,currentStepIndex:t})]}),i.jsx("div",{className:"p-3 border-t border-[var(--color-border)]",children:i.jsx("button",{onClick:r,className:"w-full px-3 py-2 bg-red-500/20 text-red-400 rounded text-sm hover:bg-red-500/30",children:"Delete Step"})})]})}const _l={stepNode:El,startNode:Sl};function Ml({definition:e,onChange:t,availableTools:o,filterChains:n}){const{fitView:r}=mt(),[s,a]=I.useState(null),c=I.useRef(!1),l=jl(),[u,p]=I.useState(wl),[d,h]=I.useState(Nl),[y,x]=I.useState(!l),[w,b]=I.useState(!l);I.useEffect(()=>{l?(x(!1),b(!1)):(x(!0),b(!0))},[l]),I.useEffect(()=>{l&&s&&(b(!0),x(!1))},[l,s]);const m=I.useCallback(R=>{p(L=>Math.min(rn,Math.max(nn,L+R)))},[]),N=I.useCallback(R=>{h(L=>Math.min(rn,Math.max(nn,L+R)))},[]),g=I.useMemo(()=>!(e!=null&&e.steps)||!Array.isArray(e.steps)?[]:e.steps.map((R,L)=>({...R,id:R.id||`step_${L}_${Date.now()}`,type:R.type||"to_llm",enabled:R.enabled!==!1,config:R.config||{}})),[e==null?void 0:e.steps]);I.useEffect(()=>{var R;!c.current&&g.length>0&&((R=e==null?void 0:e.steps)!=null&&R.some((D,O)=>!D.id||D.id!==g[O].id)&&t({steps:g}),c.current=!0)},[g,e==null?void 0:e.steps,t]);const v=I.useCallback((R,L)=>{const D=[{id:"start",type:"startNode",position:{x:250,y:0},data:{},draggable:!1}];return R.forEach((O,H)=>{const Y={x:150,y:80+H*140};D.push({id:O.id,type:"stepNode",position:O.position||Y,data:{step:O,stepIndex:H,selected:O.id===L,onSelect:a}})}),D},[]),M=I.useCallback(R=>{const L=[];return R.length>0&&L.push({id:"start-to-first",source:"start",target:R[0].id,markerEnd:{type:ye.ArrowClosed},style:{stroke:"#6B7280"}}),R.forEach((D,O)=>{var H;D.type==="branch"&&Array.isArray((H=D.config)==null?void 0:H.outputs)?D.config.outputs.forEach((K,U)=>{K.jump_to&&L.push({id:`branch-${D.id}-${K.id}-to-${K.jump_to}`,source:D.id,sourceHandle:K.id,target:K.jump_to,markerEnd:{type:ye.ArrowClosed},style:{stroke:ve[U%ve.length],strokeWidth:2},animated:!0,label:K.label||`Output ${U+1}`,data:{deletable:!0,branchOutputId:K.id}})}):D.jump_to_step&&L.push({id:`jump-${D.id}-to-${D.jump_to_step}`,source:D.id,target:D.jump_to_step,markerEnd:{type:ye.ArrowClosed},style:{stroke:"#F59E0B",strokeWidth:2},animated:!0,data:{deletable:!0}})}),L},[]),[E,_]=I.useState(null),[T,z,X]=Xc(v(g,s)),[$,P,B]=Yc(M(g));I.useEffect(()=>{z(v(g,s)),P(M(g))},[g,s,v,M,z,P]);const f=I.useCallback((R,L)=>{R.preventDefault(),R.stopPropagation(),_({x:R.clientX,y:R.clientY,edgeId:L.id})},[]),j=I.useCallback(R=>{const L=$.find(O=>O.id===R);if(!L)return;const D=g.map(O=>{var H;if(O.id!==L.source)return O;if(O.type==="branch"&&L.sourceHandle){const Y=[...((H=O.config)==null?void 0:H.outputs)||[]],K=Y.findIndex(U=>U.id===L.sourceHandle);return K>=0&&(Y[K]={...Y[K],jump_to:void 0}),{...O,config:{...O.config,outputs:Y}}}return{...O,jump_to_step:void 0}});t({steps:D}),_(null)},[$,g,t]),S=I.useCallback(R=>{X(R)},[X]),A=I.useCallback((R,L)=>{if(L.id==="start")return;const D=g.map(O=>O.id===L.id?{...O,position:{x:L.position.x,y:L.position.y}}:O);t({steps:D})},[g,t]),k=g.find(R=>R.id===s)||null,C=k?g.indexOf(k):-1,V=I.useCallback(R=>{if(!s)return;const L=g.map(D=>D.id===s?{...D,...R}:D);t({steps:L})},[s,g,t]),W=I.useCallback(()=>{if(!s)return;const R=g.filter(L=>L.id!==s).map(L=>{var D;if(L.jump_to_step===s)return{...L,jump_to_step:void 0};if(L.type==="branch"&&Array.isArray((D=L.config)==null?void 0:D.outputs)){const O=L.config.outputs.map(H=>H.jump_to===s?{...H,jump_to:void 0}:H);return{...L,config:{...L.config,outputs:O}}}return L});t({steps:R}),a(null)},[s,g,t]),F=I.useCallback(R=>{const L=`step_${Date.now()}`,D=T.filter(U=>U.type==="stepNode").pop(),O=D?D.position.y+140:80;let H={};R==="branch"&&(H={outputs:[{id:`output_${Date.now()}_1`,label:"If True",condition:{var:"",operator:"contains",value:""}},{id:`output_${Date.now()}_2`,label:"Else"}]});const Y={id:L,type:R,enabled:!0,config:H,position:{x:150,y:O}},K=[...g,Y];t({steps:K}),a(L),setTimeout(()=>r({padding:.2}),100)},[g,T,t,r]),G=I.useCallback(R=>{if(!R.source||!R.target||R.source==="start")return;const L=g.find(D=>D.id===R.source);if((L==null?void 0:L.type)==="branch"&&R.sourceHandle){const D=g.map(O=>{var K;if(O.id!==R.source)return O;const H=[...((K=O.config)==null?void 0:K.outputs)||[]],Y=H.findIndex(U=>U.id===R.sourceHandle);return Y>=0&&(H[Y]={...H[Y],jump_to:R.target}),{...O,config:{...O.config,outputs:H}}});t({steps:D})}else{const D=g.map(O=>O.id===R.source?{...O,jump_to_step:R.target}:O);t({steps:D})}},[g,t]);return i.jsxs("div",{className:"w-full h-full flex relative",children:[l&&!y&&i.jsx(an,{isOpen:y,onClick:()=>{x(!0),b(!1)},icon:"",label:"Add nodes",position:"left"}),l&&!w&&i.jsx(an,{isOpen:w,onClick:()=>{b(!0),x(!1)},icon:"",label:"Configure",position:"right"}),y&&i.jsxs("div",{className:`h-full bg-[var(--color-surface)] border-r border-[var(--color-border)] relative flex-shrink-0 ${l?"absolute left-0 top-0 z-40 shadow-xl":""}`,style:{width:l?"auto":u},children:[l&&i.jsx("button",{onClick:()=>x(!1),className:"absolute top-2 right-2 z-50 p-1 rounded hover:bg-[var(--color-background)]",children:""}),i.jsx("div",{className:"p-2 h-full overflow-y-auto",children:i.jsx(Cl,{onAddNode:R=>{F(R),l&&x(!1)}})}),!l&&i.jsx(sn,{onResize:m,position:"right"})]}),i.jsxs("div",{className:"flex-1 h-full relative",children:[i.jsxs(Wc,{nodes:T,edges:$,onNodesChange:S,onEdgesChange:B,onConnect:G,onEdgeClick:f,onNodeDragStop:A,nodeTypes:_l,fitView:!0,fitViewOptions:{padding:.2},defaultEdgeOptions:{markerEnd:{type:ye.ArrowClosed}},style:{backgroundColor:"var(--color-background)"},className:"flow-editor-canvas",onPaneClick:()=>{a(null),_(null),l&&b(!1)},panOnScroll:!l,panOnDrag:!0,zoomOnScroll:!l,zoomOnPinch:!0,zoomOnDoubleClick:!1,selectNodesOnDrag:!1,selectionOnDrag:!l,children:[i.jsx(Zc,{color:"var(--color-border)",gap:20}),i.jsx(rl,{className:"flow-controls",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)"},showInteractive:!l}),!l&&i.jsx(ml,{nodeColor:R=>{var D;const L=g.find(O=>O.id===R.id);return L?((D=be[L.type])==null?void 0:D.color)||"#6B7280":"var(--color-border)"},maskColor:"rgba(0, 0, 0, 0.2)",style:{backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)"}})]}),E&&i.jsxs("div",{className:"fixed z-50 bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg shadow-lg py-1",style:{left:E.x,top:E.y},children:[i.jsxs("button",{onClick:()=>j(E.edgeId),className:"w-full px-4 py-2 text-left text-sm text-red-400 hover:bg-red-500/20 flex items-center gap-2",children:[i.jsx("span",{children:""})," Delete Connection"]}),i.jsx("button",{onClick:()=>_(null),className:"w-full px-4 py-2 text-left text-sm text-[var(--color-text-secondary)] hover:bg-[var(--color-background)]",children:"Cancel"})]})]}),w&&i.jsxs("div",{className:`h-full bg-[var(--color-surface)] border-l border-[var(--color-border)] relative flex-shrink-0 ${l?"absolute right-0 top-0 z-40 shadow-xl w-full max-w-[320px]":""}`,style:{width:l?void 0:d},children:[!l&&i.jsx(sn,{onResize:N,position:"left"}),l&&i.jsx("button",{onClick:()=>b(!1),className:"absolute top-2 right-2 z-50 p-1 rounded hover:bg-[var(--color-background)]",children:""}),i.jsx(kl,{step:k,stepIndex:C,allSteps:g,onUpdate:V,onDelete:W,availableTools:o,filterChains:n})]}),i.jsx("style",{children:`
        .flow-controls button {
          background: var(--color-surface) !important;
          border-color: var(--color-border) !important;
          color: var(--color-text) !important;
        }
        .flow-controls button:hover {
          background: var(--color-background) !important;
        }
        /* Mobile touch improvements */
        @media (max-width: 768px) {
          .flow-editor-canvas .react-flow__renderer {
            touch-action: pan-x pan-y;
          }
          .flow-editor-canvas .react-flow__node {
            touch-action: none;
          }
        }
      `})]})}function $l(e){return i.jsx(Nr,{children:i.jsx(Ml,{...e})})}export{$l as default};
